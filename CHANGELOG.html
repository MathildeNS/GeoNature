<!DOCTYPE html>
<html class="writer-html5" lang="fr" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CHANGELOG &mdash; Documentation GeoNature 2.0</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/translations.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
    <link rel="prev" title="AUTEURS" href="authors.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
            <a href="index.html" class="icon icon-home"> GeoNature
            <img src="_static/LogoGeonature.jpg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">INSTALLATION</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-manual.html">MANUEL UTILISATEUR</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin-manual.html">MANUEL ADMINISTRATEUR</a></li>
<li class="toctree-l1"><a class="reference internal" href="import-level-1.html">IMPORT NIVEAU 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="import-level-2.html">IMPORT NIVEAU 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">DEVELOPPEMENT</a></li>
<li class="toctree-l1"><a class="reference internal" href="versions-compatibility.html">COMPATIBILITE</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">AUTEURS</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">CHANGELOG</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#unreleased">2.10.0 (unreleased)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">2.9.2 (2022-02-15)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">2.9.1 (2022-01-27)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#actias-luna-2022-01-13">2.9.0 - Actias luna (2022-01-13)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">2.8.1 (2021-10-17)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vaccinium-myrtillus-2021-10-18">2.8.0 - Vaccinium myrtillus (2021-10-18)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">2.7.5 (2021-07-28)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">2.7.4 (2021-07-23)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">2.7.3 (2021-07-22)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7">2.7.2 (2021-07-05)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id8">2.7.1 (2021-07-02)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#androsace-delphinensis-2021-06-30">2.7.0 - Androsace delphinensis (2021-06-30)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id9">2.6.2 (2021-02-15)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id10">2.6.1 (2021-02-11)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#saxifraga-2021-02-04">2.6.0 - Saxifraga (2021-02-04)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id11">2.5.5 (2020-11-19)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id12">2.5.4 (2020-11-17)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id13">2.5.3 (2020-11-04)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id14">2.5.2 (2020-10-13)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id15">2.5.1 (2020-10-06)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#manidae-2020-09-30">2.5.0 - Manidae (2020-09-30)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id16">2.4.1 (2020-06-25)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fiches-de-metadonnees-2020-06-22">2.4.0 - Fiches de métadonnées (2020-06-22)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id17">2.3.2 (2020-02-24)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id18">2.3.1 (2020-02-18)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#occhab-de-noel-2019-12-27">2.3.0 - Occhab de Noël (2019-12-27)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id19">2.2.1 (2019-10-09)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-utilisateurs-2019-09-18">2.2.0 - Module utilisateurs (2019-09-18)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id20">2.1.2 (2019-07-25)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id21">2.1.1 (2019-07-18)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-validation-2019-06-01">2.1.0 - Module validation (2019-06-01)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id22">2.0.1 (2019-03-18)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#la-refonte-2019-02-28">2.0.0 - La refonte (2019-02-28)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rc-4-2-2019-01-23">2.0.0-rc.4.2 (2019-01-23)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rc-4-1-2019-01-21">2.0.0-rc.4.1 (2019-01-21)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rc-4-2019-01-15">2.0.0-rc.4 (2019-01-15)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rc-3-1-2018-10-21">2.0.0-rc.3.1 (2018-10-21)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rc-3-2018-10-18">2.0.0-rc.3 (2018-10-18)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rc-2-2018-09-24">2.0.0-rc.2 (2018-09-24)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rc-1-2018-09-21">2.0.0-rc.1 (2018-09-21)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#beta5-2018-07-16">2.0.0.beta5 (2018-07-16)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#beta4-2018-05-25">2.0.0.beta4 (2018-05-25)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#beta3-2018-03-28">2.0.0.beta3 (2018-03-28)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#beta2-2018-03-16">2.0.0.beta2 (2018-03-16)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#beta1-2018-02-16">2.0.0.beta1 (2018-02-16)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id23">1.9.1 (2018-05-17)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id24">1.9.0 (2017-07-06)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id25">1.8.4 (2017-04-10)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id26">1.8.3 (2017-02-23)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id27">1.8.2 (2017-01-11)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id28">1.8.1 (2017-01-05)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id29">1.8.0 (2016-12-14)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id30">1.7.4 (2016-07-06)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id31">1.7.3 (2016-05-19)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id32">1.7.2 (2016-04-27)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id33">1.7.1 (2016-04-27)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id34">1.7.0 (2016-04-24)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id35">1.6.0 (2016-01-14)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id36">1.5.0 (2015-11-26)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id37">1.4.0 (2015-10-16)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id38">1.3.0 (2015-02-11)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id39">1.2.0 (2015-02-11)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id40">1.1.0 (2014-12-11)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id41">1.0.0 (2014-12-10)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id42">0.1.0 (2014-12-01)</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GeoNature</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>CHANGELOG</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/CHANGELOG.rst.txt" rel="nofollow"> Afficher la source de la page</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="changelog">
<h1>CHANGELOG<a class="headerlink" href="#changelog" title="Lien permanent vers cette rubrique"></a></h1>
<section id="unreleased">
<h2>2.10.0 (unreleased)<a class="headerlink" href="#unreleased" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🚀 Nouveautés</strong></p>
<ul class="simple">
<li><p>Simplification du CRUVED minimum pour accéder à GeoNature, ne nécessitant plus d’avoir obligatoirement un CRUVED défini au niveau global de GeoNature (#1622)</p></li>
<li><p>Ajout de la commande <code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">db</span> <span class="pre">status</span></code></p></li>
<li><p>Ajout d’un worker Celery pour l’exécution de tâches asynchrones</p></li>
<li><p>Déplacement du fichier de log GeoNature dans le dossier <code class="docutils literal notranslate"><span class="pre">/var/log/geonature/</span></code></p></li>
<li><p>Suppression de la table <code class="docutils literal notranslate"><span class="pre">gn_sensitivity.cor_sensitivity_synthese</span></code> et des triggers associés.</p></li>
</ul>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Remise en place de la rotation des fichiers de logs</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<ul>
<li><p>Installation du worker Celery : il vous faut installer le broker redis :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># sudo apt install redis</span>
</pre></div>
</div>
</li>
<li><p>Passage à angular 12 (développeur), executez les commandes suivantes :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># depuis le répertoire frontend</span>
<span class="n">nvm</span> <span class="n">use</span>
<span class="n">npm</span> <span class="n">install</span> <span class="o">--</span><span class="n">legacy</span><span class="o">-</span><span class="n">peer</span><span class="o">-</span><span class="n">deps</span>
<span class="c1"># depuis le virtualenv</span>
<span class="n">geonature</span> <span class="n">generate_frontend_modules_route</span>
<span class="n">geonature</span> <span class="n">generate_frontend_tsconfig</span>
<span class="n">geonature</span> <span class="n">generate_frontend_tsconfig_app</span>
</pre></div>
</div>
</li>
<li><p>Modification du fichier SCSS du composant personnalisable introduction.
Ce composant possède désormais un fichier SCSS avec une règle qui lui est propre.
Il est donc nécessaire de :</p>
<ul>
<li><p>se placer dans le dossier du composant : <cite>cd ~/geonature/frontend/src/custom/components/introduction/</cite></p></li>
<li><p>copier le fichier <em>introduction.component.scss.sample</em> en <em>introduction.component.scss</em> avec : <cite>cp introduction.component.scss.sample introduction.component.scss</cite></p></li>
<li><p>modifier votre fichier <cite>frontend/src/custom/components/introduction/introduction.component.ts</cite> en :</p>
<ul>
<li><p>remplacant :</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@Component</span><span class="p">({</span>
  <span class="n">selector</span><span class="p">:</span> <span class="s1">&#39;pnx-introduction&#39;</span><span class="p">,</span>
  <span class="n">templateUrl</span><span class="p">:</span> <span class="s1">&#39;introduction.component.html&#39;</span>
<span class="p">})</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>par :</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@Component</span><span class="p">({</span>
  <span class="n">selector</span><span class="p">:</span> <span class="s1">&#39;pnx-introduction&#39;</span><span class="p">,</span>
  <span class="n">styleUrls</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;introduction.component.scss&#39;</span><span class="p">],</span>
  <span class="n">templateUrl</span><span class="p">:</span> <span class="s1">&#39;introduction.component.html&#39;</span>
<span class="p">})</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</li>
<li><p>le changement sera pris en compte au prochain <em>build</em> du frontend de GeoNature.</p></li>
</ul>
</li>
</ul>
</section>
<section id="id1">
<h2>2.9.2 (2022-02-15)<a class="headerlink" href="#id1" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🚀 Nouveautés</strong></p>
<ul class="simple">
<li><p>Optimisation du nombre d’informations renvoyées par l’API pour les utilisateurs et les organismes</p></li>
<li><p>Ajout d’une commande pour relancer le calcul de la sensibilité, utile en cas de modification du référentiel de sensibilité : <code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">sensitivity</span> <span class="pre">update-synthese</span></code>. Elle s’appuie sur la fonction <code class="docutils literal notranslate"><span class="pre">gn_synthese.update_sensitivity()</span></code>.</p></li>
<li><p>Le niveau de diffusion dans la synthèse n’est plus calculé automatiquement à partir du niveau de sensibilité (#1711)</p></li>
<li><p>Le niveau de sensibilité tient compte du comportement de l’occurrence (<code class="docutils literal notranslate"><span class="pre">OCC_COMPORTEMENT</span></code>), en plus du statut biologique (<code class="docutils literal notranslate"><span class="pre">STATUT_BIO</span></code>)</p></li>
<li><p>Optimisation du recalcul de la sensibilité lors de la mise à jour de la synthèse (trigger <code class="docutils literal notranslate"><span class="pre">BEFORE</span></code> au lieu de <code class="docutils literal notranslate"><span class="pre">AFTER</span></code>)</p></li>
<li><p>Ajout de tests unitaires sur les fonctions de calcul de la sensibilité</p></li>
</ul>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Correction d’une régression sur la récupération de la liste des taxons (#1672)</p></li>
<li><p>Correction de l’authentification au CAS de l’INPN</p></li>
<li><p>Correction du calcul de la sensibilité (#1284) :</p>
<ul>
<li><p>Gestion correcte de la présence de plusieurs règles avec et sans critère statut biologique</p></li>
<li><p>Utilisation de la règle la plus sensible quand plusieurs règles s’appliquent</p></li>
</ul>
</li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<ul>
<li><p>La correction de la fonction de calcul de la sensibilité est suivie d’un recalcul automatique du niveau de sensibilité des données présentes dans la synthèse. Si vous ne souhaitez pas procéder à ce recalcul, ajoutez le paramètre <code class="docutils literal notranslate"><span class="pre">-x</span> <span class="pre">recompute-sensitivity=false</span></code> lors de la mise à jour de la base de données avec la commande <code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">db</span> <span class="pre">autoupgrade</span></code> (lancée automatiquement par le script <code class="docutils literal notranslate"><span class="pre">migration.sh</span></code>) :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(venv)$ geonature db autoupgrade -x recompute-sensitivity=false
</pre></div>
</div>
</li>
<li><p>Le niveau de diffusion des données dans la synthèse est remis à <code class="docutils literal notranslate"><span class="pre">NULL</span></code> si celui-ci équivaut au niveau de sensibilité. Seuls les niveaux de diffusion qui différent sont laissés intacts. Si vous souhaitez rectifier vous-mêmes vos niveaux de diffusion et ne pas les remettre à <code class="docutils literal notranslate"><span class="pre">NULL</span></code> quand ils sont équivalents au niveau de sensibilité, vous pouvez ajouter le paramètre <code class="docutils literal notranslate"><span class="pre">-x</span> <span class="pre">clear-diffusion-level=false</span></code> lors de la mise à jour de la base de données :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(venv)$ geonature db autoupgrade -x clear-diffusion-level=false
</pre></div>
</div>
<p>Si vous redescendez à l’état antérieur de votre base de données, les niveaux de diffusion seront restaurés à partir du niveau de sensibilité ; vous pouvez éviter ceci avec <code class="docutils literal notranslate"><span class="pre">-x</span> <span class="pre">restore-diffusion-level=false</span></code>.</p>
</li>
</ul>
</section>
<section id="id2">
<h2>2.9.1 (2022-01-27)<a class="headerlink" href="#id2" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🚀 Nouveautés</strong></p>
<ul class="simple">
<li><p>Utilisation du paramètre <code class="docutils literal notranslate"><span class="pre">page</span></code> de Flask à la place du paramètre maison <code class="docutils literal notranslate"><span class="pre">offset</span></code> pour la pagination des routes (rétro-compatible)</p></li>
<li><p>Installation de TaxHub en version 1.9.4 (version corrective) par défaut</p></li>
<li><p>Ajout du paramètre de configuration <code class="docutils literal notranslate"><span class="pre">CODE_APPLICATION</span></code> (par défaut <code class="docutils literal notranslate"><span class="pre">GN</span></code>) (#1635)</p></li>
</ul>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Correction de l’URL de réinitialisation de mot passe envoyée par email (#1620)</p></li>
<li><p>Correction d’un problème d’authentification avec le CAS</p></li>
<li><p>Occtax : Correction des listes déroulantes masquées dans le bloc dénombrement, en rajoutant un scroll</p></li>
<li><p>Correction de l’URL de l’API de TaxHub (slash final manquant) pour l’affichage des photos sur la fiche d’un profil de taxon</p></li>
<li><p>Correction de la synchronisation des métadonnées depuis MTD</p></li>
<li><p>Correction de la génération du token quand on utilise le CAS de l’INPN pour se connecter à GeoNature</p></li>
<li><p>Correction des permissions trop restrictives d’accès aux données de la synthèse</p></li>
<li><p>Correction de la pagination de la route <code class="docutils literal notranslate"><span class="pre">/color_taxon</span></code> en rajoutant un ordonnancement par <code class="docutils literal notranslate"><span class="pre">cd_nom</span></code> et <code class="docutils literal notranslate"><span class="pre">id_area</span></code> (utilisé par Occtax-mobile)</p></li>
<li><p>Contournement d’un problème de redirection incorrecte par l’API de TaxHub lorsque celui-ci est mal configuré (#1438, #1616)</p></li>
</ul>
</section>
<section id="actias-luna-2022-01-13">
<h2>2.9.0 - Actias luna (2022-01-13)<a class="headerlink" href="#actias-luna-2022-01-13" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Profils de taxons</strong></p>
<p><strong>🚀 Nouveautés</strong></p>
<ul class="simple">
<li><p>Construction automatique d’une fiche d’identité (profil) par taxon grâce aux observations validées présentes dans la base de données (altitude min/max, distribution spatiale, date de première/dernière observation, nombre de données valides, phénologie) (#917 par &#64;DonovanMaillard, &#64;lepontois, &#64;Adrien-Pajot, &#64;TheoLechemia, &#64;bouttier, &#64;amandine-sahl, &#64;jpm-cbna)</p>
<ul>
<li><p>Création d’un schéma <code class="docutils literal notranslate"><span class="pre">gn_profiles</span></code> dans la BDD contenant les tables, les vues, les fonctions et les paramètres de calcul des profils de taxons (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/develop/data/core/profiles.sql">https://github.com/PnX-SI/GeoNature/blob/develop/data/core/profiles.sql</a>) (#1103)</p></li>
<li><p>Mise en place de l’API des profils de taxons (#1104)</p></li>
<li><p>Affichage des scores de chaque observation par rapport au profil du taxon dans la liste des observations du module Validation, ainsi que dans les fiches détails des observations dans les modules Synthèse et Validation (#1105)</p></li>
<li><p>Ajout de filtres des observations par score ou critère des profils de taxon dans le module Validation (#1105)</p></li>
<li><p>Ajout d’une alerte de contextualisation d’une observation par rapport au profil de taxon, lors de sa saisie dans le module Occtax</p></li>
<li><p>Mise en place de paramètres pour activer ou non les profils de taxons, paramétrer leurs règles et définir les statut de validation pris en compte pour le calcul des profils (« Certain-très probable » et « Probable » par défaut)</p></li>
<li><p>Documentation des profils de taxons et de leur paramètrage (<a class="reference external" href="https://docs.geonature.fr/admin-manual.html#profils-de-taxons">https://docs.geonature.fr/admin-manual.html#profils-de-taxons</a>)</p></li>
<li><p>Suppression de la vue matérialisée <code class="docutils literal notranslate"><span class="pre">gn_synthese.vm_min_max_for_taxons</span></code> et de la fonction <code class="docutils literal notranslate"><span class="pre">gn_synthese.fct_calculate_min_max_for_taxon()</span></code> qui n’étaient pas utilisées</p></li>
</ul>
</li>
<li><p>[OCCTAX] Ajout d’un bouton permettant d’annuler la modification d’un taxon (#1508 par &#64;jbrieuclp)</p></li>
<li><p>[OCCTAX] Ajout de valeurs par défaut aux champs additionnels (<code class="docutils literal notranslate"><span class="pre">gn_commons.t_additional_fields.default_value</span></code>)</p></li>
<li><p>[OCCTAX] Ajout d’un filtre avancé par <code class="docutils literal notranslate"><span class="pre">id_releve</span></code></p></li>
<li><p>[SYNTHESE] Ajout d’un filtre avancé par UUID d’observation (#973)</p></li>
<li><p>Amélioration des listes déroulantes en passant à la librairie <code class="docutils literal notranslate"><span class="pre">ng-select2</span></code> pour les composants multiselects (#616 par &#64;jbrieuclp)</p></li>
<li><p>Gestion du référentiel des régions par Alembic (#1475)</p></li>
<li><p>Ajout des anciennes régions (1970-2016), inactives par défaut, mais utiles pour les règles régionales de sensibilité</p></li>
<li><p>Gestion du référentiel de sensibilité (règles nationales et régionales) par Alembic (#1576)</p></li>
<li><p>Ajout d’une documentation sur le calcul de la sensibilité des observations (<a class="reference external" href="https://docs.geonature.fr/admin-manual.html#gestion-de-la-sensibilite">https://docs.geonature.fr/admin-manual.html#gestion-de-la-sensibilite</a>, par &#64;mvergez)</p></li>
<li><p>[SYNTHESE] Amélioration de la fenêtre de limite d’affichage atteinte (#1520 par &#64;jpm-cbna)</p></li>
<li><p>[OCCHAB] Utilisation de tout Habref par défaut si aucune liste d’habitats n’est renseignée dans la configuration du module</p></li>
<li><p>[METADONNEES] Attribuer des droits à un utilisateur sur un JDD si il a des droits sur son cadre d’acquisition</p></li>
<li><p>Association automatique et paramétrable des jeux de données personnels auto-générés à des modules (Occtax par défaut) (#1555)</p></li>
<li><p>Utilisation du C du CRUVED de l’utilisateur pour lister les jeux de données dans lesquels il peut ajouter des données dans les différents modules (et non plus le R du CRUVED sur GeoNature) (#659)</p></li>
</ul>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>[OCCTAX] Correction de l’enregistrement des dénombrements lors de l’enchainement des relevés (#1479 par &#64;jbrieuclp)</p></li>
<li><p>[OCCTAX] Correction du filtre du champs « Habitat » par typologie d’habitat</p></li>
<li><p>[ADMIN] Correction de l’affichage du module (#1427 par &#64;jbrieuclp)</p></li>
<li><p>[ADMIN] Sécurisation du module (#839)</p></li>
<li><p>[VALIDATION] Corrections de la validation des observations (#1485 / #1529)</p></li>
<li><p>[METADONNEES] Amélioration des performances (#1559)</p></li>
<li><p>[METADONNEES] Correction de la suppression des JDD</p></li>
<li><p>[METADONNEES] Correction de l’export PDF des JDD (#1544)</p></li>
<li><p>[METADONNEES] Correction des permissions (#1528)</p></li>
<li><p>[METADONNEES] Correction de la recherche avancée</p></li>
<li><p>[SYNTHESE] Correction de la recherche sur les champs génériques de type nombre entier (#1519 par &#64;jpm-cbna)</p></li>
<li><p>[SYNTHESE] Correction des permissions</p></li>
<li><p>[SYNTHESE] Correction du lien entre les filtres CA et JDD (#1530)</p></li>
<li><p>[OCCHAB] Correction du chargement de la configuration, des fiches info et de la modification d’une station</p></li>
<li><p>[METADONNEES] Améliorations des performances et des contrôles du formulaire des acteurs pour les JDD et les CA (par &#64;joelclems)</p></li>
<li><p>Correction de la redirection vers le formulaire de login en cas de cookie corrompu (#1550 par &#64;antoinececchimnhn)</p></li>
<li><p>Correction de la création de compte utilisateur (#1527)</p></li>
<li><p>Mise à jour du module Habref-api-module pour corrections de certaines données d’Habref</p></li>
</ul>
<p><strong>💻 Développement</strong></p>
<ul class="simple">
<li><p>Migration vers la librairie <code class="docutils literal notranslate"><span class="pre">gn-select2</span></code> pour les listes déroulantes des formulaires (#616 / #1285 par &#64;jbrieuclp)</p></li>
<li><p>Documentation de développement backend revue et complétée (#1559, <a class="reference external" href="https://docs.geonature.fr/development.html#developpement-backend">https://docs.geonature.fr/development.html#developpement-backend</a>)</p></li>
<li><p>Amélioration de nombreuses routes et fonctions du backend</p></li>
<li><p>Ajouts de tests automatisés du backend</p></li>
<li><p>Mise en place d’une intégration continue pour exécuter automatiquement les tests backend et leur couverture de code avec GitHub Actions, à chaque commit ou pull request dans les branches <code class="docutils literal notranslate"><span class="pre">develop</span></code> ou <code class="docutils literal notranslate"><span class="pre">master</span></code> (#1568, <a class="reference external" href="https://github.com/PnX-SI/GeoNature/actions">https://github.com/PnX-SI/GeoNature/actions</a>)</p></li>
<li><p>[VALIDATION] Suppression des vues SQL et optimisation des routes</p></li>
<li><p>Génération automatique et aléatoire du paramètre <code class="docutils literal notranslate"><span class="pre">SECRET_KEY</span></code></p></li>
<li><p>[SYNTHESE] Remplacement de <code class="docutils literal notranslate"><span class="pre">as_literal</span></code> par <code class="docutils literal notranslate"><span class="pre">json.loads</span></code>, plus performant (par &#64;antoinececchimnhn)</p></li>
<li><p>Possibilité de filter la route <code class="docutils literal notranslate"><span class="pre">synthese/taxa_distribution</span></code> par <code class="docutils literal notranslate"><span class="pre">id_source</span></code> (#1446 par &#64;mvergez)</p></li>
<li><p>Factorisation du composant <code class="docutils literal notranslate"><span class="pre">pnx-municipalities</span></code> avec le composant <code class="docutils literal notranslate"><span class="pre">pnx-areas</span></code></p></li>
<li><p>Ajout du composant <code class="docutils literal notranslate"><span class="pre">pnx-areas</span></code> dans dynamic-form</p></li>
<li><p>Ajout d’un input <code class="docutils literal notranslate"><span class="pre">valueFieldName</span></code> aux composants <code class="docutils literal notranslate"><span class="pre">pnx-areas</span></code> et <code class="docutils literal notranslate"><span class="pre">pnx-municipalities</span></code>. Voir documentation (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/develop/docs/development.rst#pnx-municipalities">https://github.com/PnX-SI/GeoNature/blob/develop/docs/development.rst#pnx-municipalities</a>)</p></li>
<li><p>Mise à jour de nombreuses dépendances</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<ul>
<li><p>La liste des JDD dans les modules de saisie (Occtax, Occhab, Monitoring et Import) se base désormais sur le C du CRUVED de l’utilisateur au niveau du module (ou du C du CRUVED de GeoNature si l’utilisateur n’a pas de CRUVED sur le module), au lieu du R de GeoNature jusqu’à présent. Vous devrez donc potentiellement adapter vos permissions à ce changement de comportement (#659)</p></li>
<li><p>Si vous avez surcouché le paramètre de configuration <code class="docutils literal notranslate"><span class="pre">AREA_FILTERS</span></code> de la section <code class="docutils literal notranslate"><span class="pre">[SYNTHESE]</span></code>, veuillez remplacer <code class="docutils literal notranslate"><span class="pre">id_type</span></code> par <code class="docutils literal notranslate"><span class="pre">type_code</span></code> (voir <code class="docutils literal notranslate"><span class="pre">ref_geo.bib_areas_types</span></code>)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AREA_FILTERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Communes&quot;</span><span class="p">,</span> <span class="n">id_type</span> <span class="o">=</span> <span class="mi">25</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>devient</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AREA_FILTERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Communes&quot;</span><span class="p">,</span> <span class="n">type_code</span> <span class="o">=</span> <span class="s2">&quot;COM&quot;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>Si vous aviez modifié les colonnes de la liste des observations du module Validation en adaptant la vue <code class="docutils literal notranslate"><span class="pre">gn_validation.v_synthese_validation_forwebapp</span></code>, celle-ci a été supprimée et il suffit désormais d’indiquer les colonnes souhaitées dans la configuration du module. Voir documentation (<a class="reference external" href="http://docs.geonature.fr/admin-manual.html#liste-des-champs-visibles">http://docs.geonature.fr/admin-manual.html#liste-des-champs-visibles</a>)</p></li>
<li><p>Les nouvelles fonctionnalités liées aux profils de taxons nécessitent de rafraichir des vues materialisées à intervalles réguliers et donc de créer une tâche planfiée (cron). Voir documentation (<a class="reference external" href="https://docs.geonature.fr/installation.html#taches-planifiees">https://docs.geonature.fr/installation.html#taches-planifiees</a>)</p></li>
<li><p>Les régions sont maintenant disponibles via des migrations Alembic. Si vous possédez déjà les régions, vous pouvez l’indiquer à Alembic :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">geonature</span> <span class="n">db</span> <span class="n">upgrade</span> <span class="n">ref_geo</span><span class="nd">@head</span>
<span class="n">geonature</span> <span class="n">db</span> <span class="n">stamp</span> <span class="n">d02f4563bebe</span>
</pre></div>
</div>
</li>
<li><p>Le référentiel de sensibilité est désormais disponible via une migration Alembic. Celui-ci nécessite le référentiel des régions (branche Alembic <code class="docutils literal notranslate"><span class="pre">ref_geo_fr_regions</span></code>), ainsi que le référentiel des anciennes régions (branche Alembic <code class="docutils literal notranslate"><span class="pre">ref_geo_fr_regions_1970</span></code>) – l’installation de ces référentiels est automatique avec l’installation des règles de sensibilité.</p>
<ul>
<li><p>Si vous possédez déjà le référentiel, vous pouvez l’indiquer à Alembic :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">geonature</span> <span class="n">db</span> <span class="n">stamp</span> <span class="mi">7</span><span class="n">dfd0a813f86</span>
</pre></div>
</div>
</li>
<li><p>Si vous avez installé GeoNature 2.8.X, le référentiel de sensibilité n’a pas été installé automatiquement. Vous pouvez l’installer manuellement :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">geonature</span> <span class="n">db</span> <span class="n">upgrade</span> <span class="n">ref_sensitivity_inpn</span><span class="nd">@head</span>
</pre></div>
</div>
</li>
</ul>
<p>Par défaut, seule les règles nationales sont activées, vous laissant le soin d’activer vos règles locales en base vous-même. Vous pouvez également demander, lors de l’installation du référentiel, à activer (resp. désactiver) toutes les règles en ajout à la commande Alembic l’option <code class="docutils literal notranslate"><span class="pre">-x</span> <span class="pre">active=true</span></code> (resp. <code class="docutils literal notranslate"><span class="pre">-x</span> <span class="pre">active=false</span></code>).</p>
</li>
<li><p>Si vous souhaitez surcoucher les paramètres par défaut de Gunicorn (app_name, timeout…), depuis le passage à <code class="docutils literal notranslate"><span class="pre">systemd</span></code> dans la version 2.8.0, c’est désormais à faire dans un fichier <code class="docutils literal notranslate"><span class="pre">environ</span></code> à la racine du dossier de votre GeoNature (#1588, <a class="reference external" href="https://docs.geonature.fr/admin-manual.html#parametres-gunicorn">https://docs.geonature.fr/admin-manual.html#parametres-gunicorn</a>)</p></li>
<li><p>Si vous les utilisez, mettez à jour les modules Import, Export et Monitoring dans leurs dernières versions compatibles avec le version 2.9.0 de GeoNature</p></li>
</ul>
</section>
<section id="id3">
<h2>2.8.1 (2021-10-17)<a class="headerlink" href="#id3" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🚀 Nouveautés</strong></p>
<ul class="simple">
<li><p>Ajout de l’indication du département au formulaire des communes (#1480)</p></li>
<li><p>Ajout des champs <code class="docutils literal notranslate"><span class="pre">group2inpn</span></code> et <code class="docutils literal notranslate"><span class="pre">regne</span></code> au formulaire des nomenclatures (#1481)</p></li>
</ul>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Correction de la commande <code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">db</span> <span class="pre">autoupgrade</span></code></p></li>
<li><p>Mise-à-jour corrective de <a class="reference external" href="https://github.com/PnX-SI/UsersHub-authentification-module/releases/tag/1.5.7">UsersHub-authentification-module 1.5.7</a></p></li>
</ul>
</section>
<section id="vaccinium-myrtillus-2021-10-18">
<h2>2.8.0 - Vaccinium myrtillus (2021-10-18)<a class="headerlink" href="#vaccinium-myrtillus-2021-10-18" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Gestion de la base de données avec Alembic</strong></p>
<p>⚠️ Avant de mettre à jour GeoNature, vérifiez que les modules que vous utilisez disposent d’une version compatible avec la 2.8.0, suite au passage à la version 3 de Marshmallow.</p>
<p><strong>🚀 Nouveautés</strong></p>
<ul class="simple">
<li><p>Support de Debian 11 / Python 3.9</p></li>
<li><p>Passage de <code class="docutils literal notranslate"><span class="pre">supervisor</span></code> à <code class="docutils literal notranslate"><span class="pre">systemd</span></code></p></li>
<li><p>Gestion de la base de données et de ses évolutions avec Alembic (#880)</p></li>
<li><p>Mise à jour de la procédure d’installation afin d’utiliser Alembic (#880)</p></li>
<li><p>Révision et réorganisation des scripts et de la documentation d’installation</p></li>
<li><p>Passage à la version 3 de Marshmallow (#1451)</p></li>
<li><p>Suppression du paramètre <code class="docutils literal notranslate"><span class="pre">ID_APP</span></code>, celui-ci est automatiquement déterminé à partir de la base de données et du code de l’application</p></li>
<li><p>Ajout d’un index sur le champs <code class="docutils literal notranslate"><span class="pre">ref_geo.l_areas.id_area</span></code></p></li>
<li><p>Mise à jour des dépendances</p>
<ul>
<li><p><a class="reference external" href="https://github.com/PnX-SI/TaxHub/releases/tag/1.9.0">TaxHub 1.9.0</a></p></li>
<li><p><a class="reference external" href="https://github.com/PnX-SI/UsersHub-authentification-module/releases/tag/1.5.6">UsersHub-authentification-module 1.5.6</a></p></li>
<li><p><a class="reference external" href="https://github.com/PnX-SI/Nomenclature-api-module/releases/tag/1.4.4">Nomenclature-api-module 1.4.4</a></p></li>
<li><p><a class="reference external" href="https://github.com/PnX-SI/Habref-api-module/releases/tag/0.2.0">Habref-api-module 0.2.0</a></p></li>
<li><p><a class="reference external" href="https://github.com/PnX-SI/Utils-Flask-SQLAlchemy/releases/tag/0.2.4">Utils-Flask-SQLAlchemy 0.2.4</a></p></li>
<li><p><a class="reference external" href="https://github.com/PnX-SI/Utils-Flask-SQLAlchemy-Geo/releases/tag/0.2.1">Utils-Flask-SQLAlchemy-Geo 0.2.1</a></p></li>
</ul>
</li>
</ul>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Corrections et améliorations des formulaires dynamiques et des champs additionnels</p></li>
<li><p>Correction de l’envoi d’email lors de la récupération du mot de passe (#1471)</p></li>
<li><p>Occtax : Correction du focus sur le champs « taxon » quand on enchaine les taxons (#1462)</p></li>
<li><p>Occtax : Correction du formulaire de modification quand le relevé est une ligne ou un polygone (#1461)</p></li>
<li><p>Occtax : Correction de la conservation de la date quand on enchaine les relevés (#1442)</p></li>
<li><p>Occtax : Correction du paramètre d’export des champs additionnels (#1440)</p></li>
<li><p>Synthèse : correction de la recherche par jeu de données (#1494)</p></li>
<li><p>Correction de l’affichage des longues listes déroulantes dans les champs additionnels (#1442)</p></li>
<li><p>Mise à jour de la table <code class="docutils literal notranslate"><span class="pre">cor_area_synthese</span></code> lors de l’ajout de nouvelles zones via un trigger sur la table <code class="docutils literal notranslate"><span class="pre">l_areas</span></code> (#1433)</p></li>
<li><p>Correction de l’export PDF des fiches de métadonnées (#1449)</p></li>
<li><p>Jeux de données : correction de l’affichage des imports sources</p></li>
<li><p>Correction de la configuration Apache et de la gestion par flask d’un GeoNature accessible sur un préfix (e.g. <code class="docutils literal notranslate"><span class="pre">/geonature</span></code>) (#1463)</p></li>
<li><p>Correction de la commande <code class="docutils literal notranslate"><span class="pre">install_packaged_gn_module</span></code></p></li>
<li><p>Correction des champs additionnels de type boutons radios (#1464 et #1472)</p></li>
<li><p>Occtax : Correction du contrôle des heures quand on est sur 2 mois distincts (#1468)</p></li>
<li><p>Suppression de nombreux identifiants en dur dans les scripts SQL de création de la BDD</p></li>
<li><p>Correction du trigger d’Occtax vers la Synthèse pour le champs <code class="docutils literal notranslate"><span class="pre">Comportement</span></code> (#1469)</p></li>
<li><p>Correction des fonctions <code class="docutils literal notranslate"><span class="pre">get_default_nomenclature_value</span></code></p></li>
<li><p>Correction du composant <code class="docutils literal notranslate"><span class="pre">multiselect</span></code> (#1488)</p></li>
<li><p>Correction du script <code class="docutils literal notranslate"><span class="pre">migrate.sh</span></code> pour récupérer le fichier <code class="docutils literal notranslate"><span class="pre">custom.scss</span></code> depuis son nouvel emplacement (#1430)</p></li>
<li><p>Correction du paramètre <code class="docutils literal notranslate"><span class="pre">EXPORT_OBSERVERS_COL</span></code></p></li>
<li><p>Métadonnées : Suppression en cascade sur les tables <code class="docutils literal notranslate"><span class="pre">gn_meta.cor_dataset_territory</span></code> et <code class="docutils literal notranslate"><span class="pre">gn_meta.cor_dataset_protocol</span></code> (#1452)</p></li>
<li><p>Correction de la commande <code class="docutils literal notranslate"><span class="pre">install_packaged_gn_module</span></code> : rechargement des entry points après installation avec pip d’un module packagé</p></li>
<li><p>Correction d’un bug lors de l’ajout d’un cadre d’acquisition</p></li>
</ul>
<p><strong>💻 Développement</strong></p>
<ul class="simple">
<li><p>Mise à jour de plusieurs dépendances</p></li>
<li><p>Packetage des modules fournis avec GeoNature</p></li>
<li><p>L’utilisateur connecté est maintenant accessible via <code class="docutils literal notranslate"><span class="pre">g.current_user</span></code></p></li>
<li><p>Nettoyage et refactoring divers</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<ul>
<li><p>Mettre à jour <a class="reference external" href="https://github.com/PnX-SI/UsersHub/releases/tag/2.2.1">UsersHub en version 2.2.1</a> et <a class="reference external" href="https://github.com/PnX-SI/TaxHub/releases/tag/1.9.0">TaxHub en version 1.9.0</a> (si vous les utilisez) <strong>en sautant leur étape de passage à Alembic</strong> (car la mise à jour de GeoNature se charge désormais de mettre à jour aussi les schémas <code class="docutils literal notranslate"><span class="pre">taxonomie</span></code> et <code class="docutils literal notranslate"><span class="pre">utilisateurs</span></code>)</p></li>
<li><p>Suppression de <code class="docutils literal notranslate"><span class="pre">supervisor</span></code> :</p>
<ul class="simple">
<li><p>Stopper GeoNature : <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">supervisorctl</span> <span class="pre">stop</span> <span class="pre">geonature2</span></code></p></li>
<li><p>Supprimer le fichier de configuration supervisor de GeoNature : <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">rm</span> <span class="pre">/etc/supervisor/conf.d/geonature-service.conf</span></code></p></li>
<li><p>Si supervisor n’est plus utilisé par aucun service (répertoire <code class="docutils literal notranslate"><span class="pre">/etc/supervisor/conf.d/</span></code> vide), il peut être désinstallé (<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">remove</span> <span class="pre">supervisor</span></code>)</p></li>
</ul>
</li>
<li><p>Suivre la procédure classique de mise à jour de GeoNature (<a class="reference external" href="http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application">http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application</a>)</p></li>
<li><p>Passage à <code class="docutils literal notranslate"><span class="pre">systemd</span></code> :</p>
<ul class="simple">
<li><p>Copier le fichier <code class="docutils literal notranslate"><span class="pre">install/assets/geonature.service</span></code> dans <code class="docutils literal notranslate"><span class="pre">/etc/systemd/system/</span></code></p></li>
<li><p>Éditer <code class="docutils literal notranslate"><span class="pre">/etc/systemd/system/geonature.service</span></code> et remplacer les variables <code class="docutils literal notranslate"><span class="pre">${USER}</span></code> (votre utilisateur linux courant) et <code class="docutils literal notranslate"><span class="pre">${BASE_DIR}</span></code> (chemin absolu du répertoire de GeoNature) par les valeurs appropriées</p></li>
<li><p>Lancer la commande <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">daemon-reload</span></code></p></li>
<li><p>Pour démarrer GeoNature : <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">geonature</span></code></p></li>
<li><p>Pour lancer GeoNature automatiquement au démarrage du serveur : <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">enable</span> <span class="pre">geonature</span></code></p></li>
</ul>
</li>
<li><p>Correction de la configuration Apache : si vous servez GeoNature sur un préfixe (typiquement <code class="docutils literal notranslate"><span class="pre">/geonature/api</span></code>), assurez vous que ce préfixe figure bien également à la fin des directives <code class="docutils literal notranslate"><span class="pre">ProxyPass</span></code> et <code class="docutils literal notranslate"><span class="pre">ProxyPassReverse</span></code> comme dans l’exemple suivant :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">Location</span> <span class="o">/</span><span class="n">geonature</span><span class="o">/</span><span class="n">api</span><span class="o">&gt;</span>
    <span class="n">ProxyPass</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">8000</span><span class="o">/</span><span class="n">geonature</span><span class="o">/</span><span class="n">api</span>
    <span class="n">ProxyPassReverse</span>  <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">8000</span><span class="o">/</span><span class="n">geonature</span><span class="o">/</span><span class="n">api</span>
<span class="o">&lt;/</span><span class="n">Location</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Si vous servez GeoNature sur un sous-domaine, vérifiez ou modifier la configuration Apache :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">Location</span> <span class="o">/</span><span class="n">api</span><span class="o">&gt;</span>
    <span class="n">ProxyPass</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">8000</span><span class="o">/</span><span class="n">api</span>
    <span class="n">ProxyPassReverse</span>  <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">8000</span><span class="o">/</span><span class="n">api</span>
<span class="o">&lt;/</span><span class="n">Location</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Pensez à recharger Apache si vous êtes amené à en changer la configuration : <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">reload</span> <span class="pre">apache2</span></code></p>
</li>
<li><p>Passage à Alembic :</p>
<ul class="simple">
<li><p>S’assurer d’avoir une base de données de GeoNature en version 2.7.5</p></li>
<li><p>Si vous avez UsersHub installé, ajoutez dans votre configuration GeoNature la section suivante (en adaptant le chemin) :</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">ALEMBIC</span><span class="p">]</span>
<span class="n">VERSION_LOCATIONS</span> <span class="o">=</span> <span class="s1">&#39;/path/to/usershub/app/migrations/versions&#39;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Entrer dans le virtualenv afin d’avoir la commande <code class="docutils literal notranslate"><span class="pre">geonature</span></code> disponible : <code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">backend/venv/bin/activate</span></code></p></li>
<li><p>Exécuter les commandes suivantes afin d’indiquer à Alembic l’état de votre base de données :</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">geonature</span> <span class="n">db</span> <span class="n">stamp</span> <span class="n">f06cc80cc8ba</span>  <span class="c1"># GeoNature 2.7.5</span>
<span class="n">geonature</span> <span class="n">db</span> <span class="n">stamp</span> <span class="mi">0</span><span class="n">dfdbfbccd63</span>  <span class="c1"># référentiel géographique des communes</span>
<span class="n">geonature</span> <span class="n">db</span> <span class="n">stamp</span> <span class="mi">3</span><span class="n">fdaa1805575</span>  <span class="c1"># référentiel géographique des départements</span>
<span class="n">geonature</span> <span class="n">db</span> <span class="n">stamp</span> <span class="mf">586613e2</span><span class="n">faeb</span>  <span class="c1"># référentiel géographique des mailles 1×1</span>
<span class="n">geonature</span> <span class="n">db</span> <span class="n">stamp</span> <span class="mi">7</span><span class="n">d6e98441e4c</span>  <span class="c1"># référentiel géographique des mailles 5×5</span>
<span class="n">geonature</span> <span class="n">db</span> <span class="n">stamp</span> <span class="n">ede150d9afd9</span>  <span class="c1"># référentiel géographique des mailles 10×10</span>
<span class="n">geonature</span> <span class="n">db</span> <span class="n">stamp</span> <span class="mi">1715</span><span class="n">cf31a75d</span>  <span class="c1"># MNT de l’IGN</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Si vous aviez déjà intallé certains modules, vous devez l’indiquer à Alembic :</p>
<ul>
<li><p>Module <em>Occtax</em> : <code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">db</span> <span class="pre">stamp</span> <span class="pre">f57107d2d0ad</span></code></p></li>
<li><p>Module <em>Occhab</em> : <code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">db</span> <span class="pre">stamp</span> <span class="pre">2984569d5df6</span></code></p></li>
</ul>
</li>
<li><p>Mettre sa base de données à jour avec Alembic : <code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">db</span> <span class="pre">autoupgrade</span></code></p></li>
</ul>
<p>Pour plus d’information sur l’utilisation d’Alembic, voir la <a class="reference external" href="https://docs.geonature.fr/admin-manual.html#administration-avec-alembic">documentation administrateur de GeoNature</a>.</p>
</li>
</ul>
</section>
<section id="id4">
<h2>2.7.5 (2021-07-28)<a class="headerlink" href="#id4" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Compatibilité avec Occtax-mobile 1.3. Possibilité d’ajouter la query string <code class="docutils literal notranslate"><span class="pre">fields</span></code> sur la route <code class="docutils literal notranslate"><span class="pre">meta/datasets</span></code> pour choisir les champs renvoyés par l’API</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<p>Si vous mettez à jour GeoNature :</p>
<ul class="simple">
<li><p>Vous pouvez passer directement à cette version mais en suivant les notes des versions intermédiaires</p></li>
</ul>
</section>
<section id="id5">
<h2>2.7.4 (2021-07-23)<a class="headerlink" href="#id5" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Correction d’un import manquant entrainant un problème de compilation du frontend (#1424)</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<p>Si vous mettez à jour GeoNature :</p>
<ul class="simple">
<li><p>Vous pouvez passer directement à cette version mais en suivant les notes des versions intermédiaires</p></li>
</ul>
</section>
<section id="id6">
<h2>2.7.3 (2021-07-22)<a class="headerlink" href="#id6" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🚀 Nouveautés</strong></p>
<ul class="simple">
<li><p>Métadonnées : ajout des paramètres <code class="docutils literal notranslate"><span class="pre">CD_NOMENCLATURE_ROLE_TYPE_DS</span></code> et <code class="docutils literal notranslate"><span class="pre">CD_NOMENCLATURE_ROLE_TYPE_AF</span></code> pour limiter les rôles utilisables au niveau des jeux de données et des cadres d’acquisition (#1417)</p></li>
<li><p>Ajout de la commande <code class="docutils literal notranslate"><span class="pre">mtd_sync</span></code> qui permet de synchroniser les métadonnées de toute une instance depuis le flux MTD du SINP</p></li>
</ul>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Correction de l’affichage des jeux de données sur les fiches des cadres d’acquisition (#1410)</p></li>
<li><p>Doc : Précision des OS supportés (Debian 10 uniquement en production)</p></li>
</ul>
<p><strong>💻 Développement</strong></p>
<ul class="simple">
<li><p>Support des commandes Flask au niveau de la commande <code class="docutils literal notranslate"><span class="pre">geonature</span></code> (<code class="docutils literal notranslate"><span class="pre">run</span></code>, <code class="docutils literal notranslate"><span class="pre">db</span></code>, <code class="docutils literal notranslate"><span class="pre">routes</span></code>, <code class="docutils literal notranslate"><span class="pre">shell</span></code>…)</p></li>
<li><p>Ajout des sous-modules en tant que dépendances</p></li>
<li><p>Ajout d’une commande <code class="docutils literal notranslate"><span class="pre">install_packaged_gn_module</span></code></p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<p>Si vous mettez à jour GeoNature :</p>
<ul class="simple">
<li><p>Vous pouvez passer directement à cette version mais en suivant les notes des versions intermédiaires</p></li>
</ul>
</section>
<section id="id7">
<h2>2.7.2 (2021-07-05)<a class="headerlink" href="#id7" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>OCCTAX : correction de la vérification du CRUVED (#1413)</p></li>
<li><p>OCCTAX : correction du dégrisement du formulaire au chargement de la fonctionnalité « mes lieux » (#1414)</p></li>
<li><p>OCCTAX : Déplacement des champs additionnels pour les dénombrements avant les médias (#1409)</p></li>
<li><p>Suppression des champs additionnels de type « taxonomy » qui n’étaient pas supportés</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<p>Si vous mettez à jour GeoNature :</p>
<ul class="simple">
<li><p>Vous pouvez passer directement à cette version mais en suivant les notes des versions intermédiaires</p></li>
<li><p>Exécuter le script SQL de mise à jour de la BDD de GeoNature (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.7.1to2.7.2.sql">https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.7.1to2.7.2.sql</a>)</p></li>
</ul>
</section>
<section id="id8">
<h2>2.7.1 (2021-07-02)<a class="headerlink" href="#id8" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Installation des dépendances javascript des modules lors de la migration de version de GeoNature (#1252)</p></li>
<li><p>Installation de la version 1.8.1 de TaxHub par défaut à la place de la 1.8.0</p></li>
<li><p>Intégration de la documentation permettant de mettre en place l’accès public à GeoNature</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<p>Si vous mettez à jour GeoNature :</p>
<ul class="simple">
<li><p>Vous pouvez passer directement à cette version mais en suivant les notes des versions intermédiaires</p></li>
</ul>
</section>
<section id="androsace-delphinensis-2021-06-30">
<h2>2.7.0 - Androsace delphinensis (2021-06-30)<a class="headerlink" href="#androsace-delphinensis-2021-06-30" title="Lien permanent vers cette rubrique"></a></h2>
<p>Nécessite la version 1.8.x de TaxHub.</p>
<p><strong>🚀 Nouveautés</strong></p>
<ul class="simple">
<li><p>Compatible avec TaxHub 1.8.x qui inclut notamment la migration (optionnelle) vers Taxref version 14 et l’ajout de la BDC statuts</p></li>
<li><p>Installation globale migrée de Taxref version 13 à 14</p></li>
<li><p>Occtax : Possibilité d’ajouter des champs additionels par JDD ou globaux au module et documentation liée (#1007)</p></li>
<li><p>Occtax/Synthese : Ajout des champs additionnels dans les exports (#1114)</p></li>
<li><p>Occtax/Synthese : Affichage des champs additionnels dans les fiches info</p></li>
<li><p>Customisation : possibilité de changer le CSS sans rebuilder l’application</p></li>
<li><p>Admin : Création d’un backoffice d’administration des champs additionels (#1007)</p></li>
<li><p>Admin : Création d’une documentation d’administration des champs additionnels (#1007)</p></li>
<li><p>Occtax : Possibilité de désactiver la recherche de taxon par liste (#1315)</p></li>
<li><p>Occtax : Par défaut la recherche de taxon n’interroge pas une liste mais tout Taxref, si aucune liste de taxons n’a été spécifiée dans la configuration du module Occtax (voir notes de version) (#1315)</p></li>
<li><p>Occtax/Metadonnées : possibilité d’associer une liste de taxons à un JDD (implémenté uniquement dans Occtax) (#1315)</p></li>
<li><p>Occtax : Possibilité d’ajouter les infos sur les médias dans les exports (paramètre <code class="docutils literal notranslate"><span class="pre">ADD_MEDIA_IN_EXPORT</span></code>) (#1326)</p></li>
<li><p>Occtax : Possibilité de paramétrer l’affichage des champs du composant MEDIA dans OCCTAX (paramètre <code class="docutils literal notranslate"><span class="pre">MEDIA_FIELDS_DETAILS</span></code> - #1287)</p></li>
<li><p>Occtax : Possibilité de filtrer la liste des habitats du formulaire avec les nouveaux paramètres <code class="docutils literal notranslate"><span class="pre">ID_LIST_HABITAT</span></code> et <code class="docutils literal notranslate"><span class="pre">CD_TYPO_HABITAT</span></code></p></li>
<li><p>Occtax : Possibilité d’ouvrir le module avec un JDD pré-selectionné en passant le paramètre <code class="docutils literal notranslate"><span class="pre">id_dataset</span></code> dans l’URL (#1071)</p></li>
<li><p>Accueil : Réorganisation des blocs (#1375)</p></li>
<li><p>Accueil : Ajout d’un paramètre controlant la fréquence de MAJ du cache des statistiques de la page d’accueil (<code class="docutils literal notranslate"><span class="pre">STAT_BLOC_TTL</span></code>, par défaut 1h: 3600 secondes) (#1320)</p></li>
<li><p>Amélioration des performances de récupération des modules et du CRUVED</p></li>
<li><p>Monitoring : Ajout d’un trigger garantissant la cohérence entre <code class="docutils literal notranslate"><span class="pre">date_min</span></code> et <code class="docutils literal notranslate"><span class="pre">date_max</span></code> et historisation de la table <code class="docutils literal notranslate"><span class="pre">gn_monitoring.cor_visit_observer</span></code> (#1247)</p></li>
<li><p>La page d’authentification affiche désormais le nom de l’application (<code class="docutils literal notranslate"><span class="pre">appName</span></code>) défini dans la configuration de GeoNature (#1277)</p></li>
<li><p>Possibilité d’ouvrir l’accès à GeoNature sans authentification (voir documentation d’administration) (#1323)</p></li>
<li><p>Métadonnées : Optimisation du temps de chargement des listes des CA et JDD (#1291)</p></li>
<li><p>Métadonnées : Passage de la version 1.3.9 du standard SINP à la version 1.3.10 et ajout des champs liés dans les formulaires (#1291)</p></li>
<li><p>Métadonnées : Révision du design la partie « Acteurs » du formulaire et mise à part de l’acteur de type « Contact principal », obligatoire dans le standard SINP</p></li>
<li><p>Métadonnées : Ordonnancement des JDD par leur nom</p></li>
<li><p>Métadonnées : Ajout de la suppression en cascade au niveau des tables des CA et des JDD</p></li>
<li><p>Métadonnées : Ajout d’un message quand un CA ou JDD n’a pas d’acteur (#1404)</p></li>
<li><p>Synthèse et validation : Ajout d’un filtre avancé <code class="docutils literal notranslate"><span class="pre">Possède</span> <span class="pre">des</span> <span class="pre">médias</span></code> (#1179, #1338, #1180)</p></li>
<li><p>Synthèse : Affichage du contenu json du champs des données additionnelles, dans la fiche détail d’une observation</p></li>
<li><p>Synthèse : Ajout de la possibilité d’afficher la colonne « Effectif » dans la liste des observations</p></li>
<li><p>DynamicForm : enrichissement des formulaires dynamiques pour les médias, l’ajout de liens externes</p></li>
<li><p>Ajout d’une contrainte d’unicité de la combinaison des champs <code class="docutils literal notranslate"><span class="pre">id_type</span></code> et <code class="docutils literal notranslate"><span class="pre">area_code</span></code> dans <code class="docutils literal notranslate"><span class="pre">ref_geo.l_areas</span></code> (#1270)</p></li>
<li><p>Ajout d’une contrainte d’unicité du champs <code class="docutils literal notranslate"><span class="pre">type_code</span></code> de la table <code class="docutils literal notranslate"><span class="pre">ref_geo.bib_areas_types</span></code></p></li>
<li><p>Mise à jour des versions de nombreuses dépendances Python et Javascript</p></li>
<li><p>Support du gestionnaire d’erreurs Sentry</p></li>
<li><p>Compression des images</p></li>
<li><p>Ajout d’un script permettant d’identifier les doublons dans <code class="docutils literal notranslate"><span class="pre">data/scripts/duplicates_deletion</span></code> (#1324)</p></li>
<li><p>Validation : possibilité de passer des fonctions dans la liste des colonnes affichées (pour décoder une nomenclature)</p></li>
<li><p>Validation : Les paramètres <code class="docutils literal notranslate"><span class="pre">LIST_COLUMNS_FRONTEND</span></code> et <code class="docutils literal notranslate"><span class="pre">COLUMNS_API_VALIDATION_WEB_APP</span></code> sont regroupés en un seul paramètre nommé <code class="docutils literal notranslate"><span class="pre">COLUMN_LIST</span></code>. Voir le fichier <code class="docutils literal notranslate"><span class="pre">contrib/gn_module_validation/config/conf_gn_module.toml.example</span></code></p></li>
</ul>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Occtax : Correction d’un bug sur le champs observateur lors de la modification d’un relevé (#1177)</p></li>
<li><p>Occtax : Renseignement par défaut de l’utilisateur connecté à la création d’un relevé en mode « observers_txt » (#1292)</p></li>
<li><p>Occtax : Déplacement des boutons d’action à gauche dans la liste des taxons d’un relevé pour éviter qu’ils soient masqués quand les noms de taxon sont longs (#1299 et #1337)</p></li>
<li><p>Occtax : Correction de la possibilité de modifier un relevé si U=1 (#1365)</p></li>
<li><p>Occtax : Suppression du zoom quand on localise le relevé (#1317)</p></li>
<li><p>Occtax : Correction du nombre de lignes affichées après une recherche</p></li>
<li><p>Occtax : Correction de la suppression d’un habitat lors de la modification d’un relevé (#1296)</p></li>
<li><p>Occtax : Correction des champs « Habitat » et « Lieu » quand on enchaine des relevés (#1191)</p></li>
<li><p>Occtax : Correction de l’enchainement des saisies (#1300)</p></li>
<li><p>Occtax : Correction de l’affichage des taxons quand le nom est long (#1299, #1337)</p></li>
<li><p>Occtax : Correction de l’observateur par défaut en mode <code class="docutils literal notranslate"><span class="pre">observers_txt</span></code></p></li>
<li><p>Occtax : Correction des messages d’information multiples (#1367)</p></li>
<li><p>Occtax : Correction de la mise à jour du « digitiser » lors d’une édition de relevé (#1392)</p></li>
<li><p>Occtax : Correction du trigger alimentant les observateurs de la synthèse depuis Occtax (#1399)</p></li>
<li><p>Métadonnées : Correction de la suppression d’un JDD sans données, depuis la liste des JDD (#1312)</p></li>
<li><p>Métadonnées : Correction de la récupération des valeurs de nomenclature depuis MTD n’existant pas dans GeoNature (#1297)</p></li>
<li><p>Authentification : Redirection vers la page login après une période d’inactivité (#1193)</p></li>
<li><p>Résolution des problèmes de permission sur le fichier <code class="docutils literal notranslate"><span class="pre">gn_errors.log</span></code> (#1003)</p></li>
</ul>
<p><strong>💻 Développement</strong></p>
<ul class="simple">
<li><p>Possibilité d’utiliser la commande <code class="docutils literal notranslate"><span class="pre">flask</span></code> (eg <code class="docutils literal notranslate"><span class="pre">flask</span> <span class="pre">shell</span></code>)</p></li>
<li><p>Préparation de l’utilisation d’Alembic pour la gestion des migrations de la structure de la BDD (#880)</p></li>
<li><p>Possibilité d’importer des modules packagés (#1272)</p></li>
<li><p>Réorganisation des fichiers <code class="docutils literal notranslate"><span class="pre">requirements</span></code> et installation des branches <code class="docutils literal notranslate"><span class="pre">develop</span></code> des dépendances du fichier <code class="docutils literal notranslate"><span class="pre">requirements-dev.txt</span></code></p></li>
<li><p>Simplification de la gestion des erreurs</p></li>
<li><p>Création de templates pour les configurations Apache de GeoNature, TaxHub et UsersHub, utilisés par le script <code class="docutils literal notranslate"><span class="pre">install_all.sh</span></code></p></li>
<li><p>Ajout du plugon <code class="docutils literal notranslate"><span class="pre">leaflet-image</span></code></p></li>
<li><p>Ajout d’un champs <code class="docutils literal notranslate"><span class="pre">type</span></code> dans la table <code class="docutils literal notranslate"><span class="pre">gn_commons.t_modules</span></code> pour gérer le polymorphisme, utilisé dans le module Monitoring</p></li>
<li><p>Ajout des champs <code class="docutils literal notranslate"><span class="pre">meta_create_date</span></code> et <code class="docutils literal notranslate"><span class="pre">meta_update_date</span></code> dans la table <code class="docutils literal notranslate"><span class="pre">gn_commons.t_modules</span></code></p></li>
<li><p>Diverses améliorations mineures de l’architecture du code</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<p>Si vous mettez à jour GeoNature :</p>
<ul class="simple">
<li><p>Mettez à jour TaxHub 1.8.x avant d’effectuer la mise à jour de GeoNature : <a class="reference external" href="https://github.com/PnX-SI/TaxHub/releases">https://github.com/PnX-SI/TaxHub/releases</a></p></li>
<li><p>Si vous utilisez le module Monitoring, mettez le à jour en version 0.2.4 minimum avant de mettre à jour GeoNature</p></li>
<li><p>Si vous n’aviez pas renseigné de valeur pour le paramètre <code class="docutils literal notranslate"><span class="pre">id_taxon_list</span></code> dans le fichier <code class="docutils literal notranslate"><span class="pre">contrib/occtax/config/conf_gn_module.toml</span></code> du module Occtax, la liste 100 n’est plus passée par defaut et le module va rechercher sur tout Taxref. Si vous souhaitez utiliser une liste de taxons dans la saisie Occtax, veuillez renseigner l’identifiant de votre liste dans la configuration du module</p></li>
<li><p>Vous pouvez passer directement à cette version mais en suivant les notes des versions intermédiaires</p></li>
<li><p>Exécuter le script SQL de mise à jour de la BDD de GeoNature (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.6.2to2.7.0.sql">https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.6.2to2.7.0.sql</a>)</p></li>
<li><p>Le script SQL de mise à jour va supprimer et recréer les vues <code class="docutils literal notranslate"><span class="pre">pr_occtax.v_export_occtax</span></code> et <code class="docutils literal notranslate"><span class="pre">gn_synthese.v_synthese_for_export</span></code> pour y intégrer les champs additionnels. Si vous aviez modifié ces vues, adaptez le script de mise à jour de GeoNature 2.6.2 à 2.7.0, ou répercuter vos modifications après la mise à jour, à appliquer aussi dans votre éventuelle surcouche des paramètres <code class="docutils literal notranslate"><span class="pre">default_columns_export</span></code> (dans <code class="docutils literal notranslate"><span class="pre">contrib/occtax/config/conf_gn_module.toml</span></code>) et <code class="docutils literal notranslate"><span class="pre">EXPORT_COLUMNS</span></code> (dans <code class="docutils literal notranslate"><span class="pre">config/geonature_config.toml</span></code>)</p></li>
<li><p>Le fichier de customisation CSS a été déplacé de <code class="docutils literal notranslate"><span class="pre">frontend/src/custom/custom.scss</span></code> vers <code class="docutils literal notranslate"><span class="pre">frontend/src/assets/custom.css</span></code> pour pouvoir être modifié sans devoir rebuilder l’application. Son déplacement est fait automatiquement lors de la mise à jour de GeoNature. Si vous avez customisé les styles dans ce fichier et notamment fait référence à d’autres fichiers, vérifiez ou adaptez leurs chemins</p></li>
<li><p>Si vous aviez renseigner un des deux paramètres <code class="docutils literal notranslate"><span class="pre">LIST_COLUMNS_FRONTEND</span></code>, <code class="docutils literal notranslate"><span class="pre">COLUMNS_API_VALIDATION_WEB_APP</span></code> dans le module Validation, il est nécessaire de les remplacer par le nouveau paramètre <code class="docutils literal notranslate"><span class="pre">COLUMN_LIST</span></code>. Voir le fichier <code class="docutils literal notranslate"><span class="pre">contrib/gn_module_validation/config/conf_gn_module.toml.example</span></code></p></li>
<li><p>Modifier dans le fichier <code class="docutils literal notranslate"><span class="pre">/etc/supervisor/conf.d/geonature-service.conf</span></code>, remplacer <code class="docutils literal notranslate"><span class="pre">gn_errors.log</span></code> par <code class="docutils literal notranslate"><span class="pre">supervisor.log</span></code> dans la variable <code class="docutils literal notranslate"><span class="pre">stdout_logfile</span></code> :</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s1">&#39;s|\(stdout_logfile = .*\)/gn_errors.log|</span><span class="se">\1</span><span class="s1">/supervisor.log|&#39;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">supervisor</span><span class="o">/</span><span class="n">conf</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">geonature</span><span class="o">-</span><span class="n">service</span><span class="o">.</span><span class="n">conf</span>
<span class="n">sudo</span> <span class="n">supervisorctl</span> <span class="n">reload</span>
</pre></div>
</div>
</section>
<section id="id9">
<h2>2.6.2 (2021-02-15)<a class="headerlink" href="#id9" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Metadonnées : correction d’un bug sur la fiche JDD si le module d’import n’est pas installé</p></li>
<li><p>Metadonnées : correction de l’affichage de certains champs sur la fiche des cadres d’acquisition</p></li>
<li><p>Metadonnées : la recherche rapide n’est plus sensible à la casse casse</p></li>
</ul>
</section>
<section id="id10">
<h2>2.6.1 (2021-02-11)<a class="headerlink" href="#id10" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Correction de la fonction <code class="docutils literal notranslate"><span class="pre">gn_synthese.fct_tri_cal_sensi_diff_level_on_each_statement()</span></code> non compatible avec PostgreSQL 10 (#1255)</p></li>
<li><p>Synthèse : correction de l’affichage du filtre « statut de validation » (#1267)</p></li>
<li><p>Permissions : correction de l’URL de redirection après l’éditiondes permissions (#1253)</p></li>
<li><p>Précision de la documentation de mise à jour de GeoNature (#1251)</p></li>
<li><p>Ajout du paramètre <code class="docutils literal notranslate"><span class="pre">DISPLAY_EMAIL_INFO_OBS</span></code> dans le fichier d’exemple de configuration (#1066 par &#64;jbdesbas)</p></li>
<li><p>Sécurité : suppression d’une route inutile</p></li>
<li><p>Correction de l’URL de la doc sur la page d’accueil</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<p>Si vous mettez à jour GeoNature :</p>
<ul class="simple">
<li><p>Vous pouvez passer directement à cette version mais en suivant les notes des versions intermédiaires</p></li>
<li><p>Exécuter le script de mise à jour de la BDD du sous-module de nomenclature : <a class="reference external" href="https://github.com/PnX-SI/Nomenclature-api-module/blob/master/data/update1.3.5to1.3.6.sql">https://github.com/PnX-SI/Nomenclature-api-module/blob/master/data/update1.3.5to1.3.6.sql</a></p></li>
<li><p>Exécuter ensuite le script SQL de mise à jour de la BDD de GeoNature (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.6.0to2.6.1.sql">https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.6.0to2.6.1.sql</a>)</p></li>
<li><p>Suivez la procédure classique de mise à jour de GeoNature (<a class="reference external" href="http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application">http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application</a>)</p></li>
</ul>
</section>
<section id="saxifraga-2021-02-04">
<h2>2.6.0 - Saxifraga (2021-02-04)<a class="headerlink" href="#saxifraga-2021-02-04" title="Lien permanent vers cette rubrique"></a></h2>
<p>Nécessite Debian 10, car cette nouvelle version nécessite PostgreSQL 10 minimum (qui n’est pas fourni par défaut avec Debian 9) pour les triggers déclenchés « on each statement », plus performants.</p>
<p><strong>🚀 Nouveautés</strong></p>
<ul class="simple">
<li><p>Sensibilité : Ajout d’un trigger sur la synthèse déclenchant automatiquement le calcul de la sensibilité des observations et calculant ensuite leur niveau de diffusion (si celui-ci est NULL) en fonction de la sensibilité (#413 et #871)</p></li>
<li><p>Ajout du format GeoPackage (GPKG) pour les exports SIG, plus simple, plus léger, plus performant et unique que le SHAPEFILE. Les exports au format SHP restent pour le moment utilisés par défaut (modifiable dans la configuration des modules Occtax, Occhab et Synthèse) (#898)</p></li>
<li><p>Performances : Suppression du trigger le plus lourd calculant les couleurs des taxons par unités géographiques. Il est remplacé par une vue utilisant le nouveau paramètre <code class="docutils literal notranslate"><span class="pre">gn_commons.t_parameters.occtaxmobile_area_type</span></code>, définissant le code du type de zonage à utiliser pour les unités géographiques dans Occtax-mobile (Mailles de 5km par défaut) (#997)</p></li>
<li><p>Performances : Amélioration du trigger de la Synthèse calculant les zonages d’une observation en ne faisant un <code class="docutils literal notranslate"><span class="pre">ST_Touches()</span></code> seulement si l’observation n’est pas un point et en le passant <code class="docutils literal notranslate"><span class="pre">on</span> <span class="pre">each</span> <span class="pre">statement</span></code> (#716)</p></li>
<li><p>Métadonnées : Refonte de la liste des CA et JDD avec l’ajout d’informations et d’actions, ainsi qu’une recherche avancée (#889)</p></li>
<li><p>Métadonnées : Révision des fiches info des CA et JDD avec l’ajout d’actions, du tableau des imports et du téléchargement des rapports d’UUID et de sensibilité (#889)</p></li>
<li><p>Métadonnées: Ajout de la fonctionnalité de fermeture (dépot) au niveau du CA (qui ferme tous les JDD du CA), seulement si le CA a au moins un JDD. Désactivée par défaut via le paramètre <code class="docutils literal notranslate"><span class="pre">ENABLE_CLOSE_AF</span></code> (#889 par &#64;alainlaupinmnhn)</p></li>
<li><p>Métadonnées : Possibilité d’envoyer un email automatique au créateur et à l’utilisateur d’un CA quand celui-ci est fermé (#889)</p></li>
<li><p>Métadonnées : Possibilité d’ajouter un titre spécifique aux exports PDF des CA quand ceux-ci sont fermés, par exemple pour en faire un certificat (#889)</p></li>
<li><p>Métadonnées : Possibilité d’importer directement dans un JDD actif depuis le module Métadonnées, désactivé par défaut (#889)</p></li>
<li><p>Métadonnées : Amélioration des possibilités de customisation des PDF des fiches de métadonnées</p></li>
<li><p>Métadonnées : Amélioration des fiches détail des CA et JDD et ajout de la liste des imports dans les fiches des JDD (#889)</p></li>
<li><p>Métadonnées : Ajout d’un spinner lors du chargement de la liste des métadonnées et parallélisation du calcul du nombre de données par JDD (#1231)</p></li>
<li><p>Synthèse : Possibilité d’ouvrir le module avec un JDD préselectionné (<code class="docutils literal notranslate"><span class="pre">&lt;URL_GeoNature&gt;/#/synthese?id_dataset=2</span></code>) et ajout d’un lien direct depuis le module Métadonnées (#889)</p></li>
<li><p>Synthèse : ajout de web service pour le calcul du nombre d’observations par un paramètre donné (JDD, module, observateur), et du calcul de la bounding-box par jeu de données</p></li>
<li><p>Synthese : ajout d’un filtre avancé <code class="docutils literal notranslate"><span class="pre">Possède</span> <span class="pre">médias</span></code></p></li>
<li><p>Exports au format SHP remplacés par défaut par le format GeoPackage (GPKG) plus simple, plus léger, plus performant et unique. Les exports SHP restent activables dans la configuration des modules (#898)</p></li>
<li><p>Occtax : ajout du paramètre <code class="docutils literal notranslate"><span class="pre">DISPLAY_VERNACULAR_NAME</span></code> qui contrôle l’affichage du nom vernaculaire vs nom complet sur les interfaces (Defaut = true: afffiche le nom vernaculaire)</p></li>
<li><p>Validation : Préremplir l’email à l’observateur avec des informations paramétrables sur l’occurrence (date, nom du taxon, commune, médias) (#981)</p></li>
<li><p>Validation : Possibilité de paramètrer les colonnes affichées dans la liste des observations (#980)</p></li>
<li><p>Possibilité de customiser le logo principal (GeoNature par défaut) dans <code class="docutils literal notranslate"><span class="pre">frontend/src/custom/images/</span></code></p></li>
<li><p>Ajout d’un champs json <code class="docutils literal notranslate"><span class="pre">additional_data</span></code> dans la table <code class="docutils literal notranslate"><span class="pre">l_areas</span></code> (#1111)</p></li>
<li><p>Complément des scripts de migration des données depuis GINCO (<code class="docutils literal notranslate"><span class="pre">data/scripts/import_ginco/</span></code>)</p></li>
<li><p>Barre de navigation : Mention plus générique et générale des auteurs et contributeurs</p></li>
<li><p>Redirection vers le formulaire d’authentification si on tente d’accéder à une page directement sans être authentifié et sans passer par le frontend (#1193)</p></li>
<li><p>Connexion à MTD : possibilité de filtrer les JDD par instance, avec le paramètre <code class="docutils literal notranslate"><span class="pre">ID_INSTANCE_FILTER</span></code>, par exemple pour ne récupérer que les JDD de sa région (#1195)</p></li>
<li><p>Connexion à MTD : récupération du créateur et des acteurs (#922, #1008 et #1196)</p></li>
<li><p>Connexion à MTD : récupération du nouveau champs <code class="docutils literal notranslate"><span class="pre">statutDonneesSource</span></code> pour indiquer si le JDD est d’origine publique ou privée</p></li>
<li><p>Création d’une commande GeoNature permettant de récupérer les JDD, CA et acteurs depuis le webservice MTD de l’INPN, en refactorisant les outils existants d’import depuis ce webservice</p></li>
<li><p>Ajout de contraintes d’unicité sur certains champs des tables de métadonnées et de la table des sources (#1215)</p></li>
<li><p>Création d’un script permettant de remplacer les règles de sensibilité nationales et régionales, par les règles départementales plus précises (<code class="docutils literal notranslate"><span class="pre">data/scripts/sensi/import_sensi_depobio.sh</span></code>), uniquement utilisé pour DEPOBIO pour le moment, en attendant de clarifier dans une prochaine release le fonctionnement que l’on retient par défaut dans GeoNature (#413)</p></li>
<li><p>Création d’un script permettant d’importer les régions dans le référentiel géographique (<code class="docutils literal notranslate"><span class="pre">data/migrations/insert_reg.sh</span></code>)</p></li>
</ul>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Occhab : Export SIG (GPKG ou SHP) corrigé (#898)</p></li>
<li><p>Meilleur nettoyage des sessions enregistrées dans le navigateur (#1178)</p></li>
<li><p>Correction des droits CRUVED et de leur héritage (#1170)</p></li>
<li><p>Synthèse : Retour du bouton pour revenir à l’observation dans son module d’origine (Occtax par exemple) depuis la fiche info d’une observation (#1147)</p></li>
<li><p>Synthèse : Suppression du message « Aucun historique de validation » quand une observation n’a pas encore de validation (#1147)</p></li>
<li><p>Synthèse : Correction du CRUVED sur le R = 1 (ajout des JDD de l’utilisateur)</p></li>
<li><p>Synthèse : Correction de l’export des statuts basé sur une recherche géographique (#1203)</p></li>
<li><p>Occtax : Correction de l’erreur de chargement de l’observateur lors de la modification d’un relevé (#1177)</p></li>
<li><p>Occtax : Suppression de l’obligation de remplir les champs « Déterminateur » et « Méthode de détermination »</p></li>
<li><p>Métadonnées : Suppression du graphique de répartition des espèces dans les exports PDF car il était partiellement fonctionnel</p></li>
<li><p>Synthèse : Fonction <code class="docutils literal notranslate"><span class="pre">import_row_from_table</span></code>, test sur <code class="docutils literal notranslate"><span class="pre">LOWER(tbl_name)</span></code></p></li>
<li><p>Redirection vers le formulaire d’authentification si l’on essaie d’accéder à une URL sans être authentifié et sans passer par le frontend (#1193)</p></li>
<li><p>Script d’installation globale : prise en compte du paramètre <code class="docutils literal notranslate"><span class="pre">install_grid_layer</span></code> permettant d’intégrer ou non les mailles dans le <code class="docutils literal notranslate"><span class="pre">ref_geo</span></code> lors de l’installation initiale (#1133)</p></li>
<li><p>Synthèse : Changement de la longueur du champs <code class="docutils literal notranslate"><span class="pre">reference_biblio</span></code> de la table <code class="docutils literal notranslate"><span class="pre">gn_synthese.synthese</span></code> (de 255 à 5000 caractères)</p></li>
<li><p>Sensibilité : Corrections des contraintes NOT VALID (#1245)</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<p>Si vous mettez à jour GeoNature :</p>
<ul class="simple">
<li><p>Vous pouvez passer directement à cette version mais en suivant les notes des versions intermédiaires</p></li>
<li><p>Exécuter ensuite le script SQL de mise à jour de la BDD de GeoNature (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.5.5to2.6.0.sql">https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.5.5to2.6.0.sql</a>)</p></li>
<li><p>Toutes les nouvelles données intégrées dans le Synthèse auront leur niveau de sensibilité et de diffusion calculés automatiquement. Vous pouvez ajouter ou désactiver des règles de sensibilité dans la table <code class="docutils literal notranslate"><span class="pre">gn_sensivity.t_sensitivity_rules</span></code></p></li>
<li><p>Vous pouvez aussi exécuter le script qui va calculer automatiquement le niveau de sensibilité et de diffusion de toutes les données déjà présentes dans la Synthèse, éventuellement en l’adaptant à votre contexte : <a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.5.5to2.6.0-update-sensitivity.sql">https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.5.5to2.6.0-update-sensitivity.sql</a></p></li>
<li><p>Mettez à jour de la longueur du champs <code class="docutils literal notranslate"><span class="pre">gn_synthese.synthese.reference_biblio</span></code> à 5000 charactères. Exécutez la commande suivante dans la console : <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">-u</span> <span class="pre">postgres</span> <span class="pre">psql</span> <span class="pre">-d</span> <span class="pre">geonature2db</span> <span class="pre">-c</span> <span class="pre">&quot;UPDATE</span> <span class="pre">pg_attribute</span> <span class="pre">SET</span> <span class="pre">atttypmod</span> <span class="pre">=</span> <span class="pre">5004</span> <span class="pre">WHERE</span> <span class="pre">attrelid</span> <span class="pre">=</span> <span class="pre">'gn_synthese.synthese'::regclass</span> <span class="pre">AND</span> <span class="pre">attname</span> <span class="pre">=</span> <span class="pre">'reference_biblio';&quot;</span></code></p></li>
<li><p>Exécuter le script de mise à jour de la BDD du sous-module de nomenclature : <a class="reference external" href="https://github.com/PnX-SI/Nomenclature-api-module/blob/master/data/update1.3.4to1.3.5.sql">https://github.com/PnX-SI/Nomenclature-api-module/blob/master/data/update1.3.4to1.3.5.sql</a></p></li>
<li><p>Suivez la procédure classique de mise à jour de GeoNature (<a class="reference external" href="http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application">http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application</a>)</p></li>
<li><p>Si vous utilisez Occtax-mobile, vous pouvez modifier la valeur du nouveau paramètre <code class="docutils literal notranslate"><span class="pre">gn_commons.t_parameters.occtaxmobile_area_type</span></code> pour lui indiquer le code du type de zonage que vous utilisez pour les unités géographiques (mailles de 5km par défaut)</p></li>
<li><p>Si vous disposez du module d’import, vous devez le mettre à jour en version 1.1.1</p></li>
</ul>
</section>
<section id="id11">
<h2>2.5.5 (2020-11-19)<a class="headerlink" href="#id11" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🚀 Nouveautés</strong></p>
<ul class="simple">
<li><p>Ajout d’un composant fil d’ariane (#1143)</p></li>
<li><p>Ajout de la possiblité de désactiver les composants <code class="docutils literal notranslate"><span class="pre">pnx-taxa</span></code> et <code class="docutils literal notranslate"><span class="pre">pnx-areas</span></code> (#1142)</p></li>
<li><p>Ajout de tests sur les routes pour assurer la compatibilité avec les applications mobiles</p></li>
</ul>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Correction d’un bug de récupération du CRUVED sur les modules (#1146)</p></li>
<li><p>Correction des validateurs sur les preuves d’existence (#1134)</p></li>
<li><p>Correction de la récupération des dossiers dans <code class="docutils literal notranslate"><span class="pre">backend/static</span></code> dans le script <code class="docutils literal notranslate"><span class="pre">migrate.sh</span></code></p></li>
<li><p>Correction de l’affichage de l’utilisateur dans la navbar lorsqu’on est connecté via le CAS INPN</p></li>
</ul>
</section>
<section id="id12">
<h2>2.5.4 (2020-11-17)<a class="headerlink" href="#id12" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🚀 Nouveautés</strong></p>
<ul class="simple">
<li><p>Ajout de scripts <code class="docutils literal notranslate"><span class="pre">sql</span></code> et <code class="docutils literal notranslate"><span class="pre">sh</span></code> de restauration des medias dans <code class="docutils literal notranslate"><span class="pre">data/medias</span></code> (#1148)</p></li>
<li><p>Ajout d’un service pour pouvoir récupérer les informations sur l’utilisateur connecté</p></li>
</ul>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Correction des médias qui sont actuellement tous supprimés automatiquement après 24h, et non pas seulement ceux orphelins (#1148)</p></li>
<li><p>Correction des permissions sur les fiches info des relevés dans Occtax avec la désactivation du bouton de modification du relevé quand l’utilisateur n’en a pas les droits</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<ul class="simple">
<li><p>Si vous aviez associé des médias à des observations dans Occtax ou autre et qu’ils ont été supprimés, vous pouvez les retrouver dans la table d’historisation des actions (<code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span> <span class="pre">FROM</span> <span class="pre">gn_commons.t_history_actions</span> <span class="pre">WHERE</span> <span class="pre">table_content-&gt;'id_media'</span> <span class="pre">IS</span> <span class="pre">NOT</span> <span class="pre">NULL</span> <span class="pre">AND</span> <span class="pre">operation_type</span> <span class="pre">=</span> <span class="pre">'D'</span></code>)</p></li>
<li><p>Pour restaurer les médias supprimés depuis la table <code class="docutils literal notranslate"><span class="pre">gn_commons.t_history_actions</span></code> vous pouvez :</p>
<ul>
<li><p>exécuter le script SQL <code class="docutils literal notranslate"><span class="pre">data/medias/restore_medias.sql</span></code> qui va recréer les médias supprimés dans la table <code class="docutils literal notranslate"><span class="pre">gn_commons.t_medias</span></code></p></li>
<li><p>exécuter le script BASH <code class="docutils literal notranslate"><span class="pre">data/medias/restore_medias.sh</span></code> (<code class="docutils literal notranslate"><span class="pre">bash</span> <span class="pre">/home/`whoami`/geonature/data/medias/restore_medias.sh</span></code> en <code class="docutils literal notranslate"><span class="pre">sudo</span></code> si besoin) qui va renommer des fichiers supprimés en supprimant le préfixe <code class="docutils literal notranslate"><span class="pre">deleted_</span></code></p></li>
</ul>
</li>
</ul>
</section>
<section id="id13">
<h2>2.5.3 (2020-11-04)<a class="headerlink" href="#id13" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🚀 Nouveautés</strong></p>
<ul class="simple">
<li><p>Mise en place de l’héritage du CRUVED au niveau des objets des modules (#1028)</p></li>
<li><p>Révision de l’export des observations de la Synthèse (noms plus lisibles, ajout des communes et d’informations taxonomiques, complément des champs existants (#755)</p></li>
<li><p>Ajout d’un paramètre permettant d’ajouter un message personnalisé à la fin des emails (inscriptions, exports…) (#1050 par &#64;jpm-cbna)</p></li>
<li><p>Ajout d’une alerte de dépréciation sur les fonctions <code class="docutils literal notranslate"><span class="pre">utils-sqlalchemy</span></code> présentes dans GeoNature</p></li>
<li><p>Ajout d’un widget de type « HTML » dans les formulaires dynamiques, permettant d’ajouter des informations dans un formulaire (#1043 et #1068 par &#64;jpm-cbna)</p></li>
<li><p>Ajout de la possibilité d’ajouter un texte d’aide sur les champs des formulaires dynamiques (#1065 par &#64;jpm-cbna)</p></li>
<li><p>Ajout de la possibilité de définir un min et un max au composant commun <code class="docutils literal notranslate"><span class="pre">date</span></code> (#1069 par &#64;jpm-cbna)</p></li>
<li><p>Ajout de la possibilité de définir le nombre de lignes du composant commun <code class="docutils literal notranslate"><span class="pre">textarea</span></code> (#1067 par &#64;jpm-cbna)</p></li>
<li><p>Ajout de la possibilité de contrôler par une expression régulière le contenu d’un champs de type <code class="docutils literal notranslate"><span class="pre">text</span></code> des formulaires dynamiques (#1073 par &#64;FlorentRICHARD44)</p></li>
<li><p>Ajout de la possibilité de masquer certains champs du composant <code class="docutils literal notranslate"><span class="pre">media</span></code> (#1072, #1078 et #1083 par &#64;metourneau)</p></li>
<li><p>Ajout d’un spinner sur les statistiques de la page d’accueil (#1086 par &#64;jpm-cbna)</p></li>
<li><p>Ajout d’un composant d’autocomplete multiselect <code class="docutils literal notranslate"><span class="pre">pnx-taxa</span></code> permettant de rechercher des taxons dans tout l’arbre taxonomique et de limiter la recherche à un rang</p></li>
<li><p>Possibilité d’ajouter plusieurs cartes sur la même page à l’aide du composant <code class="docutils literal notranslate"><span class="pre">pnx-map</span></code></p></li>
<li><p>Homogénéisation du style du code et documentation des pratiques de développement</p></li>
</ul>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Correction de l’affichage des noms des validateurs sur la liste dans le module validation (#1091 par &#64;lpofredc)</p></li>
<li><p>Corrections mineures de l’export des observations de la Synthèse (#1108)</p></li>
<li><p>Synthèse : Correction du masquage de la recherche par arbre taxonomique (#1057 par &#64;jpm-cbna)</p></li>
<li><p>Ajout du champs <code class="docutils literal notranslate"><span class="pre">id_nomenclature_biogeo_status</span></code> dans la Synthese (correspondance standard : statut biogéographique). La BDD est remplie avec la valeur par défaut de la table <code class="docutils literal notranslate"><span class="pre">gn_synthese.default_nomenclature_value</span></code> (valeur = non renseignée)</p></li>
<li><p>Accueil : Correction de l’affichage du nom du module (#1087)</p></li>
<li><p>Correction du trigger de mise à jour d’Occtax vers la Synthèse (champs <code class="docutils literal notranslate"><span class="pre">the_geom_local</span></code> non mis à jour) (#1117 par &#64;jbrieuclp)</p></li>
<li><p>Correction du paramètre stockant la version de Taxref, passé à 13.0 pour les nouvelles installations (#1097 par &#64;RomainBaghi)</p></li>
<li><p>Correction de l’affichage en double des markers dans Leaflet.draw (#1095 par &#64;FlorentRICHARD44)</p></li>
<li><p>Synthèse : Correction des filtres avancés par technique d’observation et méthode de détermination (#1110 par &#64;jbrieuclp)</p></li>
<li><p>Recréation du fichier de configuration à chaque installation (#1074 par &#64;etot)</p></li>
<li><p>Annulation de l’insertion du module lorsqu’une erreur est levée à l’installation d’un module</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<ul class="simple">
<li><p>Désormais les objets des modules (par exemple les objets “Permissions” et “Nomenclatures” du module “ADMIN”) héritent automatiquement des permissions définies au niveau du module parent et à défaut au niveau de GeoNature  (#1028). Il s’agit d’une évolution de mise en cohérence puisque les modules héritaient déjà des permissions de GeoNature, mais pas leurs objets. Si vous avez défini des permissions particulières aux niveaux des objets, vérifier leur cohérence avec le nouveau fonctionnement. NB : si vous aviez mis des droits R=0 pour un groupe au module “ADMIN”, les utilisateurs de ce groupe ne pourront pas accéder aux sous-modules “permissions” et “nomenclatures”.</p></li>
<li><p>Exécuter ensuite le script SQL de mise à jour de la BDD de GeoNature (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.5.2to2.5.3.sql">https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.5.2to2.5.3.sql</a>). Attention, si vous avez customisé les vues des exports Occtax et Synthèse, elles seront supprimées et recrées automatiquement par le script SQL de mise à jour de la BDD de GeoNature pour intégrer leurs évolutions réalisées dans cette nouvelle version. Révisez éventuellement ces vues avant et/ou après la mise à jour.</p></li>
<li><p>Suivez la procédure classique de mise à jour de GeoNature (<a class="reference external" href="http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application">http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application</a>).</p></li>
<li><p>Les noms de colonnes de l’export de la Synthèse ont été entièrement revus dans la vue fournie par défaut (<code class="docutils literal notranslate"><span class="pre">gn_synthese.v_synthese_for_export</span></code>). Si vous aviez surcouché le paramètre <code class="docutils literal notranslate"><span class="pre">EXPORT_COLUMNS</span></code> dans le fichier <code class="docutils literal notranslate"><span class="pre">config/geonature_config.toml</span></code>, vérifiez les noms des colonnes.</p></li>
<li><p>Vérifiez que la valeur du paramètre <code class="docutils literal notranslate"><span class="pre">taxref_version</span></code> dans la table <code class="docutils literal notranslate"><span class="pre">gn_commons.t_parameters</span></code> correspond bien à votre version actuelle de Taxref (11.0 ou 13.0).</p></li>
</ul>
</section>
<section id="id14">
<h2>2.5.2 (2020-10-13)<a class="headerlink" href="#id14" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Occtax : correction du problème d’installation du module dans le fichier <code class="docutils literal notranslate"><span class="pre">schemas.py</span></code></p></li>
<li><p>Synthese : correction de la fonctions SQL <code class="docutils literal notranslate"><span class="pre">gn_synthese.import_row_from_table</span></code> et répercussion dans le fichier <code class="docutils literal notranslate"><span class="pre">gn_synthese/process.py</span></code></p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<p>Si vous mettez à jour GeoNature :</p>
<ul class="simple">
<li><p>Vous pouvez passer directement à cette version mais en suivant les notes des versions intermédiaires</p></li>
<li><p>Exécuter ensuite le script SQL de mise à jour de la BDD de GeoNature (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.5.1to2.5.2.sql">https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.5.1to2.5.2.sql</a>)</p></li>
</ul>
</section>
<section id="id15">
<h2>2.5.1 (2020-10-06)<a class="headerlink" href="#id15" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Ajout d’un paramètre <code class="docutils literal notranslate"><span class="pre">DISPLAY_EMAIL_INFO_OBS</span></code> définissant si les adresses email des observateurs sont affichées ou non dans les fiches info des observations des modules Synthèse et Validation (#1066)</p></li>
<li><p>Occtax : correction de l’affichage du champs « Technique de collecte Campanule » (#1059)</p></li>
<li><p>Occtax : correction du fichier d’exemple de configuration <code class="docutils literal notranslate"><span class="pre">contrib/occtax/config/conf_gn_module.toml.example</span></code> (#1059)</p></li>
<li><p>Occtax : paramètre <code class="docutils literal notranslate"><span class="pre">DISPLAY_SETTINGS_TOOLS</span></code> renommé <code class="docutils literal notranslate"><span class="pre">ENABLE_SETTINGS_TOOLS</span></code> et désactivé par défaut (#1060)</p></li>
<li><p>Occtax : quand le paramètre <code class="docutils literal notranslate"><span class="pre">ENABLE_SETTINGS_TOOLS</span></code> est désactivé, remise en place du fonctionnement de l’outil « Echainer les relevés ». Dans ce cas, quand on enchaine les relevés, on conserve le JDD, les observateurs, les dates et heures d’un relevé à l’autre (#1060)</p></li>
<li><p>Occtax : correction de l’observateur par défaut en mode <code class="docutils literal notranslate"><span class="pre">observers_as_txt</span></code></p></li>
<li><p>Verification des UUID : autoriser toutes les versions (#1063)</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<p>Si vous mettez à jour GeoNature :</p>
<ul class="simple">
<li><p>Vous pouvez passer directement à cette version mais en suivant les notes des versions intermédiaires</p></li>
</ul>
</section>
<section id="manidae-2020-09-30">
<h2>2.5.0 - Manidae (2020-09-30)<a class="headerlink" href="#manidae-2020-09-30" title="Lien permanent vers cette rubrique"></a></h2>
<p>Occtax v2 et médias</p>
<p><strong>🚀 Nouveautés</strong></p>
<ul class="simple">
<li><p>Refonte de l’ergonomie et du fonctionnement du module de saisie Occtax (#758 et #860 par &#64;jbrieuclp et &#64;TheoLechemia)</p>
<ul>
<li><p>Enregistrement continu au fur et à mesure de la saisie d’un relevé</p></li>
<li><p>Découpage en 2 onglets (Un pour le relevé et un onglet pour les taxons)</p></li>
<li><p>Amélioration de la liste des taxons saisis sur un relevé (#635 et #682)</p></li>
<li><p>Amélioration de la saisie au clavier</p></li>
<li><p>Zoom réalisé dans la liste des relevé conservé quand on saisit un nouveau relevé (#436 et #912)</p></li>
<li><p>Filtres conservés quand on revient à la liste des relevés (#772)</p></li>
<li><p>Possibilité de conserver les informations saisies entre 2 taxons ou relevés, désactivable avec le paramètre <code class="docutils literal notranslate"><span class="pre">DISPLAY_SETTINGS_TOOLS</span></code> (#692)</p></li>
<li><p>Correction de la mise à jour des dates de début et de fin (#977)</p></li>
<li><p>Affichage d’une alerte si on saisit 2 fois le même taxon sur un même relevé</p></li>
<li><p>Fiche d’information d’un relevé complétée et mise à jour</p></li>
</ul>
</li>
<li><p>Passage de la version 1.2.1 à la version 2.0.0 du standard Occurrences de taxon (dans les modules Occtax, Synthèse et Validation) (#516)</p>
<ul>
<li><p>Ajout des champs « Comportement », « NomLieu », « Habitat », « Méthode de regroupement », « Type de regroupement » et « Profondeur »</p></li>
<li><p>Ajout du champs « Précision » dans Occtax et suppression de sa valeur par défaut à 100 m</p></li>
<li><p>Renommage du champs « Méthode d’observation » en « Technique d’observation »</p></li>
<li><p>Suppression du champs « Technique d’observation » actuel de la synthèse</p></li>
<li><p>Renommage du champs « Technique d’observation » actuel d’Occtax en « Technique de collecte Campanule »</p></li>
<li><p>Ajout et mise à jour de quelques nomenclatures</p></li>
<li><p>Ajout d’un document de suivi de l’implémentation du standard Occurrences de taxon dans GeoNature (<code class="docutils literal notranslate"><span class="pre">docs/implementation_gn_standard_occtax2.0.ods</span></code>) (#516)</p></li>
</ul>
</li>
<li><p>Passage de la version 1.3.9 à la version 1.3.10 du standard de Métadonnées. Mise à jour des nomenclatures « CA_OBJECTIFS » et mise à jour des métadonnées existantes en conséquence (par &#64;DonovanMaillard)</p></li>
<li><p>Ajout d’un champs <code class="docutils literal notranslate"><span class="pre">addtional_data</span></code> de type <code class="docutils literal notranslate"><span class="pre">jsonb</span></code> dans la table <code class="docutils literal notranslate"><span class="pre">gn_synthese.synthese</span></code>, en prévision de l’ajout des champs additionnels dans Occtax et Synthèse (#1007)</p></li>
<li><p>Mise en place de la gestion transversale et générique des médias (images, audios, vidéos, PDF…) dans <code class="docutils literal notranslate"><span class="pre">gn_commons.t_medias</span></code> et le Dynamic-Form (#336) et implémentation dans le module Occtax (désactivables avec le paramètre <code class="docutils literal notranslate"><span class="pre">ENABLE_MEDIAS</span></code>) (#620 par &#64;joelclems)</p></li>
<li><p>Mise en place de miniatures et d’aperçus des médias, ainsi que de nombreux contrôles des fichiers et de leurs formats</p></li>
<li><p>Affichage des médias dans les fiches d’information des modules de saisie, ainsi que dans les modules Synthèse et Validation</p></li>
<li><p>Ajout de la fonctionnalité « Mes lieux » (<code class="docutils literal notranslate"><span class="pre">gn_commons.t_places</span></code>), permettant de stocker la géométrie de ieux individuels fréquemment utilisés, implémentée dans le module cartographique d’Occtax (désactivable avec le paramètre <code class="docutils literal notranslate"><span class="pre">ENABLE_MY_PLACES</span></code>) (#246 par &#64;metourneau)</p></li>
<li><p>Tri de l’ordre des modules dans le menu latéral par ordre alphabétique par défaut et possibilité de les ordonner avec le nouveau champs <code class="docutils literal notranslate"><span class="pre">gn_commons.t_modules.module_order</span></code> (#787 par &#64;alainlaupinmnhn)</p></li>
<li><p>Arrêt du support de l’installation packagée sur Debian 9 et Ubuntu 16 pour passer à Python version 3.6 et plus</p></li>
<li><p>Prise en charge de PostGIS 3 et notamment l’installation de l’extension <code class="docutils literal notranslate"><span class="pre">postgis_raster</span></code> (#946 par &#64;jpm-cbna)</p></li>
<li><p>Création de compte : Envoi automatique d’un email à l’utilisateur quand son compte est validé. Nécessite la version 2.1.3 de UsersHub (#862 et #1035 par &#64;jpm-cbna)</p></li>
</ul>
<p><strong>Ajouts mineurs</strong></p>
<ul class="simple">
<li><p>Homogénéisation des styles des boutons (#1026)</p></li>
<li><p>Factorisation du code des fiches infos d’une observation dans les modules Synthèse et Validation (#1053)</p></li>
<li><p>Métadonnées : Ajout d’un paramètre permettant de définir le nombre de CA affichés sur la page (100 par défaut)</p></li>
<li><p>Métadonnées : Tri des CA et JDD par ordre alphabétique</p></li>
<li><p>Métadonnées : Ajout d’un champs <code class="docutils literal notranslate"><span class="pre">id_digitiser</span></code> dans la table des CA et des JDD, utilisé en plus des acteurs pour le CRUVED des JDD (#921)</p></li>
<li><p>Dynamic-Form : Ajout d’un composant « select » prenant une API en entrée (#1029)</p></li>
<li><p>Dynamic-Form : Ajout de la possibilité d’afficher une définition d’un champs sous forme de tooltip</p></li>
<li><p>CAS INPN : Redirection vers la page de connexion de GeoNature quand on se déconnecte</p></li>
<li><p>Ajout d’une contrainte d’unicité sur <code class="docutils literal notranslate"><span class="pre">schema_name</span></code> et <code class="docutils literal notranslate"><span class="pre">table_name</span></code> sur la table <code class="docutils literal notranslate"><span class="pre">gn_commons_bib_tables_location_unique</span></code> (#962)</p></li>
<li><p>Ajout d’une contrainte d’unicité sur <code class="docutils literal notranslate"><span class="pre">id_organism</span></code> et <code class="docutils literal notranslate"><span class="pre">parameter_name</span></code> dans la table <code class="docutils literal notranslate"><span class="pre">gn_commons.t_parameters</span></code> (#988)</p></li>
<li><p>Ajout de la possibilité de filtrer le composant <code class="docutils literal notranslate"><span class="pre">dataset</span></code> du Dynamic-Form par <code class="docutils literal notranslate"><span class="pre">module_code</span></code> pour pouvoir choisir parmis les JDD associées à un module (#964)</p></li>
<li><p>Mise à jour de <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code> en version 2.8.5, sqlalchemy en 1.3.19, marshmallow en 2.15.6, virtualenv en 20.0.31 (par &#64;jpm-cbna)</p></li>
<li><p>Mises à jour de sécurité diverses</p></li>
<li><p>Améliorations des scripts <code class="docutils literal notranslate"><span class="pre">install/install_db.sh</span></code> et <code class="docutils literal notranslate"><span class="pre">install/install_app.sh</span></code> (par &#64;jpm-cbna)</p></li>
<li><p>Ajout de l’autocomplétion des commandes <code class="docutils literal notranslate"><span class="pre">geonature</span></code> (#999 par &#64;jpm-cbna)</p></li>
<li><p>Suppression du fichier <code class="docutils literal notranslate"><span class="pre">backend/gunicorn_start.sh.sample</span></code></p></li>
<li><p>Amélioration du script <code class="docutils literal notranslate"><span class="pre">install/migration/migration.sh</span></code> en vérifiant la présence des dossiers optionnels avant de les copier</p></li>
<li><p>Amélioration des fonctions <code class="docutils literal notranslate"><span class="pre">gn_synthese.import_json_row_format_insert_data</span></code> et <code class="docutils literal notranslate"><span class="pre">gn_synthese.import_json_row</span></code> pour prendre en charge la génération des geojson dans PostGIS 3</p></li>
<li><p>Documentation administrateur : Précisions sur les labels, pictos et ordres des modules dans le menu de navigation latéral</p></li>
</ul>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Module Validation : Affichage des commentaires du relevé et de l’observation (#978 et #854)</p></li>
<li><p>Module Validation : Ne lister que les observations ayant un UUID et vérification de sa validité (#936)</p></li>
<li><p>Module Validation : Correction et homogénéisation de l’affichage et du tri des observations par date (#971)</p></li>
<li><p>Module Validation : Correction de l’affichage du statut de validation après mise à jour dans la liste des observations (#831)</p></li>
<li><p>Module Validation : Correction de l’affichage du nom du validateur</p></li>
<li><p>Module Validation : Amélioration des performances avec l’ajout d’un index sur le champs <code class="docutils literal notranslate"><span class="pre">uuid_attached_row</span></code> de la table <code class="docutils literal notranslate"><span class="pre">gn_commons.t_validations</span></code> (#923 par &#64;jbdesbas)</p></li>
<li><p>Suppression du trigger en double <code class="docutils literal notranslate"><span class="pre">tri_insert_synthese_cor_role_releves_occtax</span></code> sur <code class="docutils literal notranslate"><span class="pre">pr_occtax.cor_role_releves_occtax</span></code> (#762 par &#64;jbrieuclp)</p></li>
<li><p>Passage des requêtes d’export de la synthèse en POST plutôt qu’en GET (#883)</p></li>
<li><p>Correction du traitement du paramètre <code class="docutils literal notranslate"><span class="pre">offset</span></code> de la route <code class="docutils literal notranslate"><span class="pre">synthese/color_taxon</span></code> utilisé par Occtax-mobile (#994)</p></li>
<li><p>Correction et complément des scripts de migration de données depuis GINCO v1 (<code class="docutils literal notranslate"><span class="pre">data/scripts/import_ginco/occtax.sql</span></code>)</p></li>
<li><p>Import des utilisateurs depuis le CAS INPN : Activer les utilisateurs importés par défaut et récupérer leur email</p></li>
<li><p>Calcul automatique de la sensibilité : Ajout de la récursivité dans la récupération des critères de sensibilité au niveau de la fonction <code class="docutils literal notranslate"><span class="pre">gn_sensitivity.get_id_nomenclature_sensitivity</span></code> (#284)</p></li>
<li><p>Typo sur le terme « Preuve d’existence » (par &#64;RomainBaghi)</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<p>Si vous mettez à jour GeoNature :</p>
<ul class="simple">
<li><p>Nomenclatures : Commencer par exécuter le script SQL de mise à jour du schéma <code class="docutils literal notranslate"><span class="pre">ref_nomenclatures</span></code> de la BDD (<a class="reference external" href="https://github.com/PnX-SI/Nomenclature-api-module/blob/master/data/update1.3.3to1.3.4.sql">https://github.com/PnX-SI/Nomenclature-api-module/blob/master/data/update1.3.3to1.3.4.sql</a>)</p></li>
<li><p>Exécuter ensuite le script SQL de mise à jour de la BDD de GeoNature (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.4.1to2.5.0.sql">https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.4.1to2.5.0.sql</a>). Attention, si vous avez customisé les vues des exports Occtax et Synthèse, elles seront supprimées et recrées automatiquement par le script SQL de mise à jour de la BDD de GeoNature pour s’adapter aux évolutions du standard Occtax en version 2.0.0. Révisez éventuellement ces vues avant et/ou après la mise à jour. Le script SQL de mise à jour vérifiera aussi si vous avez d’autres vues (dans le module Export notamment) qui utilisent le champs <code class="docutils literal notranslate"><span class="pre">id_nomenclature_obs_technique</span></code> qui doit être renommé et l’indiquera dès le début de l’exécution du script, en l’arrêtant pour que vous puissiez modifier ou supprimer ces vues bloquant la mise à jour.</p></li>
<li><p>Les colonnes de l’export de la Synthèse ont été partiellement revus dans la vue fournie par défaut (<code class="docutils literal notranslate"><span class="pre">gn_synthese.v_synthese_for_export</span></code>). Si vous aviez surcouché le paramètre <code class="docutils literal notranslate"><span class="pre">EXPORT_COLUMNS</span></code> dans le fichier <code class="docutils literal notranslate"><span class="pre">config/geonature_config.toml</span></code>, vérifiez les noms des colonnes.</p></li>
<li><p>A partir la version 2.5.0 de GeoNature, la version 3.5 de Python n’est plus supportée. Seules les versions 3.6 et + le sont. Si vous êtes encore sur Debian 9 (fourni par défaut avec Python 3.5), veuillez suivre les instructions de mise à jour de Python sur cette version (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/docs/installation-standalone.rst#python-37-sur-debian-9">https://github.com/PnX-SI/GeoNature/blob/master/docs/installation-standalone.rst#python-37-sur-debian-9</a>). Il est cependant plutôt conseillé de passer sur Debian 10 pour rester à jour sur des versions maintenues</p></li>
<li><p>Suivez la procédure classique de mise à jour de GeoNature (<a class="reference external" href="http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application">http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application</a>)</p></li>
<li><p>A noter, quelques changements dans les paramètres du module Occtax. Les paramètres d’affichage/masquage des champs du formulaire ont évolué ainsi :</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">obs_meth</span></code> devient <code class="docutils literal notranslate"><span class="pre">obs_tech</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">obs_technique</span></code> devient <code class="docutils literal notranslate"><span class="pre">tech_collect</span></code></p></li>
</ul>
</li>
<li><p>A noter aussi que cette version de GeoNature est compatible avec la version 1.1.0 minimum d’Occtax-mobile (du fait de la mise du standard Occurrence de taxons)</p></li>
</ul>
</section>
<section id="id16">
<h2>2.4.1 (2020-06-25)<a class="headerlink" href="#id16" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🚀 Nouveautés</strong></p>
<ul class="simple">
<li><p>Occurrences sans géométrie précise : Ajout d’un champs <code class="docutils literal notranslate"><span class="pre">id_area_attachment</span></code> dans la table <code class="docutils literal notranslate"><span class="pre">gn_synthese.synthese</span></code> permettant d’associer une observation à un zonage dans le référentiel géographique (<code class="docutils literal notranslate"><span class="pre">ref_geo.l_areas.id_area</span></code>) (#845 et #867)</p></li>
<li><p>Ajout d’un champs <code class="docutils literal notranslate"><span class="pre">geojson_4326</span></code> dans la table <code class="docutils literal notranslate"><span class="pre">ref_geo.l_areas</span></code> pour pouvoir afficher les zonages du référentiel géographique sur les cartes (#867)</p></li>
<li><p>Ajout de l’import par défaut des départements de France métropole dans le référentiel géographique lors de l’installation de GeoNature (en plus des actuelles communes et grilles)</p></li>
<li><p>Mise à jour des communes importées sur la version de février 2020 d’Admin express IGN pour les nouvelles installations</p></li>
</ul>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Correction d’un bug d’affichage des fonds de carte WMTS de l’IGN, apparu dans la version 2.4.0 avec l’ajout du support des fonds WMS (#890)</p></li>
<li><p>Gestion des exceptions de type <code class="docutils literal notranslate"><span class="pre">FileNotFoundError</span></code> lors de l’import des commandes d’un module</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<p>Si vous mettez à jour GeoNature :</p>
<ul class="simple">
<li><p>Vous pouvez passer directement à cette version mais en suivant les notes des versions intermédiaires</p></li>
<li><p>Exécuter le script SQL de mise à jour de la BDD de GeoNature : <a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.4.0to2.4.1.sql">https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.4.0to2.4.1.sql</a></p></li>
<li><p>Suivez la procédure classique de mise à jour de GeoNature (<a class="reference external" href="http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application">http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application</a>)</p></li>
<li><p>Vous pouvez alors lancer le script d’insertion des départements de France métropole dans le réferentiel géographique (optionnel) : <a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.4.0to2.4.1_insert_departments.sh">https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.4.0to2.4.1_insert_departments.sh</a>. Vérifier le déroulement de l’import dans le fichier <code class="docutils literal notranslate"><span class="pre">var/log/insert_departements.log</span></code></p></li>
</ul>
</section>
<section id="fiches-de-metadonnees-2020-06-22">
<h2>2.4.0 - Fiches de métadonnées (2020-06-22)<a class="headerlink" href="#fiches-de-metadonnees-2020-06-22" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🚀 Nouveautés</strong></p>
<ul class="simple">
<li><p>Métadonnées : Ajout d’une fiche pour chaque jeu de données et cadres d’acquisition, incluant une carte de l’étendue des observations et un graphique de répartition des taxons par Groupe INPN (#846 par &#64;FloVollmer)</p></li>
<li><p>Métadonnées : Possibilité d’exporter les fiches des JDD et des CA en PDF, générés par le serveur avec WeasyPrint. Logo et entêtes modifiables dans le dossier <code class="docutils literal notranslate"><span class="pre">backend/static/images/</span></code> (#882 par &#64;FloVollmer)</p></li>
<li><p>Métadonnées : Implémentation du CRUVED sur la liste des CA et JDD (#911)</p></li>
<li><p>Métadonnées : Affichage de tous les CA des JDD pour lequels l’utilisateur connecté a des droits (#908)</p></li>
<li><p>Compatible avec TaxHub 1.7.0 qui inclut notamment la migration (optionnelle) vers Taxref version 13</p></li>
<li><p>Installation globale migrée de Taxref version 11 à 13</p></li>
<li><p>Synthèse et zonages : Ne pas inclure l’association aux zonages limitrophes d’une observation quand sa géométrie est égale à un zonage (maille, commune…) (#716 par &#64;jbdesbas)</p></li>
<li><p>Synthèse : Ajout de la possibilité d’activer la recherche par observateur à travers une liste, avec ajout des paramètres <code class="docutils literal notranslate"><span class="pre">SEARCH_OBSERVER_WITH_LIST</span></code> (<code class="docutils literal notranslate"><span class="pre">False</span></code> par défaut) et <code class="docutils literal notranslate"><span class="pre">ID_SEARCH_OBSERVER_LIST</span></code> (#834 par &#64;jbrieuclp)</p></li>
<li><p>Synthèse : Amélioration de la recherche des observateurs. Non prise en compte de l’ordre des noms saisis (#834 par &#64;jbrieuclp)</p></li>
<li><p>Synthèse : Ajout de filtres avancés (<code class="docutils literal notranslate"><span class="pre">Saisie</span> <span class="pre">par</span></code> basé sur <code class="docutils literal notranslate"><span class="pre">id_digitiser</span></code>, <code class="docutils literal notranslate"><span class="pre">Commentaire</span></code> du relevé et de l’occurrence, <code class="docutils literal notranslate"><span class="pre">Déterminateur</span></code>) (#834 par &#64;jbrieuclp)</p></li>
<li><p>Occtax : Création d’un trigger générique de calcul de l’altitude qui n’est exécuté que si l’altitude n’est pas postée (#848)</p></li>
<li><p>Ajout d’une table <code class="docutils literal notranslate"><span class="pre">gn_commons.t_mobile_apps</span></code> permettant de lister les applications mobiles, l’URL de leur APK et d’une API pour interroger le contenu de cette table. Les fichiers des applications et leurs fichiers de configurations peuvent être chargés dans le dossier <code class="docutils literal notranslate"><span class="pre">backend/static/mobile</span></code> (#852)</p></li>
<li><p>Ajout d’un offset et d’une limite sur la route de la couleur des taxons (utilisée uniquement par Occtax-mobile actuellement)</p></li>
<li><p>Support des fonds de carte au format WMS (<a class="reference external" href="https://leafletjs.com/reference-1.6.0.html#tilelayer-wms-l-tilelayer-wms">https://leafletjs.com/reference-1.6.0.html#tilelayer-wms-l-tilelayer-wms</a>), (#890 par &#64;jbdesbas)</p></li>
<li><p>Ajout d’un champs texte <code class="docutils literal notranslate"><span class="pre">reference_biblio</span></code> dans la table <code class="docutils literal notranslate"><span class="pre">gn_synthese</span></code></p></li>
<li><p>Amélioration des perfomances du module de validation, en revoyant la vue <code class="docutils literal notranslate"><span class="pre">gn_commons.v_synthese_validation_forwebapp</span></code>, en revoyant les requêtes et en générant le GeoJSON au niveau de la BDD (#923)</p></li>
<li><p>Ajout d’une fonction SQL d’insertion de données dans la synthese (et une fonction python associée)</p></li>
<li><p>Compléments de la documentation (Permissions des utilisateurs, Occhab…)</p></li>
<li><p>Ajout de scripts de migration des données de GINCO1 vers GeoNature (<code class="docutils literal notranslate"><span class="pre">data/scripts/import_ginco</span></code>)</p></li>
<li><p>Trigger Occtax vers Synthèse : Amélioration du formatage des heures avec <code class="docutils literal notranslate"><span class="pre">date_trunc()</span></code> dans la fonction <code class="docutils literal notranslate"><span class="pre">pr_occtax.insert_in_synthese()</span></code> (#896 par &#64;jbdesbas)</p></li>
<li><p>Barre de navigation : Clarification de l’icône d’ouverture du menu, ajout d’un paramètre <code class="docutils literal notranslate"><span class="pre">LOGO_STRUCTURE_FILE</span></code> permettant de changer le nom du fichier du logo de l’application (#897 par &#64;jbrieuclp)</p></li>
<li><p>Médias : Amélioration des fonctions backend</p></li>
<li><p>Mise à jour de jQuery en version 3.5.0</p></li>
<li><p>Suppression de la table <code class="docutils literal notranslate"><span class="pre">gn_synthese.taxons_synthese_autocomplete</span></code> et du trigger sur la Synthèse qui la remplissait pour utiliser la vue matérialisée <code class="docutils literal notranslate"><span class="pre">taxonomie.vm_taxref_list_forautocomplete</span></code> listant les noms de recherche de tous les taxons de Taxref, entièrement revue dans TaxHub 1.7.0</p></li>
<li><p>Monitoring : Correction du backend pour utiliser la nouvelle syntaxe de jointure des tables</p></li>
<li><p>Ajout de fonctions SQL d’insertion de données dans la Synthèse (<code class="docutils literal notranslate"><span class="pre">gn_synthese.import_json_row()</span></code> et <code class="docutils literal notranslate"><span class="pre">gn_synthese.import_row_from_table()</span></code>) et de la fonction Python associée (<code class="docutils literal notranslate"><span class="pre">import_from_table(schema_name,</span> <span class="pre">table_name,</span> <span class="pre">field_name,</span> <span class="pre">value)</span></code>) pour l’API permettant de poster dans la Synthèse (#736). Utilisée par le module Monitoring.</p></li>
<li><p>Ajout du plugin Leaflet.Deflate (#934  par &#64;jpm-cbna)</p></li>
<li><p>Connexion au CAS INPN : Association des JDD aux modules Occtax et Occhab (paramétrable) quand on importe les JDD de l’utilisateur qui se connecte (dans la table <code class="docutils literal notranslate"><span class="pre">gn_commons.cor_module_dataset</span></code>)</p></li>
<li><p>Mise à jour des librairies Python Utils-Flask-SQLAlchemy (en version 0.1.1) et Utils-Flask-SQLAlchemy-Geo (en version 0.1.0) permettant de mettre en place les exports au format GeoPackage et corrigeant les exports de SHP contenant des géométries multiples</p></li>
</ul>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Mise à jour des URL de la documentation utilisateur des modules, renvoyant vers <a class="reference external" href="http://docs.geonature.fr">http://docs.geonature.fr</a></p></li>
<li><p>Validation : Correction de l’ouverture de la fiche d’information d’une observation (#858)</p></li>
<li><p>Modification de l’attribution de la hauteur du composant <code class="docutils literal notranslate"><span class="pre">map-container</span></code> pour permettre d’adapter la hauteur de la carte si la hauteur d’un conteneur parent est modifié. Et que <code class="docutils literal notranslate"><span class="pre">&lt;pnx-map</span> <span class="pre">height=&quot;100%&quot;&gt;</span></code> fonctionne (#844 par &#64;jbrieuclp)</p></li>
<li><p>Mise à jour de la librairie python Markupsafe en version 1.1, corrigeant un problème de setuptools (#881)</p></li>
<li><p>Page Maintenance : Correction de l’affichage de l’image (par &#64;jpm-cbna)</p></li>
<li><p>Correction du multiselect du composant <code class="docutils literal notranslate"><span class="pre">pnx-nomenclatures</span></code> (#885 par &#64;jpm-cbna)</p></li>
<li><p>Correction de l”<code class="docutils literal notranslate"><span class="pre">input('coordinates')</span></code> du composant <code class="docutils literal notranslate"><span class="pre">marker</span></code> (#901 par &#64;jbrieuclp)</p></li>
<li><p>Utilisation de NVM quand on installe les dépendances javascript (#926 par &#64;jpm-cbna)</p></li>
<li><p>Formulaire JDD : Correction de l’affichage de la liste des modules (#861)</p></li>
<li><p>Correction de l’utilisation des paramètres du proxy (#944)</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<p>Si vous mettez à jour GeoNature.</p>
<ul class="simple">
<li><p>Vous devez d’abord mettre à jour TaxHub en version 1.7.0</p></li>
<li><p>Si vous mettez à jour TaxHub, vous pouvez mettre à jour Taxref en version 13. Il est aussi possible de le faire en différé, plus tard</p></li>
<li><p>Vous pouvez mettre à jour UsersHub en version 2.1.2</p></li>
<li><p>Exécuter le script SQL de mise à jour des nomenclatures (<a class="reference external" href="https://github.com/PnX-SI/Nomenclature-api-module/blob/master/data/update1.3.2to1.3.3.sql">https://github.com/PnX-SI/Nomenclature-api-module/blob/master/data/update1.3.2to1.3.3.sql</a>).</p></li>
<li><p>Si vous avez mis à jour Taxref en version 13, répercutez les évolutions au niveau des nomenclatures avec le script SQL <a class="reference external" href="https://github.com/PnX-SI/Nomenclature-api-module/blob/master/data/update_taxref_v13.sql">https://github.com/PnX-SI/Nomenclature-api-module/blob/master/data/update_taxref_v13.sql</a>. Sinon vous devrez l’exécuter plus tard, après avoir mis à jour Taxref en version 13. Après avoir mis à jour Taxref en version 13, pensez à mettre à jour le paramètre <code class="docutils literal notranslate"><span class="pre">taxref_version</span></code> dans la table <code class="docutils literal notranslate"><span class="pre">gn_commons.t_parameters</span></code>.</p></li>
<li><p>Exécuter le script SQL de mise à jour de la BDD de GeoNature (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.3.2to2.4.0.sql">https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.3.2to2.4.0.sql</a>)</p></li>
<li><p>Installer les dépendances de la librairie Python WeasyPrint :</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">libcairo2</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">libpango</span><span class="o">-</span><span class="mf">1.0</span><span class="o">-</span><span class="mi">0</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">libpangocairo</span><span class="o">-</span><span class="mf">1.0</span><span class="o">-</span><span class="mi">0</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">libgdk</span><span class="o">-</span><span class="n">pixbuf2</span><span class="mf">.0</span><span class="o">-</span><span class="mi">0</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">libffi</span><span class="o">-</span><span class="n">dev</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">shared</span><span class="o">-</span><span class="n">mime</span><span class="o">-</span><span class="n">info</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Corriger l’utilisation des paramètres du proxy (#944) dans le fichier <code class="docutils literal notranslate"><span class="pre">backend/gunicorn_start.sh</span></code> en remplaçant les 2 lignes :</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">HTTP_PROXY</span><span class="o">=</span><span class="s2">&quot;&#39;$proxy_http&#39;&quot;</span>
<span class="n">export</span> <span class="n">HTTPS_PROXY</span><span class="o">=</span><span class="s2">&quot;&#39;$proxy_https&#39;&quot;</span>
</pre></div>
</div>
<p>par :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Activation de la configuration des proxy si necessaire</span>
<span class="p">[[</span> <span class="o">-</span><span class="n">z</span> <span class="s2">&quot;$proxy_http&quot;</span> <span class="p">]]</span> <span class="o">||</span> <span class="n">export</span> <span class="n">HTTP_PROXY</span><span class="o">=</span><span class="s2">&quot;&#39;$proxy_http&#39;&quot;</span>
<span class="p">[[</span> <span class="o">-</span><span class="n">z</span> <span class="s2">&quot;$proxy_https&quot;</span> <span class="p">]]</span> <span class="o">||</span> <span class="n">export</span> <span class="n">HTTPS_PROXY</span><span class="o">=</span><span class="s2">&quot;&#39;$proxy_https&#39;&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Vous pouvez supprimer les associations des observations de la synthèse aux zonages limitrophes, si vous n’avez pas d’observations sans géométrie (#719) :</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DELETE</span> <span class="n">FROM</span> <span class="n">gn_synthese</span><span class="o">.</span><span class="n">cor_area_synthese</span> <span class="n">cas</span>
<span class="n">USING</span> <span class="n">gn_synthese</span><span class="o">.</span><span class="n">synthese</span> <span class="n">s</span><span class="p">,</span> <span class="n">ref_geo</span><span class="o">.</span><span class="n">l_areas</span> <span class="n">a</span>
<span class="n">WHERE</span> <span class="n">cas</span><span class="o">.</span><span class="n">id_synthese</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">id_synthese</span> <span class="n">AND</span> <span class="n">a</span><span class="o">.</span><span class="n">id_area</span> <span class="o">=</span> <span class="n">cas</span><span class="o">.</span><span class="n">id_area</span>
<span class="n">AND</span> <span class="n">public</span><span class="o">.</span><span class="n">ST_TOUCHES</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">the_geom_local</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">geom</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Suivez ensuite la procédure classique de mise à jour de GeoNature (<a class="reference external" href="http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application">http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application</a>)</p></li>
</ul>
</section>
<section id="id17">
<h2>2.3.2 (2020-02-24)<a class="headerlink" href="#id17" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🚀 Nouveautés</strong></p>
<ul class="simple">
<li><p>Possibilité de charger les commandes d’un module dans les commandes de GeoNature</p></li>
<li><p>Ajout de commentaires dans le fichier d’exemple de configuration <code class="docutils literal notranslate"><span class="pre">config/default_config.toml.example</span></code></p></li>
</ul>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Correction d’une incohérence dans le décompte des JDD sur la page d’accueil en leur appliquant le CRUVED (#752)</p></li>
<li><p>Montée de version de la librairie <code class="docutils literal notranslate"><span class="pre">utils-flask-sqlalchemy-geo</span></code> pour compatibilité avec la version 1.0.0 du module d’export</p></li>
</ul>
</section>
<section id="id18">
<h2>2.3.1 (2020-02-18)<a class="headerlink" href="#id18" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🚀 Nouveautés</strong></p>
<ul class="simple">
<li><p>Installation globale : Compatibilité Debian 10 (PostgreSQL 11, PostGIS 2.5)</p></li>
<li><p>Installation globale : Passage à Taxhub 1.6.4 et UsersHub 2.1.1</p></li>
<li><p>Utilisation généralisée des nouvelles librairies externalisées de sérialisation (<a class="reference external" href="https://github.com/PnX-SI/Utils-Flask-SQLAlchemy">https://github.com/PnX-SI/Utils-Flask-SQLAlchemy</a> et <a class="reference external" href="https://github.com/PnX-SI/Utils-Flask-SQLAlchemy-Geo">https://github.com/PnX-SI/Utils-Flask-SQLAlchemy-Geo</a>)</p></li>
<li><p>Possibilité de régler le timeout de Gunicorn pour éviter le plantage lors de requêtes longues</p></li>
<li><p>Ne pas zoomer sur les observations au premier chargement de la carte (#838)</p></li>
<li><p>Leaflet-draw : Ajout de la possibilité de zoomer sur le point (par &#64;joelclems)</p></li>
<li><p>Ajout du nom vernaculaire dans les fiches d’information des relevés d’Occtax (par &#64;FloVollmer / #826)</p></li>
</ul>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Correction de l’installation de Node.js et npm par l’utilisation généralisée de nvm (#832 et #837)</p></li>
<li><p>Fixation de la version de Node.js en 10.15.3 (dans le fichier <code class="docutils literal notranslate"><span class="pre">fronted/.nvmrc</span></code>)</p></li>
<li><p>Ajout d’une référence de l’objet Leaflet <code class="docutils literal notranslate"><span class="pre">L</span></code> afin qu’il soit utilisé dans les modules et changement du typage de l’évenement Leaflet <code class="docutils literal notranslate"><span class="pre">MouseEvent</span></code> en <code class="docutils literal notranslate"><span class="pre">L.LeafletMouseEvent</span></code></p></li>
<li><p>Fixation de la version de vitualenv en 20.0.1 (par &#64;sogalgeeko)</p></li>
<li><p>Corrections de typos dans la documentation d’administration (#840 - par &#64;sogalgeeko)</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<ul>
<li><p>Vous pouvez passer directement à cette version depuis la 2.2.x, mais en suivant les notes des versions intermédiaires (NB : il n’est pas nécessaire d’exécuter le script <code class="docutils literal notranslate"><span class="pre">migrate.sh</span></code> des versions précédentes)</p></li>
<li><p>Installez <code class="docutils literal notranslate"><span class="pre">pip3</span></code> et <code class="docutils literal notranslate"><span class="pre">virtualenv</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">python3</span><span class="o">-</span><span class="n">pip</span>
<span class="n">sudo</span> <span class="n">pip3</span> <span class="n">install</span> <span class="n">virtualenv</span><span class="o">==</span><span class="mf">20.0.1</span>
</pre></div>
</div>
</li>
<li><p>Rajoutez la ligne <code class="docutils literal notranslate"><span class="pre">gun_timeout=30</span></code> au fichier <code class="docutils literal notranslate"><span class="pre">config/settings.ini</span></code> puis rechargez supervisor (<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">supervisorctl</span> <span class="pre">reload</span></code>). Il s’agit du temps maximal (en seconde) autorisé pour chaque requête. A augmenter, si vous avez déjà rencontré des problèmes de timeout.</p></li>
<li><p>Depuis le répertoire <code class="docutils literal notranslate"><span class="pre">frontend</span></code>, lancez la commande <code class="docutils literal notranslate"><span class="pre">nvm</span> <span class="pre">install</span></code></p></li>
</ul>
</section>
<section id="occhab-de-noel-2019-12-27">
<h2>2.3.0 - Occhab de Noël (2019-12-27)<a class="headerlink" href="#occhab-de-noel-2019-12-27" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🚀 Nouveautés</strong></p>
<ul class="simple">
<li><p>Développement du module Occhab (Occurrences d’habitats) basé sur une version minimale du standard SINP du même nom et s’appuyant sur le référentiel Habref du SINP (#735)</p>
<ul>
<li><p>Consultation (carte-liste) des stations et affichage de leurs habitats</p></li>
<li><p>Recherche (et export) des stations par jeu de données, habitats ou dates</p></li>
<li><p>Saisie d’une station et de ses habitats</p></li>
<li><p>Possibilité de saisir plusieurs habitats par station</p></li>
<li><p>Saisie des habitats basée sur une liste pré-définie à partir d’Habref. Possibilité d’intégrer toutes les typologies d’habitat ou de faire des listes réduites d’habitats</p></li>
<li><p>Possibilité de charger un fichier GeoJson, KML ou GPX sur la carte et d’utiliser un de ses objets comme géométrie de station</p></li>
<li><p>Mise en place d’une API Occhab (Get, Post, Delete, Export stations et habitats et récupérer les valeurs par défaut des nomenclatures)</p></li>
<li><p>Calcul automatique des altitudes (min/max) et de la surface d’une station</p></li>
<li><p>Gestion des droits (en fonction du CRUVED de l’utilisateur connecté)</p></li>
<li><p>Définition des valeurs par défaut dans la BDD (paramétrable par organisme)</p></li>
<li><p>Possibilité de masquer des champs du formulaire</p></li>
</ul>
</li>
<li><p>Création d’un sous-module autonome ou intégré pour gérer l’API d’Habref (<a class="reference external" href="https://github.com/PnX-SI/Habref-api-module">https://github.com/PnX-SI/Habref-api-module</a>) pour :</p>
<ul>
<li><p>Rechercher un habitat dans Habref (avec usage du trigramme pour la pertinence du résultat)</p></li>
<li><p>Obtenir les infos d’un habitat et de ses correspondances à partir de son cd_hab</p></li>
<li><p>Obtenir les habitats d’une liste (avec ou sans leur code en plus de leur nom et filtrable par typologie)</p></li>
<li><p>Obtenir la liste des typologies (filtrable par liste d’habitats)</p></li>
</ul>
</li>
<li><p>Mise à jour du module des nomenclatures (<a class="reference external" href="https://github.com/PnX-SI/Nomenclature-api-module">https://github.com/PnX-SI/Nomenclature-api-module</a>) en version 1.3.2 incluant notamment :</p>
<ul>
<li><p>Ajout de nomenclatures SINP concernant les habitats</p></li>
<li><p>Ajout d’une contrainte d’unicité sur la combinaison des champs <code class="docutils literal notranslate"><span class="pre">id_type</span></code> et <code class="docutils literal notranslate"><span class="pre">cd_nomenclature</span></code> de la table <code class="docutils literal notranslate"><span class="pre">t_nomenclatures</span></code></p></li>
</ul>
</li>
<li><p>Association des JDD à des modules pour filtrer les JDD utilisés dans Occtax ou dans Occhab notamment (#399)</p></li>
<li><p>Mise à jour de Angular 4 à Angular 7 (performances, ….) par &#64;jbrieuclp</p></li>
<li><p>Ajout d’une documentation utilisateur pour le module Synthèse : <a class="reference external" href="http://docs.geonature.fr/user-manual.html#synthese">http://docs.geonature.fr/user-manual.html#synthese</a> (par &#64;amandine-sahl)</p></li>
<li><p>OCCTAX : Amélioration importante des performances de la liste des relevés (par &#64;jbrieuclp) (#690, #740)</p></li>
<li><p>Améliorations des performances des exports de Occtax et de Synthèse et ajout d’index dans Occtax (par &#64;gildeluermoz) (#560)</p></li>
<li><p>Partage de scripts de sauvegarde de l’application et de la BDD dans <code class="docutils literal notranslate"><span class="pre">data/scripts/backup/</span></code> (par &#64;gildeluermoz)</p></li>
<li><p>Externalisation des librairies d’outils Flask et SQLAlchemy (<a class="reference external" href="https://github.com/PnX-SI/Utils-Flask-SQLAlchemy">https://github.com/PnX-SI/Utils-Flask-SQLAlchemy</a> et <a class="reference external" href="https://github.com/PnX-SI/Utils-Flask-SQLAlchemy-Geo">https://github.com/PnX-SI/Utils-Flask-SQLAlchemy-Geo</a>) pour pouvoir les factoriser et les utiliser dans d’autres applications. Cela améliore aussi les performances des jointures.</p></li>
<li><p>SYNTHESE : Ajout d’un export de la liste des espèces (#805)</p></li>
<li><p>SYNTHESE : Baser la portée de tous les exports (y compris Statuts) sur l’action E (#804)</p></li>
<li><p>METADONNEES : Affichage des ID des JDD et CA</p></li>
<li><p>OCCTAX : Conserver le fichier GPX ou GeoJSON chargé sur la carte quand on enchaine des relevés et ajouter de la transparence sur les géométries utilisés dans les relevés précédents (#813)</p></li>
<li><p>OCCTAX : Clarification de l’ergonomie pour ajouter un dénombrement sur un taxon (#780)</p></li>
<li><p>Ajout des dates de creation et de modification dans les tables <code class="docutils literal notranslate"><span class="pre">gn_monitoring.t_base_sites</span></code> et <code class="docutils literal notranslate"><span class="pre">gn_monitoring.t_base_visits</span></code> et triggers pour les calculer automatiquement</p></li>
<li><p>Ajout des champs <code class="docutils literal notranslate"><span class="pre">geom_local</span></code>, <code class="docutils literal notranslate"><span class="pre">altitude_min</span></code> et <code class="docutils literal notranslate"><span class="pre">altitude_max</span></code> dans la table <code class="docutils literal notranslate"><span class="pre">gn_monitoring.t_base_sites</span></code> et triggers pour les calculer automatiquement (#812)</p></li>
<li><p>Ajout des champs <code class="docutils literal notranslate"><span class="pre">id_dataset</span></code>, <code class="docutils literal notranslate"><span class="pre">id_module</span></code>, <code class="docutils literal notranslate"><span class="pre">id_nomenclature_obs_technique</span></code> et <code class="docutils literal notranslate"><span class="pre">id_nomenclature_grp_typ</span></code> dans la table <code class="docutils literal notranslate"><span class="pre">gn_monitoring.t_base_visits</span></code> (#812)</p></li>
<li><p>Le composant générique FileLayer expose un <code class="docutils literal notranslate"><span class="pre">output</span></code> pour récuperer la géométrie sélectionnée (un observable de MapService était utilisé auparavant)</p></li>
<li><p>Support des markers sur le composant <code class="docutils literal notranslate"><span class="pre">leaflet-draw</span></code></p></li>
<li><p>Possibilité de ne pas activer le composant <code class="docutils literal notranslate"><span class="pre">marker</span></code> au lancement lorsque celui-ci est utilisé (input <code class="docutils literal notranslate"><span class="pre">defaultEnable</span></code>)</p></li>
<li><p>Ajout d’inputs <code class="docutils literal notranslate"><span class="pre">time</span></code>, <code class="docutils literal notranslate"><span class="pre">number</span></code>, <code class="docutils literal notranslate"><span class="pre">medias</span></code> et <code class="docutils literal notranslate"><span class="pre">datalist</span></code> au composant DynamicForm permettant de générer des formulaires dynamiques.</p></li>
<li><p>Améliorations diverses du composant DynamicForm (par &#64;joelclems)</p></li>
<li><p>Ajout d’un paramètre dans le cas où le serveur se trouve derrière un proxy (<code class="docutils literal notranslate"><span class="pre">proxy_http</span></code> ou dans <code class="docutils literal notranslate"><span class="pre">proxy_https</span></code> dans <code class="docutils literal notranslate"><span class="pre">config/settings.ini</span></code>)</p></li>
<li><p>Ajout d’une route permettant de récupérer la liste des rôles d’une liste à partir de son code (par &#64;joelclems)</p></li>
</ul>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>MENU Side nav : Correction pour ne pas afficher les modules pour lesquels le paramètre <code class="docutils literal notranslate"><span class="pre">active_frontend</span></code> est False (#822)</p></li>
<li><p>OCCTAX : Gestion de l’édition des occurrences où le JDD a été désactivé, en ne permettant pas de modifier le JDD (#694)</p></li>
<li><p>OCCTAX : Correction d’une faiblesse lors de la récupération des informations taxonomiques d’un relevé (utilisation d’une jointure plutôt que l’API TaxHub) (#751)</p></li>
<li><p>OCCTAX : Correction des longues listes de taxons dans les tooltip des relevés en y ajoutant un scroll (par &#64;jbrieuclp) (#666)</p></li>
<li><p>OCCTAX : Masquer le bouton <code class="docutils literal notranslate"><span class="pre">Télécharger</span></code> si l’utilisateur n’a pas de droits d’export dans le module (E = 0)</p></li>
<li><p>OCCTAX : Correction de l’affichage des relevés dans la liste (#777)</p></li>
<li><p>OCCTAX : Correction des exports quand on filtre sur un obervateur en texte</p></li>
<li><p>SYNTHESE : Filtre sur <code class="docutils literal notranslate"><span class="pre">date_max</span></code> en prenant <code class="docutils literal notranslate"><span class="pre">date_max</span> <span class="pre">&lt;=</span> <span class="pre">23:59:59</span></code> pour prendre en compte les observations avec un horaire (#778)</p></li>
<li><p>SYNTHESE : Correction des boutons radios pour les filtres taxonomiques avancés basés sur les attributs TaxHub (#763)</p></li>
<li><p>SYNTHESE : Correction de la recherche par <code class="docutils literal notranslate"><span class="pre">cd_nom</span></code> dans le composant <code class="docutils literal notranslate"><span class="pre">SearchTaxon</span></code> (#824)</p></li>
<li><p>VALIDATION : Corrections mineures (par &#64;jbrieuclp) (#715)</p></li>
<li><p>INSCRIPTION : Correction si aucun champ additionnel n’a été ajouté au formulaire (par &#64;jbrieuclp) (#746)</p></li>
<li><p>INSCRIPTION : Correction de l’usage des paramètres <code class="docutils literal notranslate"><span class="pre">ENABLE_SIGN_UP</span></code> et <code class="docutils literal notranslate"><span class="pre">ENABLE_USER_MANAGEMENT</span></code> (#791)</p></li>
<li><p>Simplification de l’écriture des logs dans le script <code class="docutils literal notranslate"><span class="pre">install_db.sh</span></code></p></li>
<li><p>Correction de l’installation des requirements.txt lors de l’installation d’un module (#764 par &#64;joelclems)</p></li>
<li><p>COMMONS : Modification des champs de <code class="docutils literal notranslate"><span class="pre">t_modules</span></code> de type CHARACTER(n) en CHARACTER VARYING(n) (<code class="docutils literal notranslate"><span class="pre">module_path</span></code>, <code class="docutils literal notranslate"><span class="pre">module_target</span></code>, <code class="docutils literal notranslate"><span class="pre">module_external_url</span></code>) (#799)</p></li>
<li><p>COMMONS : Ajout de contraintes d’unicité pour les champs <code class="docutils literal notranslate"><span class="pre">module_path</span></code> et <code class="docutils literal notranslate"><span class="pre">module_code</span></code> de <code class="docutils literal notranslate"><span class="pre">t_modules</span></code></p></li>
<li><p>pnx-geojson : Amélioration du zoom, gestion des styles</p></li>
<li><p>Migration des données GeoNature V1 vers V2 (<code class="docutils literal notranslate"><span class="pre">data/migrations/v1tov2/</span></code>) : ajustements mineurs</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<p>NB: La version 2.3.0 n’est pas compatible avec le module Dashboard. Si vous avez le module Dashboard installé, ne passez pas à cette nouvelle version. Compatibilité dans la 2.3.1.</p>
<ul class="simple">
<li><p>Lancer le script de migration qui va installer et remplir le nouveau schéma <code class="docutils literal notranslate"><span class="pre">ref_habitats</span></code> avec Habref et mettre à jour le schéma <code class="docutils literal notranslate"><span class="pre">ref_nomenclatures</span></code> :</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd /home/`whoami`/geonature/install/migration
chmod +x 2.2.1to2.3.0.sh
./2.2.1to2.3.0.sh
</pre></div>
</div>
<p>Vérifier que la migration s’est bien déroulée dans le fichier <code class="docutils literal notranslate"><span class="pre">var/log/2.2.1to2.3.0.log</span></code>.</p>
<ul class="simple">
<li><p>Lancer le script SQL de mise à jour de la BDD de GeoNature <a class="reference external" href="https://raw.githubusercontent.com/PnX-SI/GeoNature/2.3.0/data/migrations/2.2.1to2.3.0.sql">https://raw.githubusercontent.com/PnX-SI/GeoNature/2.3.0/data/migrations/2.2.1to2.3.0.sql</a></p></li>
<li><p>Vous pouvez installer le nouveau module Occhab (Occurrences d’habitats) si vous le souhaitez :</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd /home/`whoami`/geonature/backend
source venv/bin/activate
geonature install_gn_module /home/`whoami`/geonature/contrib/gn_module_occhab /occhab
deactivate
</pre></div>
</div>
<ul class="simple">
<li><p>Lors de la migration (<code class="docutils literal notranslate"><span class="pre">/data/migrations/2.2.1to2.3.0.sql</span></code>), tous les JDD actifs sont associés par défaut au module Occtax (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.2.1to2.3.0.sql#L17-L22">https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.2.1to2.3.0.sql#L17-L22</a>). A chacun d’adapter si besoin, en en retirant certains. Pour utiliser le module Occhab, vous devez y associer au moins un JDD.</p></li>
</ul>
</section>
<section id="id19">
<h2>2.2.1 (2019-10-09)<a class="headerlink" href="#id19" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>La route de changement de mot de passe était désactivée par le mauvais paramètre (<code class="docutils literal notranslate"><span class="pre">ENABLE_SIGN_UP</span></code> au lieu de <code class="docutils literal notranslate"><span class="pre">ENABLE_USER_MANAGEMENT</span></code>)</p></li>
<li><p>Désactivation du mode « enchainement des relevés » en mode édition (#669). Correction effacement du même relevé (#744)</p></li>
<li><p>Correction d’affichage du module métadonnées lorsque les AF n’ont pas de JDD pour des raisons de droit (#743)</p></li>
<li><p>Diverses corrections de doublons d’import et de logs de débugs (#742)</p></li>
<li><p>Montée de version du sous-module d’authentification: 1.4.2</p></li>
</ul>
</section>
<section id="module-utilisateurs-2019-09-18">
<h2>2.2.0 - Module utilisateurs (2019-09-18)<a class="headerlink" href="#module-utilisateurs-2019-09-18" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🚀 Nouveautés</strong></p>
<ul class="simple">
<li><p>Ajout d’interfaces et de paramètres de création de compte, de récupération de son mot de passe et d’administration de son profil, basé sur l’API UsersHub 2.1.0 (par &#64;jbrieuclp et &#64;TheoLechemia) #615</p></li>
<li><p>Ajout d’une fonctionnalité de création automatique d’un CA et d’un JDD personnel lors de la validation d’un compte créé automatiquement (paramétrable)</p></li>
<li><p>Amélioration du composant de création dynamique de formulaire (support de text-area, checkbox simple et multiple et exemple d’utilisation à partir de la conf GeoNature)</p></li>
<li><p>Le composant “observateur” permet de rechercher sur le nom ou le prénom (utilisation des RegEx) #567</p></li>
<li><p>Mise à jour de Flask en version 1.1.1</p></li>
<li><p>Nouvelle version du sous-module d’authentification (1.4.1), compatible avec UsersHub 2.1.0</p></li>
<li><p>Mise à jour du sous-module de nomenclatures (version 1.3.0)</p></li>
<li><p>Mise à jour et clarification du MCD (<a class="reference external" href="http://docs.geonature.fr/admin-manual.html#base-de-donnees">http://docs.geonature.fr/admin-manual.html#base-de-donnees</a>) par &#64;jpm-cbna</p></li>
<li><p>Ajout d’une tutoriel vidéo d’installation dans la documentation (<a class="reference external" href="https://www.youtube.com/watch?v=JYgH7cV9AjE">https://www.youtube.com/watch?v=JYgH7cV9AjE</a>, par &#64;olivier8064)</p></li>
</ul>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Correction d’un bug sur les export CSV en utilisant la librairie Python standard <code class="docutils literal notranslate"><span class="pre">csv</span></code> (#733)</p></li>
<li><p>SYNTHESE API : Passage de la route principale de récupération des données en POST plutôt qu’en GET (#704)</p></li>
<li><p>SYNTHESE BDD : Suppression automatique des aires intersectées (<code class="docutils literal notranslate"><span class="pre">synthese.cor_area_synthese</span></code>) lorsqu’une observation est supprimée (DELETE CASCADE)</p></li>
<li><p>SYNTHESE : Prise en compte du paramètre <code class="docutils literal notranslate"><span class="pre">EXPORT_ID_SYNTHESE_COL</span></code> (#707)</p></li>
<li><p>OCCTAX : Correction d’une autocomplétion automatique erronée de la date max en mode édition (#706)</p></li>
<li><p>VALIDATION : Améliorations des performances, par &#64;jbrieuclp (#710)</p></li>
<li><p>Prise en compte des sous-taxons pour le calcul des règles de sensibilité</p></li>
<li><p>Correction des contraintes CHECK sur les tables liées à la sensibilité</p></li>
<li><p>Complément et correction des scripts de migration <code class="docutils literal notranslate"><span class="pre">data/migrations/v1tov2</span></code></p></li>
<li><p>Correction et clarification de la documentation d’administration des listes de taxons et de sauvegarde et restauration de la BDD (par &#64;lpofredc)</p></li>
<li><p>Correction de la rotation des logs</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<ul class="simple">
<li><p>Passer le script de migration suivant: <a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.1.2to2.2.0.sql">https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.1.2to2.2.0.sql</a></p></li>
<li><p>Suivez ensuite la procédure classique de mise à jour de GeoNature (<a class="reference external" href="http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application">http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application</a>)</p></li>
<li><p>Si vous souhaitez activer les fonctionnalités de création de compte, veuillez lire <strong>attentivement</strong> cette documentation : <a class="reference external" href="http://docs.geonature.fr/admin-manual.html#configuration-de-la-creation-de-compte">http://docs.geonature.fr/admin-manual.html#configuration-de-la-creation-de-compte</a></p></li>
<li><p>Si vous activez la création de compte, UsersHub 2.1.0 doit être installé. Voir sa <a class="reference external" href="https://github.com/PnX-SI/UsersHub/releases">note de version</a>.</p></li>
</ul>
</section>
<section id="id20">
<h2>2.1.2 (2019-07-25)<a class="headerlink" href="#id20" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>SYNTHESE : Correction d’une URL en dur pour la recherche de rangs taxonomiques</p></li>
<li><p>OCCTAX : Affichage uniquement des JDD actifs</p></li>
<li><p>VALIDATION : Abaissement de la limite d’affichage de données sur la carte par défaut + message indicatif</p></li>
<li><p>Migration : Suppression d’un lien symbolique qui créait des liens en cascade</p></li>
<li><p>Amélioration de la documentation (&#64;dthonon)</p></li>
<li><p>Amélioration de la rapidité d’installation du MNT grâce à la suppression d’un paramètre inutile</p></li>
<li><p>BACKOFFICE : Correction d’une URL incorrecte et customisation</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<p>Ceci est une version corrective mineure. Si vous migrez depuis la 2.1.0, passez directement à cette version en suivant les notes de version de la 2.1.1.</p>
</section>
<section id="id21">
<h2>2.1.1 (2019-07-18)<a class="headerlink" href="#id21" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🚀 Nouveautés</strong></p>
<ul class="simple">
<li><p>SYNTHESE: Factorisation du formulaire de recherche (utilisé dans le module synthese et validation)</p></li>
<li><p>SYNTHESE: Simplification et correction du module de recherche avancée d’un taxon en le limitant à l’ordre (performances)</p></li>
<li><p>SYNTHESE: Ajout d’un composant de recherche taxonomique avancé basé sur les rangs taxonomiques (modules synthese et validation), basé sur la nouvelle fonction <code class="docutils literal notranslate"><span class="pre">taxonomie.find_all_taxons_children</span></code> ajoutée à TaxHub</p></li>
<li><p>Création d’un backoffice d’admnistration dans le coeur de GeoNature. Basé sur Flask-admin, les modules peuvent alimenter dynamiquement le backoffice avec leur configuration</p></li>
<li><p>Mise en place d’une documentation développeur automatique de l’API à partir des docstring et des composants frontend, générée par Travis et désormais accessible à l’adresse <a class="reference external" href="http://docs.geonature.fr">http://docs.geonature.fr</a> (#673)</p></li>
<li><p>Amélioration de la documentation (triggers, installation, module validation)</p></li>
<li><p>Suppression du module d’exemple, remplacé par un template de module (<a class="reference external" href="https://github.com/PnX-SI/gn_module_template">https://github.com/PnX-SI/gn_module_template</a>)</p></li>
<li><p>Ajout d’un champ <code class="docutils literal notranslate"><span class="pre">validable</span></code> sur la table <code class="docutils literal notranslate"><span class="pre">gn_meta.t_datasets</span></code> controlant les données présentes dans le module VALIDATION (<a class="reference external" href="https://github.com/PnX-SI/gn_module_validation/issues/31">https://github.com/PnX-SI/gn_module_validation/issues/31</a>)</p></li>
<li><p>VALIDATION: Lister toutes les données de la synthèse ayant un <code class="docutils literal notranslate"><span class="pre">uuid_sinp</span></code> dans le module validation, et plus seulement celles qui ont un enregistrement dans <code class="docutils literal notranslate"><span class="pre">gn_commons.t_validations</span></code></p></li>
<li><p>VALIDATION: On ne liste plus les <code class="docutils literal notranslate"><span class="pre">id_nomenclatures</span></code> des types de validation à utiliser, dans la configuration du module. Mais on utilise toutes les nomenclatures activées du type de nomenclature <code class="docutils literal notranslate"><span class="pre">STATUT_VALID</span></code>. (<a class="reference external" href="https://github.com/PnX-SI/gn_module_validation/issues/30">https://github.com/PnX-SI/gn_module_validation/issues/30</a>)</p></li>
<li><p>Ajout de tests sur les ajouts de JDD et CA</p></li>
<li><p>Ajout d’une fonctionnalité d’envoie d’email via Flask-Mail dans le coeur de GeoNature</p></li>
<li><p>Amélioration des performances: ajout d’index sur Occtax et Metadonnées</p></li>
<li><p>Script d’import des métadonnées à partir du webservice MTD de l’INPN (&#64;DonovanMaillard)</p></li>
<li><p>Complément, correction et compatibilité 2.1.0 des scripts de migration <code class="docutils literal notranslate"><span class="pre">data/migrations/v1tov2</span></code></p></li>
</ul>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Nombreuses corrections du module de validation (non utilisation des id_nomenclature, simplification des vues et de la table <code class="docutils literal notranslate"><span class="pre">gn_commons.t_validations</span></code>)</p></li>
<li><p>Ordonnancement de listes déroulantes (#685)</p></li>
<li><p>OCCTAX : correction de l’édition d’un relevé à la géométrie de type Polyline (#684)</p></li>
<li><p>OCCTAX : correction l’édition et du contrôle conditionnel des champs de « preuves » (preuve d’existence numérique / non numérique) (#679)</p></li>
<li><p>OCCTAX : correction du parametre <code class="docutils literal notranslate"><span class="pre">DATE_FORM_WITH_TODAY</span></code> non pris en compte (#670)</p></li>
<li><p>OCCTAX: correction de la date_max non remplie lorsque <code class="docutils literal notranslate"><span class="pre">DATE_FORM_WITH_TODAY</span> <span class="pre">=</span> <span class="pre">false</span></code></p></li>
<li><p>OCCTAX: correction d’un bug lors de l’enchainement de relevé lorsque l’heure est remplie</p></li>
<li><p>SYNTHESE: correction des doublons lorsqu’il y a plusieurs observateurs</p></li>
<li><p>Correction du composant <code class="docutils literal notranslate"><span class="pre">dynamicForm</span></code> sur les champs de recherche de type texte (recherche sur Preuve numérique) (#530)</p></li>
<li><p>Désactivation du mode « enchainer les relevés » en mode édition (#699)</p></li>
<li><p>Correction de <code class="docutils literal notranslate"><span class="pre">gn_monitoring</span></code> : utiliser <code class="docutils literal notranslate"><span class="pre">gn_commons.t_modules</span></code> à la place de <code class="docutils literal notranslate"><span class="pre">utilisateurs.t_applications</span></code> pour associer des sites de suivi à des modules</p></li>
<li><p>Fix de SQLalchemy 1.3.3 et jointure sur objet Table</p></li>
<li><p>Le trigger remplissant <code class="docutils literal notranslate"><span class="pre">cor_area_synthese</span></code> en intersectant <code class="docutils literal notranslate"><span class="pre">gn_synthese.synthese</span></code> avec <code class="docutils literal notranslate"><span class="pre">ref_geo.l_areas</span></code> ne prend plus que les zonages ayant le champs <code class="docutils literal notranslate"><span class="pre">enabled=true</span></code></p></li>
<li><p>Correction <code class="docutils literal notranslate"><span class="pre">dict()</span></code> et version de Python (par &#64;jpm-cbna)</p></li>
<li><p>MAJ de sécurité de Bootstrap (en version 4.3.1)</p></li>
<li><p>L’ancien module export du coeur est enlevé en vue de la sortie du nouveau module export</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<ul class="simple">
<li><p>Passer TaxHub en version 1.6.3 (<a class="reference external" href="https://github.com/PnX-SI/TaxHub/releases/tag/1.6.3">https://github.com/PnX-SI/TaxHub/releases/tag/1.6.3</a>)</p></li>
<li><p>Passer le script de migration <code class="docutils literal notranslate"><span class="pre">data/2.1.0to2.1.1.sql</span></code></p></li>
<li><p>Si vous aviez modifier les <code class="docutils literal notranslate"><span class="pre">id_nomenclature</span></code> dans la surcouche de la configuration du module validation, supprimer les car on se base maintenant sur les <code class="docutils literal notranslate"><span class="pre">cd_nomenclature</span></code></p></li>
<li><p>Suivez ensuite la procédure classique de mise à jour de GeoNature (<a class="reference external" href="http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application">http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application</a>)</p></li>
<li><p>Nouvelle localisation de la doc : <a class="reference external" href="http://docs.geonature.fr">http://docs.geonature.fr</a></p></li>
</ul>
</section>
<section id="module-validation-2019-06-01">
<h2>2.1.0 - Module validation (2019-06-01)<a class="headerlink" href="#module-validation-2019-06-01" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🚀 Nouveautés</strong></p>
<ul class="simple">
<li><p>Intégration du module Validation dans GeoNature (développé par &#64;JulienCorny, financé par &#64;sig-pnrnm)</p></li>
<li><p>Ajout de tables, règles et fonctions permettant de calculer la sensibilité des occurrences de taxon de la synthèse (#284)</p></li>
<li><p>Occtax - Possibilité d’enchainer les saisies de relevés et de garder les informations du relevé (#633)</p></li>
<li><p>Occtax - Amélioration de l’ergonomie de l’interface MapList pour clarifier la recherche et l’ajout d’un relevé + ajout compteur (#467)</p></li>
<li><p>Révision de l’interface du module Métadonnées, listant les cadres d’acquisition et leurs jeux de données (par &#64;jbrieuclp)</p></li>
<li><p>Ajout d’un mécanisme du calcul des taxons observés par zonage géographique (#617)</p></li>
<li><p>Les mailles INPN (1, 5, 10km) sont intégrées à l’installation (avec un paramètre)</p></li>
<li><p>Statistiques de la page d’accueil - Ajout d’un paramètre permettant de les désactiver (#599)</p></li>
<li><p>Occtax - Date par défaut paramétrable (#351)</p></li>
<li><p>Support des géometries multiples (MultiPoint, MultiPolygone, MultiLigne) dans la synthèse et Occtax (#609)</p></li>
<li><p>Synthese - Affichage des zonages intersectés dans un onglet séparé (#579)</p></li>
</ul>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Révision complète des scripts de migration de GeoNature v1 à v2 (<code class="docutils literal notranslate"><span class="pre">data/migrations/v1tov2</span></code>)</p></li>
<li><p>Masquer l’export du module Synthèse si son CRUVED est défini à 0 (#608)</p></li>
<li><p>Correction de la vérification du CRUVED du module METADONNEES (#601)</p></li>
<li><p>Correction de la vérification du CRUVED lorsque get_role = False</p></li>
<li><p>Correction de la traduction sur la page de connexion (par &#64;jbrieuclp)</p></li>
<li><p>Occtax - Retour du composant GPS permettant de charger un marker à partir de coordonnées X et Y (#624)</p></li>
<li><p>Correction lors d’import de fichier GPX ayant une altitude (#631)</p></li>
<li><p>Occtax - Correction du filtre Observateur texte libre (#598)</p></li>
<li><p>Métadonnées - Inversion des domaines terrestre/marin (par &#64;xavyeah39)</p></li>
<li><p>Métadonnées - Correction de l’édition des cadres d’acquisition (#654, par &#64;DonovanMaillard)</p></li>
<li><p>Mise à jour de sécurité de Jinja2 et SQLAlchemy</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<ul>
<li><p>Vous pouvez passer directement à cette version, mais en suivant les notes des versions intermédiaires</p></li>
<li><p>Suivez ensuite la procédure classique de mise à jour de GeoNature (<a class="reference external" href="http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application">http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application</a>)</p></li>
<li><p>Lancer le script de migration de la base de données :</p>
<p>Cette nouvelle version de GeoNature intègre les mailles INPN (1, 5, 10km) dans le réferentiel géographique. Si vous ne souhaitez pas les installer, lancer le script ci dessous en passant le paramètre <code class="docutils literal notranslate"><span class="pre">no-grid</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd /home/`whoami`/geonature/data/migrations
# avec les mailles
./2.0.1to2.1.0.sh
# sans les mailles:
# ./2.0.1to2.1.0.sh no-grid
</pre></div>
</div>
</li>
<li><p>Installer le module VALIDATION si vous le souhaitez :</p>
<p>Se placer dans le virtualenv de GeoNature</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd /home/`whoami`/geonature/backend
source venv/bin/activate
</pre></div>
</div>
<p>Lancer la commande d’installation du module puis sortir du virtualenv</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>geonature install_gn_module /home/`whoami`/geonature/contrib/gn_module_validation/ /validation
deactivate
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id22">
<h2>2.0.1 (2019-03-18)<a class="headerlink" href="#id22" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>🚀 Nouveautés</strong></p>
<ul class="simple">
<li><p>Développement : ajout d’une fonction de génération dynamique de requête SQL (avec vérification et cast des types)</p></li>
<li><p>Synthese : Ajout d’un message indiquant que le module affiche les dernières observations par défaut</p></li>
</ul>
<p><strong>🐛 Corrections</strong></p>
<ul class="simple">
<li><p>Synthese : correction du filtre CRUVED pour les portées 1 et 2 sur la route <code class="docutils literal notranslate"><span class="pre">synthese/for_web</span></code> (#584)</p></li>
<li><p>Synthese : correction du bug lorsque la géométrie est null (#580)</p></li>
<li><p>Synthese : Correction de la redirection vers le module de saisie (#586)</p></li>
<li><p>Synthese : Correction de la valeur par défaut de la nomenclature <code class="docutils literal notranslate"><span class="pre">STATUT_OBS</span></code> (<code class="docutils literal notranslate"><span class="pre">Présent</span></code> au lieu de <code class="docutils literal notranslate"><span class="pre">NSP</span></code>)</p></li>
<li><p>Configuration carto : correction du bug d’arrondissement des coordonnées géographiques (#582)</p></li>
<li><p>Correction du trigger de calcul de la geom locale</p></li>
<li><p>Recréation de la vue <code class="docutils literal notranslate"><span class="pre">pr_occtax.export_occtax_sinp</span></code> qui avait été supprimée lors de la migration RC3 vers RC4</p></li>
<li><p>Correction de la vue <code class="docutils literal notranslate"><span class="pre">pr_occtax.v_releve_list</span></code></p></li>
<li><p>Correction ajout rang et cd_nom sur l’autocomplete de la synthese, absent dans le script de migration</p></li>
<li><p>DEPOBIO : Correction de la déconnexion au CAS INPN</p></li>
<li><p>Occtax et Metadata: correction lors de la mise à jour d’un élement (Merge mal géré par SQLAlchemy lorsqu’on n’a pas une valeur NULL) (#588)</p></li>
<li><p>Composant « jeu de données » : retour à l’affichage du nom long (#583)</p></li>
<li><p>Amélioration du style du composant multiselect</p></li>
<li><p>Metadata : formulaire cadre d’acquisition - listage uniquement des cadres d’acquisition parent pour ne pas avoir de cadres d’acquisition imbriqués</p></li>
<li><p>Ajouts de tests automatisés complémentaires</p></li>
</ul>
<p><strong>⚠️ Notes de version</strong></p>
<ul class="simple">
<li><p>Vous pouvez passer directement à cette version, mais en suivant les notes des versions intermédiaires</p></li>
<li><p>Exécuter le script de migration SQL du sous-module Nomenclatures (<a class="reference external" href="https://github.com/PnX-SI/Nomenclature-api-module/blob/1.2.4/data/update1.2.3to1.2.4.sql">https://github.com/PnX-SI/Nomenclature-api-module/blob/1.2.4/data/update1.2.3to1.2.4.sql</a>)</p></li>
<li><p>Exécuter le script de migration SQL de GeoNature (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.0.0to2.0.1.sql">https://github.com/PnX-SI/GeoNature/blob/master/data/migrations/2.0.0to2.0.1.sql</a>)</p></li>
<li><p>Suivez ensuite la procédure classique de mise à jour de GeoNature (<a class="reference external" href="http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application">http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application</a>)</p></li>
</ul>
</section>
<section id="la-refonte-2019-02-28">
<h2>2.0.0 - La refonte (2019-02-28)<a class="headerlink" href="#la-refonte-2019-02-28" title="Lien permanent vers cette rubrique"></a></h2>
<p>La version 2 de GeoNature est une refonte complète de l’application.</p>
<ul class="simple">
<li><p>Refonte technologique en migrant de PHP/Symfony/ExtJS/Openlayers à Python3/Flask/Angular4/Leaflet</p></li>
<li><p>Refonte de l’architecture du code pour rendre GeoNature plus générique et modulaire</p></li>
<li><p>Refonte de la base de données pour la rendre plus standardisée, plus générique et modulaire</p></li>
<li><p>Refonte ergonomique pour moderniser l’application</p></li>
</ul>
<img alt="http://geonature.fr/img/gn-login.jpg" src="http://geonature.fr/img/gn-login.jpg" />
<p>Pour plus de détails sur les évolutions apportées dans la version 2, consultez les détails des versions RC (Release Candidate) ci-dessous.</p>
<p><strong>Nouveautés</strong></p>
<ul class="simple">
<li><p>Possibilité de charger un fichier (GPX, GeoJson ou KML) sur la carte pour la saisie dans le module Occtax (#256)</p></li>
<li><p>Ajout d’un moteur de recherche de lieu (basé sur l’API OpenStreetMap Nominatim) sur les modules cartographiques (#476)</p></li>
<li><p>Intégration du plugin leaflet markerCluster permettant d’afficher d’avantage d’observations sur les cartes et de gérer leurs superposition (#559)</p></li>
<li><p>Synthèse : possibilité de grouper plusieurs types de zonages dans le composant <code class="docutils literal notranslate"><span class="pre">pnx-areas</span></code></p></li>
<li><p>Design de la page de login</p></li>
<li><p>Intégration d’un bloc stat sur la page d’accueil</p></li>
<li><p>Ajout d’un export des métadonnées dans la synthèse</p></li>
<li><p>Centralisation de la configuration cartographique dans la configuration globale de GeoNature (<code class="docutils literal notranslate"><span class="pre">geonature_config.toml</span></code>)</p></li>
<li><p>Cartographie : zoom sur l’emprise des résultats après une recherche</p></li>
<li><p>Migration de la gestion des métadonnées dans un module à part : “METADATA” (#550)</p></li>
<li><p>Export vue synthèse customisable (voir doc)</p></li>
<li><p>Lien vers doc par module (customisables dans <code class="docutils literal notranslate"><span class="pre">gn_commons.t_modules</span></code>) (#556)</p></li>
<li><p>Ajout du code du département dans les filtres par commune (#555)</p></li>
<li><p>Ajout du rang taxonomique et du cd_nom après les noms de taxons dans la recherche taxonomique (#549)</p></li>
<li><p>Mise à jour des communes fournies lors de l’installation (IGN admin express 2019) (#537)</p></li>
<li><p>Synthèse : Ajout du filtre par organisme (#531), affichage des acteurs dans les fiches détail et les exports</p></li>
<li><p>Synthese: possibilité de filtrer dans les listes déroulantes des jeux de données et cadres d’acquisition</p></li>
<li><p>Filtre de la recherche taxonomique par règne et groupe INPN retiré des formulaires de recherche (#531)</p></li>
<li><p>Suppression du champ validation dans le schéma de BDD Occtax car cette information est stockée dans la table verticale <code class="docutils literal notranslate"><span class="pre">gn_commons.t_validations</span></code> + affichage du statut de validation dans les fiches Occtax et Synthèse</p></li>
<li><p>Ajout d’une vue <code class="docutils literal notranslate"><span class="pre">gn_commons.v_lastest_validation</span></code> pour faciliter la récupération du dernier statut de validation d’une observation</p></li>
<li><p>Suppression de toutes les références à <code class="docutils literal notranslate"><span class="pre">taxonomie.bib_noms</span></code> en vue de le supprimer de TaxHub</p></li>
<li><p>Séparation des commentaires sur l’observation et sur le contexte (relevé) dans la Synthèse et simplification des triggers de Occtax vers Synthèse (#478)</p></li>
<li><p>Nouveau logo GeoNature (#346)</p></li>
</ul>
<p><strong>Corrections</strong></p>
<ul class="simple">
<li><p>Améliorations importantes des performances de la synthèse (#560)</p></li>
<li><p>Synthèse : correction liée aux filtres multiples et aux filtres géographiques de type cercle</p></li>
<li><p>Ajout d’une contrainte <code class="docutils literal notranslate"><span class="pre">DELETE</span> <span class="pre">CASCADE</span></code> entre <code class="docutils literal notranslate"><span class="pre">ref_geo.li_municialities</span></code> et <code class="docutils literal notranslate"><span class="pre">ref_geo.l_areas</span></code> (#554)</p></li>
<li><p>Occtax : possibilité de saisir un dénombrement égal à 0 (cas des occurrences d’absence)</p></li>
<li><p>Occtax : retour à l’emprise cartographique précédente lorsqu’on enchaine les relevés (#570)</p></li>
<li><p>Occtax : correction de l’automplissage du champ <code class="docutils literal notranslate"><span class="pre">hour_max</span></code> lors de l’édition d’un relevé</p></li>
<li><p>Divers compléments de la documentation (merci &#64;jbdesbas, &#64;xavyeah39 et &#64;DonovanMaillard)</p></li>
<li><p>Ajout de contraintes d’unicité sur les UUID_SINP pour empêcher les doublons (#536)</p></li>
<li><p>Corrections et compléments des tests automatiques</p></li>
<li><p>Amélioration de l’installation des modules GeoNature</p></li>
</ul>
<p><strong>Notes de version</strong></p>
<p><strong>1.</strong> Pour les utilisateurs utilisant la version 1 de GeoNature :</p>
<p>Il ne s’agit pas de mettre à jour GeoNature mais d’en installer une nouvelle version. En effet, il s’agit d’une refonte complète.</p>
<ul class="simple">
<li><p>Sauvegarder toutes ses données car l’opération est complexe et non-automatisée</p></li>
<li><p>Passer à la dernière version 1 de GeoNature (1.9.1)</p></li>
<li><p>Passer aux dernières versions de UsersHub et TaxHub</p></li>
<li><p>Installer GeoNature standalone ou refaire une installation complète</p></li>
<li><p>Adaptez les scripts présents dans <code class="docutils literal notranslate"><span class="pre">/data/migrations/v1tov2</span></code> et exécutez-les pas à pas. Attention ces scripts ont été faits pour la version 2.0.0-rc.1 et sont donc à ajuster, tester, compléter et adapter à votre contexte</p></li>
</ul>
<p><strong>2.</strong> Pour les utilisateurs utilisant une version RC de GeoNature 2 :</p>
<p>Veuillez bien lire ces quelques consignes avant de vous lancer dans la migration.</p>
<ul class="simple">
<li><p>Vous pouvez passer directement à cette version, mais en suivant les notes des versions intermédiaires.</p></li>
<li><p>Les personnes ayant configuré leur fichier <code class="docutils literal notranslate"><span class="pre">map.config.ts</span></code> devront le répercuter dans <code class="docutils literal notranslate"><span class="pre">geonature_config.toml</span></code>, suite à la centralisation de la configuration cartographique (voir <a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/2.0.0/config/default_config.toml.example">https://github.com/PnX-SI/GeoNature/blob/2.0.0/config/default_config.toml.example</a> section <code class="docutils literal notranslate"><span class="pre">[MAPCONFIG]</span></code>).</p></li>
<li><p>La configuration des exports du module synthèse a été modifiée (voir <a class="reference external" href="http://docs.geonature.fr/user-manual.html#synthese">http://docs.geonature.fr/user-manual.html#synthese</a>). Supprimer la variable``[SYNTHESE.EXPORT_COLUMNS]`` dans le fichier <code class="docutils literal notranslate"><span class="pre">geonature_config.toml</span></code>. Voir l’exemple dans le fichier (voir <a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/2.0.0/config/default_config.toml.example">https://github.com/PnX-SI/GeoNature/blob/2.0.0/config/default_config.toml.example</a> section) pour configurer les exports.</p></li>
<li><p>Supprimer la variable <code class="docutils literal notranslate"><span class="pre">COLUMNS_API_SYNTHESE_WEB_APP</span></code> si elle a été ajoutée dans le fichier <code class="docutils literal notranslate"><span class="pre">geonature_config.toml</span></code>.</p></li>
<li><p>Pour simplifier son édition, le template personalisable de la page d’accueil (<code class="docutils literal notranslate"><span class="pre">frontend/src/custom/components/introduction/introduction.component.html</span></code>) a été modifié (la carte des 100 dernière observations n’y figure plus). Veuillez supprimer tout ce qui se situe à partir de la ligne 21 (<code class="docutils literal notranslate"><span class="pre">&lt;div</span> <span class="pre">class=&quot;row</span> <span class="pre">row-0&quot;&gt;</span></code>) dans ce fichier.</p></li>
<li><p>Exécuter le script de migration SQL: <a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/2.0.0/data/migrations/2.0.0rc4.2to2.0.0.sql">https://github.com/PnX-SI/GeoNature/blob/2.0.0/data/migrations/2.0.0rc4.2to2.0.0.sql</a>.</p></li>
<li><p>Le backoffice de gestion des métadonnées est dorénavant un module GeoNature à part. Le script migration précédemment lancé prévoit de mettre un CRUVED au groupe_admin et groupe_en_poste pour le nouveau module METADATA. Les groupes nouvellement créés par les administrateurs et n’ayant de CRUVED pour l’objet METADATA (du module Admin), se retrouvent avec le CRUVED hérité de GeoNature. L’administrateur devra changer lui-même le CRUVED de ces groupes pour le nouveau module METADATA via le backoffice des permissions.</p></li>
<li><p>Suivez ensuite la procédure classique de mise à jour de GeoNature (<a class="reference external" href="http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application">http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application</a>).</p></li>
</ul>
</section>
<section id="rc-4-2-2019-01-23">
<h2>2.0.0-rc.4.2 (2019-01-23)<a class="headerlink" href="#rc-4-2-2019-01-23" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Nouveautés</strong></p>
<ul class="simple">
<li><p>Mise en place de logs rotatifs pour éviter de surcharger le serveur</p></li>
<li><p>Centralisation des logs applicatifs dans le dossier <code class="docutils literal notranslate"><span class="pre">var/log/gn_errors.log</span></code> de GeoNature</p></li>
</ul>
<p><strong>Corrections</strong></p>
<ul class="simple">
<li><p>Synthèse - Correction et amélioration de la gestion des dates (#540)</p></li>
<li><p>Amélioration des tests automatisés</p></li>
<li><p>Correction et complément ds scripts d’installation des modules GeoNature</p></li>
<li><p>Remplacement de <code class="docutils literal notranslate"><span class="pre">gn_monitoring.cor_site_application</span></code> par <code class="docutils literal notranslate"><span class="pre">gn_monitoring.cor_site_module</span></code></p></li>
<li><p>Complément des documentations de customisation, d’administration et de développement</p></li>
<li><p>Ajout d’une documentation de migration de données Serena vers GeoNature (<a class="reference external" href="https://github.com/PnX-SI/Ressources-techniques/tree/master/GeoNature/migration/serena">https://github.com/PnX-SI/Ressources-techniques/tree/master/GeoNature/migration/serena</a>) par &#64;xavyeah39</p></li>
</ul>
<p><strong>Note de version</strong></p>
<ul>
<li><p>Vous pouvez passer directement à cette version, mais en suivant les notes des versions intermédiaires</p></li>
<li><p>Exécutez la mise à jour de la BDD GeoNature (<code class="docutils literal notranslate"><span class="pre">data/migrations/2.0.0rc4.1to2.0.0rc4.2.sql</span></code>)</p></li>
<li><p>Depuis la version 2.0.0-rc.4, on ne stocke plus les modules de GeoNature dans <code class="docutils literal notranslate"><span class="pre">utilisateurs.t_applications</span></code>. On ne peut donc plus associer les sites de suivi de <code class="docutils literal notranslate"><span class="pre">gn_monitoring</span></code> à des applications, utilisé par les modules de suivi (Flore, habitat, chiro). Le mécanisme est remplacé par une association des sites de suivi aux modules. La création de la nouvelle table est automatisée (<code class="docutils literal notranslate"><span class="pre">data/migrations/2.0.0rc4.1to2.0.0rc4.2.sql</span></code>), mais pas la migration des éventuelles données existantes de <code class="docutils literal notranslate"><span class="pre">gn_monitoring.cor_site_application</span></code> vers <code class="docutils literal notranslate"><span class="pre">gn_monitoring.cor_site_module</span></code>, à faire manuellement.</p></li>
<li><p>Afin que les logs de l’application soient tous écrits au même endroit, modifier le fichier <code class="docutils literal notranslate"><span class="pre">geonature-service.conf</span></code> (<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">nano</span> <span class="pre">/etc/supervisor/conf.d/geonature-service.conf</span></code>). A la ligne <code class="docutils literal notranslate"><span class="pre">stdout_logfile</span></code>, remplacer la ligne existante par <code class="docutils literal notranslate"><span class="pre">stdout_logfile</span> <span class="pre">=</span> <span class="pre">/home/&lt;MON_USER&gt;/geonature/var/log/gn_errors.log</span></code> (en remplaçant &lt;MON_USER&gt; par votre utilisateur linux).</p></li>
<li><p>Vous pouvez également mettre en place un système de logs rotatifs (système permettant d’archiver les fichiers de logs afin qu’ils ne surchargent pas le serveur - conseillé si votre serveur a une capacité disque limitée). Créer le fichier suivant <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">nano</span> <span class="pre">/etc/logrotate.d/geonature</span></code> puis copiez les lignes suivantes dans le fichier nouvellement créé (en remplaçant &lt;MON_USER&gt; par votre utilisateur linux)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/&lt;</span><span class="n">MON_USER</span><span class="o">&gt;/</span><span class="n">geonature</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/*.</span><span class="n">log</span> <span class="p">{</span>
<span class="n">daily</span>
<span class="n">rotate</span> <span class="mi">8</span>
<span class="n">size</span> <span class="mi">100</span><span class="n">M</span>
<span class="n">create</span>
<span class="n">compress</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Exécutez ensuite la commande <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">logrotate</span> <span class="pre">-f</span> <span class="pre">/etc/logrotate.conf</span></code></p>
</li>
<li><p>Suivez ensuite la procédure classique de mise à jour de GeoNature (<a class="reference external" href="http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application">http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application</a>)</p></li>
</ul>
</section>
<section id="rc-4-1-2019-01-21">
<h2>2.0.0-rc.4.1 (2019-01-21)<a class="headerlink" href="#rc-4-1-2019-01-21" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Corrections</strong></p>
<ul class="simple">
<li><p>Mise à jour des paquets du frontend (#538)</p></li>
<li><p>Correction d’un conflit entre Marker et Leaflet-draw</p></li>
<li><p>Utilisation du paramètre <code class="docutils literal notranslate"><span class="pre">ID_APP</span></code> au niveau de l’application</p></li>
<li><p>Corrections mineures diverses</p></li>
</ul>
<p><strong>Note de version</strong></p>
<ul class="simple">
<li><p>Sortie de versions correctives de UsersHub (2.0.2 - <a class="reference external" href="https://github.com/PnX-SI/UsersHub/releases">https://github.com/PnX-SI/UsersHub/releases</a>) et TaxHub (1.6.1 - <a class="reference external" href="https://github.com/PnX-SI/TaxHub/releases">https://github.com/PnX-SI/TaxHub/releases</a>) à appliquer aussi</p></li>
<li><p>Vous pouvez vous référer à la documentation globale de mise à jour de GeoNature RC3 vers RC4 par &#64;DonovanMaillard (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/docs/update-all-RC3-to-RC4.rst">https://github.com/PnX-SI/GeoNature/blob/master/docs/update-all-RC3-to-RC4.rst</a>)</p></li>
</ul>
</section>
<section id="rc-4-2019-01-15">
<h2>2.0.0-rc.4 (2019-01-15)<a class="headerlink" href="#rc-4-2019-01-15" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Nouveautés</strong></p>
<ul class="simple">
<li><p>Intégration de la gestion des permissions (CRUVED) dans la BDD de GeoNature, géré via une interface d’administration dédié (#517)</p></li>
<li><p>Mise en place d’un système de permissions plus fin par module et par objet (#517)</p></li>
<li><p>Mise en place d’un mécanimse générique pour la gestion des permissions via des filtres : filtre de type portée (SCOPE), taxonomique, géographique etc… (#517)</p></li>
<li><p>Compatibilité avec UsersHub version 2</p></li>
<li><p>L’administration des permissions ne propose que les rôles qui sont actif et qui ont un profil dans GeoNature</p></li>
<li><p>Ajout du composant Leaflet.FileLayer dans le module Synthèse pour pouvoir charger un GeoJSON, un GPS ou KML sur la carte comme géométrie de recherche (#256)</p></li>
<li><p>Ajout et utilisation de l’extension PostgreSQL <code class="docutils literal notranslate"><span class="pre">pg_tgrm</span></code> permettant d’améliorer l’API d’autocomplétion de taxon dans la synthèse, en utilisant l’algorithme des trigrammes (<a class="reference external" href="http://si.ecrins-parcnational.com/blog/2019-01-fuzzy-search-taxons.html">http://si.ecrins-parcnational.com/blog/2019-01-fuzzy-search-taxons.html</a>), fonctionnel aussi dans les autres modules si vous mettez à jour TaxHub en version 1.6.0.</p></li>
<li><p>Nouvel exemple d’import de données historiques vers GeoNature V2 : <a class="reference external" href="https://github.com/PnX-SI/Ressources-techniques/blob/master/GeoNature/V2/2018-12-csv-vers-synthese-FLAVIA.sql">https://github.com/PnX-SI/Ressources-techniques/blob/master/GeoNature/V2/2018-12-csv-vers-synthese-FLAVIA.sql</a> (par &#64;DonovanMaillard)</p></li>
<li><p>Complément de la documentation HTTPS et ajout d’une documentation Apache (par &#64;DonovanMaillard, &#64;RomainBaghi et &#64;lpofredc)</p></li>
</ul>
<p><strong>Corrections</strong></p>
<ul class="simple">
<li><p>Correction de l’id_digitiser lors de la mise à jour (#481)</p></li>
<li><p>Corrections multiples de la prise en compte du CRUVED (#496)</p></li>
<li><p>Deconnexion apres inactivité de l’utilisateur (#490)</p></li>
<li><p>Suppression des heures au niveau des dates de l’export occtax (#485)</p></li>
<li><p>Correction du message d’erreur quand on n’a pas de JDD (#479)</p></li>
<li><p>Correction du champs commentaire dans les exports d’Occtax séparé entre relevé et occurrence (#478)</p></li>
<li><p>Correction des paramètres de la fonction <code class="docutils literal notranslate"><span class="pre">GenericQuery.build_query_filter()</span></code> (par &#64;patkap)</p></li>
<li><p>Correction de l’administration des métadonnées (#466 #420)</p></li>
<li><p>Métadonnées (JDD et CA) : ne pas afficher les utilisateurs qui sont des groupes dans les acteurs</p></li>
<li><p>Ajout d’un champs dans la Synthèse permettant de stocker de quel module provient une occurrence et fonctions SQL associées (#412)</p></li>
<li><p>Amélioration du style des champs obligatoires</p></li>
<li><p>Améliorations mineures de l’ergonomie d’Occtax</p></li>
<li><p>Correction du spinner qui tournait en boucle lors de l’export CSV de la Synthèse (#451)</p></li>
<li><p>Correction des tests automatisés</p></li>
<li><p>Amélioration des performances des intersections avec les zonages de <code class="docutils literal notranslate"><span class="pre">ref_geo.l_areas</span></code></p></li>
<li><p>Complément de la documentation de développement</p></li>
<li><p>Simplification de la configuration des gn_modules</p></li>
<li><p>Occtax : ordonnancement des observation par date (#467)</p></li>
<li><p>Occtax : Remplissage automatique de l’heure_max à partir de l’heure_min (#522)</p></li>
<li><p>Suppression des warnings lors du build du frontend</p></li>
<li><p>Correction de l’installation des modules GeoNature</p></li>
<li><p>Ajout d’un message quand on n’a pas accès à une donnée d’un module</p></li>
<li><p>Affichage du nom du module dans le Header (#398)</p></li>
<li><p>Correction des outils cartographiques dans Occtax</p></li>
<li><p>Correction complémentaire des styles des lignes sans remplissage (#458)</p></li>
<li><p>MaplistService : correction du zoom sur les polygones et polylignes</p></li>
<li><p>Composant Areas et Municipalities : remise à zéro de la liste déroulante quand on efface la recherche ou remet à jour les filtres</p></li>
<li><p>Composant Taxonomy : la recherche autocompletée est lancée même si on tape plus de 20 caractères. Le nombre de résultat renvoyé est désormais paramétrable (#518)</p></li>
<li><p>Limitation du nombre de connexions à la BDD en partageant l’instance <code class="docutils literal notranslate"><span class="pre">DB</span></code> avec les sous-modules</p></li>
<li><p>Installation : utilisation d’un répertoire <code class="docutils literal notranslate"><span class="pre">tmp</span></code> local et non plus au niveau système pour limiter les problèmes de droits (#503)</p></li>
<li><p>Evolution du template d’exemple de module GeoNature (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/tree/master/contrib/module_example">https://github.com/PnX-SI/GeoNature/tree/master/contrib/module_example</a>) pour utiliser l’instance DB et utiliser les nouveaux décorateurs de permissions (CRUVED)</p></li>
</ul>
<p><strong>Note de version</strong></p>
<ul class="simple">
<li><p>Si vous effectuez une migration de GeoNature RC3 vers cette nouvelle version, il est nécessaire d’avoir installé UsersHub version 2.x au préalable. Suivez donc sa documentation (<a class="reference external" href="https://github.com/PnX-SI/UsersHub/releases">https://github.com/PnX-SI/UsersHub/releases</a>) avant de procéder à la montée de version de GeoNature.</p></li>
<li><p>Exécuter la commande suivante pour ajouter l’extension <code class="docutils literal notranslate"><span class="pre">pg_trgm</span></code>, en remplaçant la variable <code class="docutils literal notranslate"><span class="pre">$db_name</span></code> par le nom de votre BDD : <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">-n</span> <span class="pre">-u</span> <span class="pre">postgres</span> <span class="pre">-s</span> <span class="pre">psql</span> <span class="pre">-d</span> <span class="pre">$db_name</span> <span class="pre">-c</span> <span class="pre">&quot;CREATE</span> <span class="pre">EXTENSION</span> <span class="pre">IF</span> <span class="pre">NOT</span> <span class="pre">EXISTS</span> <span class="pre">pg_trgm;&quot;</span></code></p></li>
<li><p>Mettez à jour TaxHub en version 1.6.0 pour bénéficier de l’amélioration de la recherche taxonomique dans tous les modules</p></li>
<li><p>Exécutez la mise à jour de la BDD GeoNature (<code class="docutils literal notranslate"><span class="pre">data/migrations/2.0.0rc3.1-to-2.0.0rc4.sql</span></code>)</p></li>
<li><p>Suivez ensuite la procédure classique de mise à jour de GeoNature (<a class="reference external" href="http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application">http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application</a>)</p></li>
</ul>
<p><strong>Note développeurs</strong></p>
<ul class="simple">
<li><p>Vous pouvez faire évoluer les modules GeoNature en utilisant l’instance <code class="docutils literal notranslate"><span class="pre">DB</span></code> de GeoNature pour lancer les scripts d’installation (#498)</p></li>
<li><p>Il n’est plus nécéssaire de définir un <code class="docutils literal notranslate"><span class="pre">id_application</span></code> dans la configuration des modules GeoNature.</p></li>
<li><p>La gestion des permissions a été revue et est désormais internalisée dans GeoNature (voir <a class="reference external" href="http://docs.geonature.fr/development.html#developpement-backend">http://docs.geonature.fr/development.html#developpement-backend</a>), il est donc necessaire d’utiliser les nouveaux décorateurs décrit dans la doc pour récupérer le CRUVED.</p></li>
</ul>
</section>
<section id="rc-3-1-2018-10-21">
<h2>2.0.0-rc.3.1 (2018-10-21)<a class="headerlink" href="#rc-3-1-2018-10-21" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Corrections</strong></p>
<ul class="simple">
<li><p>Correction du script <code class="docutils literal notranslate"><span class="pre">ìnstall_all.sh</span></code> au niveau de la génération de la configuration Apache de TaxHub et UsersHub (#493)</p></li>
<li><p>Suppression du Servername dans la configuration Apache de TaxHub du script <code class="docutils literal notranslate"><span class="pre">install_all.sh</span></code></p></li>
<li><p>Complément de la documentation de mise à jour de GeoNature (<a class="reference external" href="http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application">http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application</a>)</p></li>
</ul>
<p><strong>Notes de version</strong></p>
<ul class="simple">
<li><p>Si vous migrez depuis une version 2.0.0-rc.2, installez directement cette version corrective plutôt que la 2.0.0-rc.3, mais en suivant les notes de versions de la 2.0.0-rc.3</p></li>
<li><p>Pour mettre en place la redirection de TaxHub sans <code class="docutils literal notranslate"><span class="pre">/</span></code>, consultez sa documentation <a class="reference external" href="https://taxhub.readthedocs.io/fr/latest/installation.html#configuration-apache">https://taxhub.readthedocs.io/fr/latest/installation.html#configuration-apache</a></p></li>
<li><p>Le script <code class="docutils literal notranslate"><span class="pre">install_all.sh</span></code> actuel ne semble pas fonctionner sur Debian 8, problème de version de PostGIS qui ne s’installe pas correctement</p></li>
</ul>
</section>
<section id="rc-3-2018-10-18">
<h2>2.0.0-rc.3 (2018-10-18)<a class="headerlink" href="#rc-3-2018-10-18" title="Lien permanent vers cette rubrique"></a></h2>
<ul class="simple">
<li><p>Possibilité d’utiliser le MNT en raster ou en vecteur dans la BDD (+ doc MNT) #439 (merci &#64;mathieubossaert)</p></li>
<li><p>INSTALL_ALL - gestion du format date du serveur PostgreSQL (#435)</p></li>
<li><p>INSTALL_ALL - Amélioration de la conf Apache de TaxHub pour gérer son URL sans <code class="docutils literal notranslate"><span class="pre">/</span></code> à la fin</p></li>
<li><p>Dessin cartographique d’une autre couleur (rouge) que les observations (bleu)</p></li>
<li><p>Occtax : retour au zoom précédent lors de l’enchainement de relevé (#436)</p></li>
<li><p>Occtax : observateur rempli par défaut avec l’utilisateur connecté (#438)</p></li>
<li><p>Prise en compte des géométries nulles dans la fonction <code class="docutils literal notranslate"><span class="pre">serializegeofn</span></code></p></li>
<li><p>Gestion plus complète des données exemple intégrées ou non lors de l’installation (#446)</p></li>
<li><p>Complément des différentes documentations</p></li>
<li><p>Complément FAQ (#441)</p></li>
<li><p>Documentation de la customisation (merci &#64;DonovanMaillard)</p></li>
<li><p>Amélioration de l’architecture du gn_module d’exemple</p></li>
<li><p>Clarification de la configuration des gn_modules</p></li>
<li><p>Lire le fichier <code class="docutils literal notranslate"><span class="pre">VERSION</span></code> pour l’afficher dans l’interface (#421)</p></li>
<li><p>Utilisation de la vue <code class="docutils literal notranslate"><span class="pre">export_occtax_sinp</span></code> et non plus <code class="docutils literal notranslate"><span class="pre">export_occtax_dlb</span></code> par défaut pour les exports Occtax (#462)</p></li>
<li><p>Complément et correction des vues <code class="docutils literal notranslate"><span class="pre">export_occtax_sinp</span></code> et <code class="docutils literal notranslate"><span class="pre">export_occtax_dlb</span></code> (#462)</p></li>
<li><p>Mise à jour de Marshmallow (2.5.0 =&gt; 2.5.1)</p></li>
<li><p>Améliorations des routes de <code class="docutils literal notranslate"><span class="pre">gn_monitoring</span></code> et de la configuration des modules de suivi pour pouvoir utiliser le nom d’une application plutôt que son identifiant</p></li>
<li><p>Export Synthèse - Remplacement de la barre de téléchargement par un spinner (#451)</p></li>
</ul>
<p><strong>Corrections</strong></p>
<ul class="simple">
<li><p>Doc Import niveau 2 : Corrections et compléments</p></li>
<li><p>Correction du trigger Occtax &gt; Synthèse qui met à jour le champs <code class="docutils literal notranslate"><span class="pre">gn_synthese.observers_txt</span></code> et les commentaires (#448 et #459)</p></li>
<li><p>Correction et amélioration de la fonction <code class="docutils literal notranslate"><span class="pre">install_gn_module</span></code></p></li>
<li><p>Correction coquille dans le modèle <code class="docutils literal notranslate"><span class="pre">gn_monitoring</span></code> et la fonction <code class="docutils literal notranslate"><span class="pre">serializegeofn</span></code></p></li>
<li><p>Installation uniquement sur un environnement 64 bits (documentation + vérification) #442 (merci &#64;jbrieuclp et &#64;sig-pnrnm)</p></li>
<li><p>Correction et découpage des scripts de mise à jour de la BDD depuis la version Beta5</p></li>
<li><p>Correction de l’édition des date_debut et date_fin de Occtax (#457)</p></li>
<li><p>Correction des exports depuis la Synthèse et intégration de la géométrie des observations (#461 et #456)</p></li>
<li><p>Ne pas remplir <code class="docutils literal notranslate"><span class="pre">pr_occtax.cor_role_releves_occtax</span></code> si <code class="docutils literal notranslate"><span class="pre">observers_txt</span> <span class="pre">=</span> <span class="pre">true</span></code> (#463)</p></li>
<li><p>Edition d’un relevé Occtax - Ne pas recalculer l’altitude existante (#424)</p></li>
<li><p>Correction de l’activation du formulaire Occtax après localisation du relevé (#469 et #471)</p></li>
<li><p>Carte - Enlever le remplissage des lignes (#458)</p></li>
<li><p>Amélioration du script de mise à jour de GeoNature (<code class="docutils literal notranslate"><span class="pre">install/migration/migration.sh</span></code>) (#465)</p></li>
<li><p>Suppression d’un doublon dans le modèle de <code class="docutils literal notranslate"><span class="pre">gn_commons.t_modules</span></code> (merci &#64;lpofredc)</p></li>
</ul>
<p><strong>Autres</strong></p>
<ul class="simple">
<li><p>Mise à jour de TaxHub (Doc utilisateur, configuration Apache, script d’import des médias depuis API INPN Taxref et remise à zéro des séquences)</p></li>
<li><p>Script de migration des données SICEN (ObsOcc) vers GeoNature : <a class="reference external" href="https://github.com/PnX-SI/Ressources-techniques/tree/master/GeoNature/migration/sicen">https://github.com/PnX-SI/Ressources-techniques/tree/master/GeoNature/migration/sicen</a></p></li>
<li><p>Script d’import continu depuis une BDD externe vivante (avec exemple SICEN) : <a class="reference external" href="https://github.com/PnX-SI/Ressources-techniques/tree/master/GeoNature/migration/generic">https://github.com/PnX-SI/Ressources-techniques/tree/master/GeoNature/migration/generic</a></p></li>
<li><p>Module Suivi Flore Territoire fonctionnel et installable (<a class="reference external" href="https://github.com/PnX-SI/gn_module_suivi_flore_territoire">https://github.com/PnX-SI/gn_module_suivi_flore_territoire</a>)</p></li>
<li><p>Module Suivi Chiro fonctionnel et installable (<a class="reference external" href="https://github.com/PnCevennes/gn_module_suivi_chiro">https://github.com/PnCevennes/gn_module_suivi_chiro</a>) ainsi que son Frontend générique pour les protocoles de suivi (<a class="reference external" href="https://github.com/PnCevennes/projet_suivis_frontend/">https://github.com/PnCevennes/projet_suivis_frontend/</a>)</p></li>
<li><p>Ebauche d’un module pour les protocoles CMR (Capture-Marquage-Recapture) : <a class="reference external" href="https://github.com/PnX-SI/gn_module_cmr">https://github.com/PnX-SI/gn_module_cmr</a></p></li>
<li><p>MCD du module Suivi Habitat Territoire (<a class="reference external" href="https://github.com/PnX-SI/gn_module_suivi_habitat_territoire">https://github.com/PnX-SI/gn_module_suivi_habitat_territoire</a>)</p></li>
<li><p>MCD du module Flore Prioritaire (<a class="reference external" href="https://github.com/PnX-SI/gn_module_flore_prioritaire">https://github.com/PnX-SI/gn_module_flore_prioritaire</a>)</p></li>
<li><p>Consolidation du backend et premiers développements du frontend de GeoNature-citizen (<a class="reference external" href="https://github.com/PnX-SI/GeoNature-citizen">https://github.com/PnX-SI/GeoNature-citizen</a>)</p></li>
<li><p>Création d’un script expérimental d’installation de GeoNature-atlas compatible avec GeoNature V2 dt pouvant utiliser son schéma <code class="docutils literal notranslate"><span class="pre">ref_geo</span></code> pour les communes, le territoire et les mailles (<a class="reference external" href="https://github.com/PnX-SI/GeoNature-atlas/blob/develop/install_db_gn2.sh">https://github.com/PnX-SI/GeoNature-atlas/blob/develop/install_db_gn2.sh</a>)</p></li>
</ul>
<p><strong>Notes de version</strong></p>
<ul class="simple">
<li><p>Suivez la procédure standard de mise à jour de GeoNature (<a class="reference external" href="http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application">http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application</a>)</p></li>
<li><p>Exécutez l’update de la BDD GeoNature (<code class="docutils literal notranslate"><span class="pre">data/migrations/2.0.0rc2-to-2.0.0rc3.sql</span></code>)</p></li>
<li><p>Il est aussi conseillé de mettre à jour TaxHub en 1.5.1 (<a class="reference external" href="https://github.com/PnX-SI/TaxHub/releases">https://github.com/PnX-SI/TaxHub/releases</a>) ainsi que sa configuration pour qu’il fonctionne sans <code class="docutils literal notranslate"><span class="pre">/</span></code> à la fin de son URL</p></li>
<li><p>Attention, si vous installez cette version avec le script global <code class="docutils literal notranslate"><span class="pre">install_all.sh</span></code>, il créé un problème dans la configuration Apache de UserHub (<code class="docutils literal notranslate"><span class="pre">/etc/apache2/sites-available/usershub.conf</span></code>) et supprime tous les <code class="docutils literal notranslate"><span class="pre">/</span></code>. Les ajouter sur la page de la documentation de UsersHub (<a class="reference external" href="https://github.com/PnX-SI/UsersHub/blob/master/docs/installation.rst#configuration-apache">https://github.com/PnX-SI/UsersHub/blob/master/docs/installation.rst#configuration-apache</a>) puis relancer Apache (<code class="docutils literal notranslate"><span class="pre">https://github.com/PnX-SI/GeoNature-atlas/blob/develop/docs/installation.rst</span></code>). Il est conseillé d’installer plutôt la version corrective.</p></li>
</ul>
</section>
<section id="rc-2-2018-09-24">
<h2>2.0.0-rc.2 (2018-09-24)<a class="headerlink" href="#rc-2-2018-09-24" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Nouveautés</strong></p>
<ul class="simple">
<li><p>Script <code class="docutils literal notranslate"><span class="pre">install_all.sh</span></code> compatible Ubuntu (16 et 18)</p></li>
<li><p>Amélioration du composant Download</p></li>
<li><p>Amélioration du ShapeService</p></li>
<li><p>Compléments de la documentation</p></li>
<li><p>Intégration de la documentation Développement backend dans la documentation</p></li>
<li><p>Nettoyage du code</p></li>
<li><p>Mise à jour de la doc de l’API : <a class="reference external" href="https://documenter.getpostman.com/view/2640883/RWaPskTw">https://documenter.getpostman.com/view/2640883/RWaPskTw</a></p></li>
<li><p>Configuration de la carte (<code class="docutils literal notranslate"><span class="pre">frontend/src/conf/map.config.ts</span></code>) : OSM par défaut car OpenTopoMap ne s’affiche pas à petite échelle</p></li>
</ul>
<p><strong>Corrections</strong></p>
<ul class="simple">
<li><p>Correction du script <code class="docutils literal notranslate"><span class="pre">install/migration/migration.sh</span></code></p></li>
<li><p>Ne pas afficher le debug dans le recherche de la synthèse</p></li>
<li><p>Correction du bug de déconnexion entre TaxHub et GeoNature (#423)</p></li>
<li><p>Correction de la fiche info d’Occtax</p></li>
<li><p>Champs Multiselect : Ne pas afficher les valeurs selectionnées dans la liste quand on modifie un objet</p></li>
<li><p>Trigger Occtax vers Synthèse : Correction des problèmes d’heure de relevés mal copiés dans la Synthèse</p></li>
<li><p>Correction des altitudes (non abouti) (#424)</p></li>
<li><p>Données exemple : Suppression de l”<code class="docutils literal notranslate"><span class="pre">observers_txt</span></code> dans la synthèse</p></li>
<li><p>Suppression d’un <code class="docutils literal notranslate"><span class="pre">id_municipality</span></code> en dur dans une route</p></li>
<li><p>Suppression de la librairie Certifi non utilisée</p></li>
</ul>
<p><strong>Notes de version</strong></p>
<ul class="simple">
<li><p>Suivez la procédure standard de mise à jour de GeoNature</p></li>
<li><p>Exécuter l’update de la BDD GeoNature (<code class="docutils literal notranslate"><span class="pre">data/migrations/2.0.0rc1-to-2.0.0rc2.sql</span></code>)</p></li>
</ul>
</section>
<section id="rc-1-2018-09-21">
<h2>2.0.0-rc.1 (2018-09-21)<a class="headerlink" href="#rc-1-2018-09-21" title="Lien permanent vers cette rubrique"></a></h2>
<p>La version 2 de GeoNature est une refonte complète de l’application.</p>
<ul class="simple">
<li><p>Refonte technologique en migrant de PHP/Symfony/ExtJS/Openlayers à Python3/Flask/Angular4/Leaflet</p></li>
<li><p>Refonte de l’architecture du code pour rendre GeoNature plus générique et modulaire</p></li>
<li><p>Refonte de la base de données pour la rendre plus standarde, plus générique et modulaire</p></li>
<li><p>Refonte ergonomique pour moderniser l’application</p></li>
</ul>
<p>Présentation et suivi des développements : <a class="reference external" href="https://github.com/PnX-SI/GeoNature/issues/168">https://github.com/PnX-SI/GeoNature/issues/168</a></p>
<p><strong>Accueil</strong></p>
<ul class="simple">
<li><p>Message d’introduction customisable</p></li>
<li><p>Carte des 100 dernières observations</p></li>
<li><p>CSS général de l’application surcouchable</p></li>
</ul>
<p><strong>Occtax</strong></p>
<p>Module permettant de saisir, consulter, rechercher et exporter des données Faune, Flore et Fonge de type Contact selon le standard Occurrences de taxon du SINP (<a class="reference external" href="https://inpn.mnhn.fr/telechargement/standard-occurrence-taxon">https://inpn.mnhn.fr/telechargement/standard-occurrence-taxon</a>).</p>
<ul class="simple">
<li><p>Développement des formulaires de saisie, page de recherche, fiche détail, API, CRUVED et export</p></li>
<li><p>Possibilité de masquer ou afficher les différents champs dans le formulaire Occtax (#344)</p></li>
<li><p>Développement du formulaire de manière générique pour pouvoir réutiliser ses différents éléments dans d’autres modules sous forme de composants Angular</p></li>
<li><p>Configuration possible du module (Niveau de zoom, champs affichées, export…)</p></li>
<li><p>Ajout des nomenclatures dans les filtres d’Occtax à partir du composant <code class="docutils literal notranslate"><span class="pre">dynamicForm</span></code> qui permet de créer dynamiquement un formulaire en déclarant ses champs et leur type (#318)</p></li>
<li><p>Amélioration du composant de recherche d’un taxon en ne recherchant que sur les débuts de mot et en affichant en premier les noms de référence (<code class="docutils literal notranslate"><span class="pre">ordrer_by</span> <span class="pre">cd_nom=cd_ref</span> <span class="pre">DESC</span></code>) #334</p></li>
<li><p>Multilingue fourni avec français et anglais (extensible à d’autres langues)</p></li>
<li><p>Mise en place d’un export CSV, SHP, GeoJSON paramétrable dans Occtax. #363 et #366</p></li>
<li><p>Ajout d’un message d’erreur si l’utilisateur n’a pas de jeu de données ou si il y a eu un problème lors de la récupération des JDD depuis MTD</p></li>
<li><p>Prise en compte du CRUVED au niveau des routes et du front pour adapter les contenus et fonctionnalités aux droits de l’utilisateur</p></li>
<li><p>Mise en place des triggers alimentant la synthèse à partir des données saisies et modifiées dans Occtax</p></li>
</ul>
<p><strong>Synthèse</strong></p>
<p>Module permettant de rechercher parmi les données des différentes sources présentes ou intégrées dans la base de données de GeoNature</p>
<ul class="simple">
<li><p>Mise en place du backend, de l’API et du frontend #345</p></li>
<li><p>Interface de consultation, de recherche et d’export dans la Synthèse</p></li>
<li><p>Synthèse : Calcul automatique (trigger) des zonages de chaque observation (communes, zonages réglementaires et naturels)</p></li>
<li><p>Recherche sur les zonages générique et paramétrable</p></li>
<li><p>Recherche par taxon, liste de taxons, par rang, groupe, liste rouge, milieu, attribut taxonomique, nomenclature, date, période, commune, zonage, cadre d’acquisition, jeu de données, observateur, polygone, rectange ou cercle dessiné</p></li>
<li><p>Retour à la fiche source possible si l’observation a été saisie dans un module de GeoNature</p></li>
<li><p>Affichage de la fiche détail de chaque observation</p></li>
<li><p>Attributs TaxHub dynamiques et paramétrables</p></li>
<li><p>Configuration possible du module (colonnes, limites de recherche et d’export, zoom, export…)</p></li>
<li><p>Export basé sur une vue (observations et statuts)</p></li>
<li><p>Prise en compte du CRUVED pour définir les données à afficher et à exporter #412</p></li>
<li><p>Recherche de taxons : Liste basée sur une table alimentée automatiquement par les taxons présents au moins une fois dans la Synthèse</p></li>
</ul>
<p><strong>Export</strong></p>
<p>Module permettant de proposer des exports basés sur des vues</p>
<ul class="simple">
<li><p>Mise en place temporaire d’un export unique, basé sur une vue s’appuyant sur les données de Occtax, par jeu de données</p></li>
<li><p>A remplacer par le module générique <a class="reference external" href="https://github.com/PnX-SI/gn_module_export">https://github.com/PnX-SI/gn_module_export</a> (en cours de développement) permettant de générer des exports à volonté en créant des vues et en les affectant à des utilisateurs ou des groupes. Chaque export sera accompagné de son API standardisée et documentée</p></li>
</ul>
<p><strong>Admin</strong></p>
<p>Module d’administration des tables centrales de GeoNature</p>
<ul class="simple">
<li><p>Mise en place d’un module (incomplet) permettant de gérer les métadonnées et les nomenclatures</p></li>
</ul>
<p><strong>Gestion des droits</strong></p>
<ul class="simple">
<li><p>Mise en place d’un système baptisé CRUVED permettant de définir globalement ou par module 6 actions sont possibles (Create / Read / Update / Validate / Export / Delete) sur 3 portées possibles (Mes données / Les données de mon organisme / Toutes les données)</p></li>
<li><p>Ces évolutions ont été intégrées au niveau du schéma <code class="docutils literal notranslate"><span class="pre">utilisateurs</span></code> de la base de données de UsersHub, de son module (<a class="reference external" href="https://github.com/PnX-SI/UsersHub-authentification-module">https://github.com/PnX-SI/UsersHub-authentification-module</a>), des routes de l’API GeoNature et des interfaces</p></li>
</ul>
<p><strong>Bases de données</strong></p>
<ul class="simple">
<li><p>Développement d’un module et d’une API générique et autonome pour la gestion des nomenclatures (<a class="reference external" href="https://github.com/PnX-SI/Nomenclature-api-module">https://github.com/PnX-SI/Nomenclature-api-module</a>). Il permet d’avoir un mécanisme générique de centralisation des listes de valeurs (nomenclatures) pour ne pas créer des tables pour chaque liste : <a class="reference external" href="https://github.com/PnX-SI/Nomenclature-api-module">https://github.com/PnX-SI/Nomenclature-api-module</a>. Les valeurs de chaque nomenclature s’adaptent en fonction des regnes et groupe 2 INPN des taxons.</p></li>
<li><p>Mise en place de tables de stockage verticales (historique, médias et validation) #339</p></li>
<li><p>Mise en place d’un référentiel géographique avec un schéma dédié (<code class="docutils literal notranslate"><span class="pre">ref_geo</span></code>), partageable avec d’autres applications comprenant une table des communes, une table générique des zonages, une table pour le MNT et des fonctions pour intersecter point/ligne/polygones avec les zonages et le MNT (#228)</p></li>
<li><p>Evolution du schéma <code class="docutils literal notranslate"><span class="pre">utilisateurs</span></code> de UsersHub pour passer d’une gestion des droits avec 6 niveaux à un mécanisme plus générique, souple et complet. Il permet d’attribuer des actions possibles à un rôle (utilisateur ou groupe), sur une portée; dans une application ou un module. 6 actions sont possibles dans GeoNature : Create / Read / Update / Validate / Export / Delete (aka CRUVED). 3 portées de ces actions sont possibles : Mes données / Les données de mon organisme / Toutes les données.</p></li>
<li><p>Droits CRUVED : La définition du CRUVED d’un rôle (utilisateur ou groupe) sur un module de GeoNature surcouche ses droits GeoNature même si ils sont inférieurs. Si une action du CRUVED n’est pas définie au niveau du module, on prend celle de l’application parente. #292</p></li>
<li><p>Si un rôle a un R du CRUVED à 0 pour un module, alors celui-ci ne lui est pas listé dans le Menu et il ne lui est pas accessible si il en connait l’URL. #360</p></li>
<li><p>Développement des métadonnées dans la BDD (schéma <code class="docutils literal notranslate"><span class="pre">gn_meta</span></code>) sur la base du standard Métadonnées du SINP (<a class="reference external" href="http://standards-sinp.mnhn.fr/category/standards/metadonnees/">http://standards-sinp.mnhn.fr/category/standards/metadonnees/</a>). Elles permettent de gérer des jeux de données, des cadres d’acquisition, des acteurs (propriétaire, financeur, producteur…) et des protocoles. Chaque relevé est associé à un jeu de données.</p></li>
<li><p>Développement d’un mécanisme de calcul automatique de la sensibilité d’une espèce directement dans la BDD (sur la base des règles nationales et régionales du SINP + locales éventuellement)</p></li>
<li><p>Intégration du calcul automatique de l’identifiant permanent SINP (#209)</p></li>
<li><p>Création du schéma <code class="docutils literal notranslate"><span class="pre">gn_monitoring</span></code> pour gérer la partie générique des modules de suivi (sites et visites centralisés) et les routes associées</p></li>
<li><p>Mise en place d’un schéma <code class="docutils literal notranslate"><span class="pre">gn_commons</span></code> dans la BDD qui permet de stocker de manière générique des informations qui peuvent être communes aux autres modules : l’historique des actions sur chaque objet de la BDD, la validation d’une donnée et les médias associés à une donnée. Accompagné de fonctions génériques d’historisation et de validation des données mises en place sur le module Occtax. #339</p></li>
<li><p>Ajout d’une vue matérialisée (<code class="docutils literal notranslate"><span class="pre">gn_synthese.vm_min_max_for_taxons</span></code>) et d’une fonction (<code class="docutils literal notranslate"><span class="pre">gn_synthese.fct_calculate_min_max_for_taxon</span></code>) permettant de renvoyer des informations sur les observations existantes d’un taxon (étendue des observations, date min et max, altitude min et max, nombre d’observations) pour orienter la validation et la saisie (<a class="reference external" href="https://github.com/PnX-SI/gn_module_validation/issues/5">https://github.com/PnX-SI/gn_module_validation/issues/5</a>). Désactivée pour le moment.</p></li>
<li><p>Ajout d’un trigger générique pour calculer la géométrie dans la projection locale à partir de la géométrie 4326 (#370)</p></li>
<li><p>Ajout d’un trigger pour calculer automatiquement les zonages des sites de suivi (<code class="docutils literal notranslate"><span class="pre">gn_monitoring.fct_trg_cor_site_area()</span></code>)</p></li>
<li><p>Gestion des conflits de nomenclatures en n’utilisant plus leur <code class="docutils literal notranslate"><span class="pre">id_type</span></code> ni leur <code class="docutils literal notranslate"><span class="pre">id_nomenclature</span></code> lors de la création de leur contenu (code_nomenclature) (#384)</p></li>
<li><p>Mise en place d’un schéma <code class="docutils literal notranslate"><span class="pre">gn_imports</span></code> intégrant des fonctions SQL permettant d’importer un CSV dans la BDD et de mapper des champs de tables importées avec ceux d’une table de GeoNature pour générer le script <code class="docutils literal notranslate"><span class="pre">INSERT</span> <span class="pre">INTO</span></code></p></li>
<li><p>Début de script de migration GeoNature V1 vers GeoNature V2</p></li>
<li><p>Nombreuses fonctions intégrées dans les schémas de la BDD</p></li>
</ul>
<p><strong>Installation</strong></p>
<ul class="simple">
<li><p>Scripts d’installation autonome ou globale de GeoNature sur Debian (8 et 9) et Ubuntu (16 et 18)</p></li>
<li><p>Scripts de déploiement spécifiques de DEPOBIO (MTES-MNHN)</p></li>
</ul>
<p><strong>Documentation</strong></p>
<ul class="simple">
<li><p>Rédaction d’une documentation concernant l’installation (autonome ou globale), l’utilisation, l’administration et le développement : <a class="reference external" href="http://docs.geonature.fr">http://docs.geonature.fr</a></p></li>
</ul>
<p><strong>Développement</strong></p>
<ul class="simple">
<li><p>Découpage de l’application en backend / API / Frontend</p></li>
<li><p>Multilingue au niveau de l’interface et des listes de valeurs avec français et anglais intégrés mais extensible à d’autres langues (#173)</p></li>
<li><p>Développement de composants Angular génériques pour pouvoir les utiliser dans plusieurs modules sans avoir à les redévelopper ni les dupliquer (composant CARTE, composant RECHERCHE TAXON, composant OBSERVATEURS, composant NOMENCLATURES, SelectSearch, Municipalities, Observers, DynamicForm, MapList…)</p></li>
<li><p>Implémentation de la gestion des droits au niveau de l’API (pour limiter les données affichées à un utilisateur en fonction de ses droits) et au niveau du Frontend (pour afficher ou non certains boutons aux utilisateurs en fonction de leurs droits).</p></li>
<li><p>Par défaut, l’authentification et les utilisateurs sont gérés localement dans UsersHub, mais il est aussi possible de connecter GeoNature directement au CAS de l’INPN, sans UsersHub (cas de l’instance nationale INPN de GeoNature).</p></li>
<li><p>Connexion possible au webservice METADONNEES de l’INPN pour y récupérer les jeux de données en fonction de l’utilisateur connecté, avec mise à jour des JDD à chaque appel de la route</p></li>
<li><p>Mise en place d’un mécanisme standardisé de développement de modules dans GeoNature (#306)</p></li>
<li><p>Ajout de tests unitaires au niveau du backend et du frontend</p></li>
<li><p>Ajout d’un mécanisme de log par email (paramètres MAILERROR)</p></li>
<li><p>Début de création du module de gestion des médias (backend uniquement)</p></li>
<li><p>Mise en place d’une configuration globale et d’une configuration par module</p></li>
<li><p>Fonction d’installation d’un module et de génération des fichiers de configuration</p></li>
<li><p>Gestion de l’installation d’un module qui n’a pas de Frontend dans GeoNature</p></li>
<li><p>Mise en place d’une route générique permettant de requêter dans une vue non mappée</p></li>
<li><p>Mise en place d’un script pour la customisation de la plateforme nationale (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/develop/install_all/configuration_mtes.sh">https://github.com/PnX-SI/GeoNature/blob/develop/install_all/configuration_mtes.sh</a>)</p></li>
</ul>
<p><strong>Autres modules</strong></p>
<ul class="simple">
<li><p>Module Export en cours de développement (<a class="reference external" href="https://github.com/PnX-SI/gn_module_export">https://github.com/PnX-SI/gn_module_export</a>). Chaque export s’appuie sur une vue. Il sera possible aux administrateurs d’une GeoNature d’ajouter autant de vues que nécessaires dans son GeoNature.</p></li>
<li><p>Module de validation des données en cours de développement (<a class="reference external" href="https://github.com/PnX-SI/gn_module_validation/issues/4">https://github.com/PnX-SI/gn_module_validation/issues/4</a>)</p></li>
<li><p>Module Suivi Flore territoire en cours de développement (<a class="reference external" href="https://github.com/PnX-SI/gn_module_suivi_flore_territoire">https://github.com/PnX-SI/gn_module_suivi_flore_territoire</a>)</p></li>
<li><p>Module Suivi Habitat en cours de développement (<a class="reference external" href="https://github.com/PnX-SI/gn_module_suivi_habitat_territoire/issues/1">https://github.com/PnX-SI/gn_module_suivi_habitat_territoire/issues/1</a>)</p></li>
<li><p>gn_module_suivi_chiro refondu pour devenir un module de GeoNature V2 (<a class="reference external" href="https://github.com/PnCevennes/gn_module_suivi_chiro">https://github.com/PnCevennes/gn_module_suivi_chiro</a>)</p></li>
<li><p>Projet suivi utilisé comme Frontend générique et autonome pour le Suivi chiro (<a class="reference external" href="https://github.com/PnCevennes/projet_suivis_frontend">https://github.com/PnCevennes/projet_suivis_frontend</a>)</p></li>
<li><p>GeoNature-citizen en cours de développement (<a class="reference external" href="https://github.com/PnX-SI/GeoNature-citizen/issues/2">https://github.com/PnX-SI/GeoNature-citizen/issues/2</a>)</p></li>
<li><p>GeoNature-mobile en cours de refonte pour compatibilité avec GeoNature V2 (<a class="reference external" href="https://github.com/PnEcrins/GeoNature-mobile/issues/19">https://github.com/PnEcrins/GeoNature-mobile/issues/19</a>)</p></li>
<li><p>GeoNature-atlas en cours d’ajustements pour compatibilité avec GeoNature V2 (<a class="reference external" href="https://github.com/PnX-SI/GeoNature-atlas/issues/162">https://github.com/PnX-SI/GeoNature-atlas/issues/162</a>)</p></li>
</ul>
<p><strong>Notes de version</strong></p>
<p><strong>1.</strong> Pour les utilisateurs utilisant la version 1 de GeoNature :</p>
<p>Il ne s’agit pas de mettre à jour GeoNature mais d’en installer une nouvelle version. En effet, il s’agit d’une refonte complète.</p>
<ul class="simple">
<li><p>Passer à la dernière version 1 de GeoNature (1.9.1)</p></li>
<li><p>Idem pour UsersHub et TaxHub</p></li>
<li><p>Installer GeoNature standalone ou refaire une installation complète</p></li>
<li><p>Adaptez les scripts présents dans <code class="docutils literal notranslate"><span class="pre">/data/migrations/v1tov2</span></code> et éxécutez-les</p></li>
</ul>
<p><em>TODO : MAJ depuis V1 à  tester et compléter</em></p>
<p><strong>2.</strong> Pour les utilisateurs utilisant la version 2.0.0.beta5 :</p>
<ul>
<li><p>Supprimer le schéma <code class="docutils literal notranslate"><span class="pre">gn_synthese</span></code> puis le recréer dans sa version RC1 (#430)</p></li>
<li><p>Exécuter l’update de la BDD GeoNature (<code class="docutils literal notranslate"><span class="pre">data/migrations/2.0.0beta5-to-2.0.0rc1.sql</span></code>) ainsi que celui du sous-module Nomenclature (<a class="reference external" href="https://github.com/PnX-SI/Nomenclature-api-module/blob/1.2.1/data/update1.1.0to1.2.1.sql">https://github.com/PnX-SI/Nomenclature-api-module/blob/1.2.1/data/update1.1.0to1.2.1.sql</a>)</p></li>
<li><p>Suivre la procédure habituelle de mise à jour</p></li>
<li><p>Exécuter les commandes suivantes :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">geonature</span><span class="o">/</span><span class="n">backend</span>
<span class="n">source</span> <span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="n">geonature</span> <span class="n">generate_frontend_modules_route</span>
<span class="n">geonature</span> <span class="n">frontend_build</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="beta5-2018-07-16">
<h2>2.0.0.beta5 (2018-07-16)<a class="headerlink" href="#beta5-2018-07-16" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Nouveautés</strong></p>
<ul class="simple">
<li><p>Ajout d’un message d’erreur si l’utilisateur n’a pas de JDD ou si il y a eu un problème lors de la récupération des JDD de MTD</p></li>
<li><p>Ajout d’une vue matérialisée (<code class="docutils literal notranslate"><span class="pre">gn_synthese.vm_min_max_for_taxons</span></code>) et d’une fonction (<code class="docutils literal notranslate"><span class="pre">gn_synthese.fct_calculate_min_max_for_taxon</span></code>) permettant de renvoyer des informations sur les observations existantes d’un taxon (étendue des observations, date min et max, altitude min et max, nombre d’observations) pour orienter la validation et la saisie (<a class="reference external" href="https://github.com/PnX-SI/gn_module_validation/issues/5">https://github.com/PnX-SI/gn_module_validation/issues/5</a>)</p></li>
<li><p>L’export OccTax est désormais basé sur une vue qu’il est possible d’adapter</p></li>
<li><p>Ajouts de nouveaux tests automatisés du code et mise en place de Travis pour les lancer automatiquement à chaque commit (<a class="reference external" href="https://travis-ci.org/PnX-SI/GeoNature">https://travis-ci.org/PnX-SI/GeoNature</a>)</p></li>
<li><p>Ajout de données test</p></li>
<li><p>Mise à jour des scripts de déploiement spécifiques de DEPOBIO (MTES)</p></li>
<li><p>Déplacement de la table centrale de gestion des paramètres <code class="docutils literal notranslate"><span class="pre">t_parameters</span></code> dans le schéma <code class="docutils literal notranslate"><span class="pre">gn_commons</span></code> (#376)</p></li>
<li><p>Ajout d’un trigger générique pour calculer la géométrie dans la projection locale à partir de la géométrie 4326 (#370)</p></li>
<li><p>Regroupement des fichiers liés à l’installation et la mise à jour dans un répertoire dédié (<code class="docutils literal notranslate"><span class="pre">install</span></code>) (#383)</p></li>
<li><p>Mise en place de scripts de migration global de la BDD (<code class="docutils literal notranslate"><span class="pre">data/migrations/2.0.0beta4to2.00beta5.sql</span></code>) et du schéma <code class="docutils literal notranslate"><span class="pre">pr_occtax</span></code> (<code class="docutils literal notranslate"><span class="pre">contrib/occtax/data/migration_2.0.0.beta4to2.0.0.beta5.sql</span></code>), d’un script générique de migration de l’application (<code class="docutils literal notranslate"><span class="pre">install/migration/migration.sh</span></code>) et d’une doc de mise à jour (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/develop/docs/installation-standalone.rst#mise-%C3%A0-jour-de-lapplication">https://github.com/PnX-SI/GeoNature/blob/develop/docs/installation-standalone.rst#mise-%C3%A0-jour-de-lapplication</a>)</p></li>
<li><p>Réintégration des fichiers de configuration, de logs et des modules externes dans les répertoires de l’application (#375)</p></li>
<li><p>Ajout de routes à <code class="docutils literal notranslate"><span class="pre">gn_monitoring</span></code></p></li>
<li><p>Ajout d’un trigger pour calculer automatiquement les zonages des sites de suivi (<code class="docutils literal notranslate"><span class="pre">gn_monitoring.fct_trg_cor_site_area()</span></code>)</p></li>
<li><p>Améliorations et documentation des commandes d’installation d’un module</p></li>
<li><p>Ajout des unités géographiques dans le schéma <code class="docutils literal notranslate"><span class="pre">ref_geo</span></code></p></li>
<li><p>Ajout d’un bouton <code class="docutils literal notranslate"><span class="pre">Annuler</span></code> dans le formulaire Occtax</p></li>
<li><p>Gestion des conflits de nomenclatures en n’utilisant plus leur <code class="docutils literal notranslate"><span class="pre">id_type</span></code> ni leur <code class="docutils literal notranslate"><span class="pre">id_nomenclature</span></code> (#384)</p></li>
<li><p>Migration du SQL de <code class="docutils literal notranslate"><span class="pre">ref_nomenclautres</span></code> dans le dépôt du sous-module (<a class="reference external" href="https://github.com/PnX-SI/Nomenclature-api-module">https://github.com/PnX-SI/Nomenclature-api-module</a>)</p></li>
<li><p>Début de mise en place d’un backoffice (métadonnées et nomenclatures)</p></li>
</ul>
<p><strong>Corrections</strong></p>
<ul class="simple">
<li><p>OccTax : Correction du double post</p></li>
<li><p>OccTax : Correction des droits dans les JDD</p></li>
<li><p>OccTax : Correction de l’affichage des observers_txt dans la fiche d’un relevé</p></li>
<li><p>Correction de la gestion générique des médias</p></li>
<li><p>Suppression du lien entre <code class="docutils literal notranslate"><span class="pre">ref_geo</span></code> et <code class="docutils literal notranslate"><span class="pre">ref_nomenclatures</span></code> (#374)</p></li>
<li><p>Compléments et relecture de la documentation</p></li>
<li><p>Correction</p></li>
</ul>
<p><strong>Notes de version</strong></p>
<p>Si vous mettez à jour votre GeoNature depuis une Beta4 :</p>
<ul class="simple">
<li><p>Téléchargez la beta5 et renommer les répertoires :</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">myuser</span>
<span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">PnX</span><span class="o">-</span><span class="n">SI</span><span class="o">/</span><span class="n">GeoNature</span><span class="o">/</span><span class="n">archive</span><span class="o">/</span><span class="n">geonature2beta</span><span class="o">.</span><span class="n">zip</span>
<span class="n">unzip</span> <span class="n">geonature2beta</span><span class="o">.</span><span class="n">zip</span>
<span class="n">mv</span> <span class="o">/</span><span class="n">home</span><span class="o">/&lt;</span><span class="n">mon_user</span><span class="o">&gt;/</span><span class="n">geonature</span><span class="o">/</span> <span class="o">/</span><span class="n">home</span><span class="o">/&lt;</span><span class="n">mon_user</span><span class="o">&gt;/</span><span class="n">geonature_old</span><span class="o">/</span>
<span class="n">mv</span> <span class="n">GeoNature</span><span class="o">-</span><span class="n">geonature2beta</span> <span class="o">/</span><span class="n">home</span><span class="o">/&lt;</span><span class="n">mon_user</span><span class="o">&gt;/</span><span class="n">geonature</span><span class="o">/</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Exécutez le script de migration <code class="docutils literal notranslate"><span class="pre">install/migration/beta4tobeta5.sh</span></code> depuis la racine de votre GeoNature :</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">cd</span> <span class="n">geonature</span>
<span class="o">./</span><span class="n">install</span><span class="o">/</span><span class="n">migration</span><span class="o">/</span><span class="n">beta4tobeta5</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>Celui-ci va récupérer vos fichiers de configuration, déplacer les modules et appliquer les changements de la BDD.</p>
<ul class="simple">
<li><p>Si vous avez développé des modules externes, voir <a class="reference external" href="https://github.com/PnX-SI/GeoNature/issues/375">https://github.com/PnX-SI/GeoNature/issues/375</a>, en ajoutant un lien symbolique depuis le répertoire <code class="docutils literal notranslate"><span class="pre">external_modules</span></code> et en réintégrant la configuration du module dans son répertoire <code class="docutils literal notranslate"><span class="pre">config</span></code></p></li>
</ul>
</section>
<section id="beta4-2018-05-25">
<h2>2.0.0.beta4 (2018-05-25)<a class="headerlink" href="#beta4-2018-05-25" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Nouveautés</strong></p>
<ul class="simple">
<li><p>Synthèse : début de mise en place du backend, de l’API et du frontend #345</p></li>
<li><p>Complément de la nomenclature des Méthodes de détermination et suppression du champs Complement_Determination. Merci &#64;DonovanMaillard. #341</p></li>
<li><p>Nouveaux composants Angular (SelectSearch, Municipalities, Observers)</p></li>
<li><p>Amélioration de composants Angular (Date du jour par défaut, Option de tri des nomenclatures, DynamicForm</p></li>
<li><p>Connexion à MTD INPN : Mise à jour des JDD à chaque appel de la route</p></li>
<li><p>Finalisation du renommage de Contact en OccTax (BDD, API, backend)</p></li>
<li><p>Droits CRUVED : La définition du CRUVED d’un rôle (utilisateur ou groupe) sur un module de GeoNature surcouche ses droits GeoNature même si ils sont inférieurs. Si une action du CRUVED n’est pas définie au niveau du module, on prend celle de l’application parente. #292</p></li>
<li><p>Si un rôle a un R du CRUVED à 0 pour un module, alors celui-ci ne lui est pas listé dans le Menu et il ne lui ai pas accessible si il en connait l’URL. #360</p></li>
<li><p>Mise en place d’un schéma <code class="docutils literal notranslate"><span class="pre">gn_commons</span></code> dans la BDD qui permet de stocker de manière générique des informations qui peuvent être communes aux autres modules : l’historique des actions sur chaque objet de la BDD, la validation d’une donnée et les médias associés à une donnée. Accompagné de fonctions génériques d’historisation et de validation des données mises en place sur le module Occtax. #339</p></li>
<li><p>Amélioration de l’ergonomie du MapList de OccTax. #361</p></li>
<li><p>Mise en place d’un export CSV, SHP, GeoJSON paramétrable dans OccTax. #363 et #366</p></li>
<li><p>Amélioration du module générique <code class="docutils literal notranslate"><span class="pre">gn_monitoring</span></code> et de ses sous-modules <a class="reference external" href="https://github.com/PnCevennes/gn_module_suivi_chiro">https://github.com/PnCevennes/gn_module_suivi_chiro</a> et <a class="reference external" href="https://github.com/PnCevennes/projet_suivis_frontend">https://github.com/PnCevennes/projet_suivis_frontend</a></p></li>
<li><p>Amélioration et compléments des scripts d’installation</p></li>
<li><p>Mise en place d’un script pour la customisation de la plateforme nationale (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/develop/install_all/configuration_mtes.sh">https://github.com/PnX-SI/GeoNature/blob/develop/install_all/configuration_mtes.sh</a>)</p></li>
</ul>
<p><strong>Documentation</strong></p>
<ul class="simple">
<li><p>Complément des différentes documentations</p></li>
<li><p>Ajout d’une documentation d’administration d’OccTax (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/develop/docs/admin-manual.rst#module-occtax">https://github.com/PnX-SI/GeoNature/blob/develop/docs/admin-manual.rst#module-occtax</a>)</p></li>
</ul>
</section>
<section id="beta3-2018-03-28">
<h2>2.0.0.beta3 (2018-03-28)<a class="headerlink" href="#beta3-2018-03-28" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Nouveautés</strong></p>
<ul class="simple">
<li><p>Travail sur le module générique de Suivi intégré à GeoNature (<code class="docutils literal notranslate"><span class="pre">gn_monitoring</span></code>). Gestion des fichiers de configuration</p></li>
<li><p>Gestion de l’installation d’un module qui n’a pas de Frontend dans GeoNature</p></li>
<li><p>Mise en place de tests automatiques au niveau du Frontend</p></li>
<li><p>Ménage et réorganisation du code du Frontend</p></li>
<li><p>Factorisation et harmonisation des composants génériques Angular</p></li>
<li><p>Suppression des blocs non fonctionnels sur la Home</p></li>
<li><p>Mise à jour de la doc et du MCD</p></li>
<li><p>Possibilité de masquer ou afficher les différents champs dans le formulaire Occtax (#344)</p></li>
<li><p>Ajout des nomenclatures dans les filtres d’OccTax à partir du nouveau composant <code class="docutils literal notranslate"><span class="pre">dynamicForm</span></code> qui permet de créer dynamiquement un formulaire en déclarant les champs (#318)</p></li>
<li><p>Amélioration du composant de recherche d’un taxon en ne recherchant que sur les débuts de mot et en affichant en premier les noms de référence (ordrer_by cd_nom=cd_ref DESC) - #334</p></li>
<li><p>Mise en place d’une route générique permettant de requêter dans une vue non mappée</p></li>
<li><p>Suppression des options vides dans les listes déroulantes des nomenclatures</p></li>
<li><p>Ajout de quelques paramètres (niveau de zoom mini dans chaque module, ID de la liste des taxons saisissables dans Occtax…)</p></li>
</ul>
<p><strong>Corrections</strong></p>
<ul class="simple">
<li><p>Correction de la pagination du composant MapList</p></li>
<li><p>Correction des droits attribués automatiquement quand on se connecte avec le CAS</p></li>
<li><p>Correction de l’installation optionnelle de UsersHub dans le script <code class="docutils literal notranslate"><span class="pre">install_all.sh</span></code></p></li>
</ul>
<p><strong>Modules annexes</strong></p>
<ul class="simple">
<li><p>Début de refonte du module Suivi chiro (<a class="reference external" href="https://github.com/PnCevennes/gn_module_suivi_chiro">https://github.com/PnCevennes/gn_module_suivi_chiro</a>) connecté au module générique de suivi de GeoNature, dont le front sera externe à GeoNature (<a class="reference external" href="https://github.com/PnCevennes/projet_suivi">https://github.com/PnCevennes/projet_suivi</a>)</p></li>
<li><p>Maquettage et avancée sur le module Validation (<a class="reference external" href="https://github.com/PnX-SI/gn_module_validation">https://github.com/PnX-SI/gn_module_validation</a>)</p></li>
<li><p>Définition du module Suivi Habitat Territoire (<a class="reference external" href="https://github.com/PnX-SI/gn_module_suivi_habitat_territoire">https://github.com/PnX-SI/gn_module_suivi_habitat_territoire</a>)</p></li>
<li><p>Piste de définition du module Interopérabilité (<a class="reference external" href="https://github.com/PnX-SI/gn_module_interoperabilite">https://github.com/PnX-SI/gn_module_interoperabilite</a>)</p></li>
</ul>
</section>
<section id="beta2-2018-03-16">
<h2>2.0.0.beta2 (2018-03-16)<a class="headerlink" href="#beta2-2018-03-16" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Nouveautés</strong></p>
<ul class="simple">
<li><p>Compléments de la documentation (schéma architecture, administration, installation, développement, FAQ…)</p></li>
<li><p>Amélioration de l’ergonomie du module OccTax (composant MapList, filtres, colonnes et formulaires) et du module Exports</p></li>
<li><p>Amélioration du composant de recherche d’un taxon (#324)</p></li>
<li><p>Amélioration et optimisation de la sérialisation des données</p></li>
<li><p>Ajout de tests unitaires au niveau du backend</p></li>
<li><p>Ajout d’un mécanisme de log par email (paramètres MAILERROR)</p></li>
<li><p>Migration du module occtax dans le répertoire <code class="docutils literal notranslate"><span class="pre">/contrib</span></code> pour homogénéiser les modules</p></li>
<li><p>Création du schéma <code class="docutils literal notranslate"><span class="pre">gn_monitoring</span></code> pour gérer la partie générique des modules de suivi (sites et visites centralisés)</p></li>
<li><p>Début de création du module générique des protocoles de suivi</p></li>
<li><p>Début de création du module de gestion des médias</p></li>
</ul>
<p><strong>Corrections</strong></p>
<ul class="simple">
<li><p>Corrections de l’installation globale et autonome</p></li>
<li><p>Renommage Contact en OccTax (en cours)</p></li>
<li><p>Nettoyage du schéma des métadonnées (<code class="docutils literal notranslate"><span class="pre">gn_meta</span></code>)</p></li>
</ul>
</section>
<section id="beta1-2018-02-16">
<h2>2.0.0.beta1 (2018-02-16)<a class="headerlink" href="#beta1-2018-02-16" title="Lien permanent vers cette rubrique"></a></h2>
<p>La version 2 de GeoNature est une refonte complète de l’application.</p>
<ul class="simple">
<li><p>Refonte technologique en migrant de PHP/Symfony/ExtJS/Openlayers à Python3/Flask/Angular4/Leaflet</p></li>
<li><p>Refonte de l’architecture du code pour rendre GeoNature plus générique et modulaire</p></li>
<li><p>Refonte de la base de données pour la rendre plus standarde, plus générique et modulaire</p></li>
<li><p>Refonte ergonomique pour moderniser l’application</p></li>
</ul>
<p>Présentation et suivi du projet : <a class="reference external" href="https://github.com/PnX-SI/GeoNature/issues/168">https://github.com/PnX-SI/GeoNature/issues/168</a></p>
<p><strong>Nouveautés</strong></p>
<ul class="simple">
<li><p>Refonte de la base de données du module Contact, renommé en OccTax, s’appuyant sur le standard Occurrence de taxons du SINP (#183)</p></li>
<li><p>Développement du module OccTax regroupant les contacts Faune, Flore, Fonge et Mortalité (avec formulaire de consultation et de saisie des données)</p></li>
<li><p>Développement d’un module et d’une API générique et autonome pour la gestion des nomenclatures (<a class="reference external" href="https://github.com/PnX-SI/Nomenclature-api-module">https://github.com/PnX-SI/Nomenclature-api-module</a>). Il permet d’avoir un mécanisme générique de centralisation des listes de valeurs (nomenclatures) pour ne pas créer des tables pour chaque liste : <a class="reference external" href="https://github.com/PnX-SI/Nomenclature-api-module">https://github.com/PnX-SI/Nomenclature-api-module</a>. Les valeurs de chaque nomenclature s’adaptent en fonction des regnes et groupe 2 INPN des taxons.</p></li>
<li><p>Découpage de l’application en backend / API / Frontend</p></li>
<li><p>Multilingue au niveau de l’interface et des listes de valeurs avec français et anglais intégrés mais extensible à d’autres langues (#173)</p></li>
<li><p>Développement de composants génériques pour pouvoir les utiliser dans plusieurs modules sans avoir à les redévelopper ni les dupliquer (composant CARTE, composant RECHERCHE TAXON, composant OBSERVATEURS, composant NOMENCLATURES…)</p></li>
<li><p>Mise en place d’un référentiel géographique avec un schéma dédié (<code class="docutils literal notranslate"><span class="pre">ref_geo</span></code>), partageable avec d’autres applications comprenant une table des communes, une table générique des zonages, une table pour le MNT et des fonctions pour intersecter point/ligne/polygones avec les zonages et le MNT (#228)</p></li>
<li><p>Evolution du schéma <code class="docutils literal notranslate"><span class="pre">utilisateurs</span></code> de UsersHub pour passer d’une gestion des droits avec 6 niveaux à un mécanisme plus générique, souple et complet. Il permet d’attribuer des actions possibles à un rôle (utilisateur ou groupe), sur une portée; dans une application ou un module. 6 actions sont possibles dans GeoNature : Create / Read / Update / Validate / Export / Delete (aka CRUVED). 3 portées de ces actions sont possibles : Mes données / Les données de mon organisme / Toutes les données.</p></li>
<li><p>Implémentation de la gestion des droits au niveau de l’API (pour limiter les données affichées à un utilisateur en fonction de ses droits) et au niveau du Frontend (pour afficher ou non certains boutons aux utilisateurs en fonction de leurs droits).</p></li>
<li><p>Par défaut, l’authentification et les utilisateurs sont gérés localement dans UsersHub, mais il est aussi possible de connecter GeoNature au CAS de l’INPN, sans utiliser GeoNature (utilisé pour l’instance nationale INPN de GeoNature). GeoNature peut aussi se connecter au webservice METADONNEES de l’INPN pour y récupérer les jeux de données en fonction de l’utilisateur connecté.</p></li>
<li><p>Mise en place d’un module d’export. Chaque export s’appuie sur une vue. Il sera possible à chaque administrateur d’ajouter autant de vues que nécessaires dans son GeoNature. Pour le moment, un export au format SINP Occurrence de taxons a été intégré par défaut.</p></li>
<li><p>Développement des métadonnées dans la BDD (schema <code class="docutils literal notranslate"><span class="pre">gn_meta</span></code>) sur la base du standard Métadonnées du SINP (<a class="reference external" href="http://standards-sinp.mnhn.fr/category/standards/metadonnees/">http://standards-sinp.mnhn.fr/category/standards/metadonnees/</a>). Elles permettent de gérer des jeux de données, des cadres d’acquisition, des acteurs (propriétaire, financeur, producteur…) et des protocoles. Chaque relevé est associé à un jeu de données.</p></li>
<li><p>Développement d’un mécanisme de calcul automatique de la sensibilité d’une espèce directement dans la BDD (sur la base des règles nationales et régionales du SINP + locales éventuellement)</p></li>
<li><p>Intégration du calcul automatique de l’identifiant permanent SINP (#209)</p></li>
<li><p>Mise en place d’un mécanisme standardisé de développement de modules dans GeoNature (#306)</p></li>
<li><p>Scripts d’installation autonome ou globale de GeoNature sur Debian 8 et 9</p></li>
</ul>
<p><strong>Documentation</strong></p>
<ul class="simple">
<li><p>Installation globale de GeoNature (avec TaxHub et UsersHub) / <a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/develop/docs/installation-all.rst">https://github.com/PnX-SI/GeoNature/blob/develop/docs/installation-all.rst</a></p></li>
<li><p>Installation autonome de GeoNature / <a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/develop/docs/installation-standalone.rst">https://github.com/PnX-SI/GeoNature/blob/develop/docs/installation-standalone.rst</a></p></li>
<li><p>Manuel utilisateur / <a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/develop/docs/user-manual.rst">https://github.com/PnX-SI/GeoNature/blob/develop/docs/user-manual.rst</a></p></li>
<li><p>Manuel administrateur / <a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/develop/docs/admin-manual.rst">https://github.com/PnX-SI/GeoNature/blob/develop/docs/admin-manual.rst</a></p></li>
<li><p>Développement (API, modules et composants) / <a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/develop/docs/development.rst">https://github.com/PnX-SI/GeoNature/blob/develop/docs/development.rst</a></p></li>
</ul>
<p>Documentation complète disponible sur <a class="reference external" href="http://geonature.fr/docs/2-0-0-beta1">http://geonature.fr/docs/2-0-0-beta1</a></p>
<p><strong>A venir</strong></p>
<ul class="simple">
<li><p>Finalisation MCD du module Synthèse</p></li>
<li><p>Triggers d’alimentation automatique de la Synthèse depuis le module OccTax</p></li>
<li><p>Développement de l’interface du module Synthèse</p></li>
<li><p>Amélioration et généricité du module OccTax (médias, import GPX, champs masquables et pseudo-champs)</p></li>
<li><p>Généricité du module d’export</p></li>
<li><p>Développement du module de validation (#181)</p></li>
<li><p>Développement d’un module de suivi des habitats avec une gestion générique des sites et visites de suivi</p></li>
<li><p>Développement d’un module de collecte citoyenne (#242)</p></li>
</ul>
</section>
<section id="id23">
<h2>1.9.1 (2018-05-17)<a class="headerlink" href="#id23" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Corrections</strong></p>
<ul class="simple">
<li><p>Installation - Suppression des couches SIG (communes, znieff…) pour les télécharger sur <a class="reference external" href="http://geonature.fr/data/inpn/layers/">http://geonature.fr/data/inpn/layers/</a> et ainsi alléger le dépôt de 158 Mo.</p></li>
<li><p>Compléments mineurs de la documentation</p></li>
<li><p>Migration du script <code class="docutils literal notranslate"><span class="pre">install_all</span></code> en Debian 9. La doc et le script Debian 8 restent disponibles dans le répertoire <code class="docutils literal notranslate"><span class="pre">docs/install_all</span></code></p></li>
<li><p>Corrections mineures de triggers</p></li>
<li><p>Compatibilité avec TaxHub 1.3.2, UsersHub 1.3.1, GeoNature-atlas 1.3.2</p></li>
</ul>
<p><strong>Notes de version</strong></p>
<ul class="simple">
<li><p>Vous pouvez passer directement d’une 1.7.X à la 1.9.1, en prenant en compte les notes des différentes versions intermédiaires, notamment les scripts de mise à jour de la BDD ainsi que les éventuels nouveaux paramètres à ajouter.</p></li>
<li><p>Exécuter le script de mise à jour de la BDD <code class="docutils literal notranslate"><span class="pre">data/update_1.9.0to1.9.1.sql</span></code></p></li>
</ul>
</section>
<section id="id24">
<h2>1.9.0 (2017-07-06)<a class="headerlink" href="#id24" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>ATTENTION : Les évolutions de cette version concernent aussi la webapi. Si vous utilisez les applications GeoNature-mobile, vous devez attendre la sortie d’une version de GeoNature-mobile-webapi (https://github.com/PnEcrins/GeoNature-mobile-webapi) compatible avec cette version 1.9.0 de GeoNature.</strong> Coming soon !</p>
<p>A noter aussi que cette version de GeoNature est compatible avec GeoNature-atlas 1.2.4 et +.</p>
<p><strong>Nouveautés</strong></p>
<ul class="simple">
<li><p>Ajout de la création des index spatiaux à la création initiale de la base.</p></li>
<li><p>Création ou mise à jour des géométries compatible PostGIS 2.</p></li>
<li><p>Ajout du champ diffusable (oui/non) dans le formulaire web de saisie, uniquement pour ContactFaune et Mortalité (TODO : faire la même chose pour les autres protocoles).</p></li>
<li><p>Multi-projection : Les versions antérieures de GeoNature n’étaient compatibles qu’avec la projection Lambert 93 (srid: 2154). Cette version permet de choisir sa projection locale. Elle ajoute un paramètre <code class="docutils literal notranslate"><span class="pre">srid_local</span></code> dans le <code class="docutils literal notranslate"><span class="pre">config/settings.ini</span></code> et renomme tous les champs <code class="docutils literal notranslate"><span class="pre">the_geom_2154</span></code> en <code class="docutils literal notranslate"><span class="pre">the_geom_local</span></code> des tables « métier ».
Ce paramètre est notamment utilisé lors de la création de la base pour affecter le srid de la projection locale à tous les champs <code class="docutils literal notranslate"><span class="pre">the_geom_local</span></code> présents dans les tables de la base. Ce paramètre est également utilisé pour mettre en cohérence le système de projection local utilisé dans toutes les couches SIG présentes dans la base et les géométries stockées dans les champs <code class="docutils literal notranslate"><span class="pre">the_geom_local</span></code> des tables « métier ». Le paramétrage du service WMS dans <code class="docutils literal notranslate"><span class="pre">wms/wms.map</span></code> est également pris en charge par le script d’installation de l’application.</p></li>
<li><p>Correction de l’installation de npm</p></li>
<li><p>Script <code class="docutils literal notranslate"><span class="pre">install_all.sh</span></code> mis à jour avec les nouvelles versions de GeoNature-atlas, de TaxHub et de UsersHub.</p></li>
</ul>
<p>IMPORTANT : toutes les couches SIG insérées dans le schéma <code class="docutils literal notranslate"><span class="pre">layers</span></code> doivent être dans la projection fournie pour le paramètre <code class="docutils literal notranslate"><span class="pre">srid_local</span></code>. L’application est livrée avec un ensemble de couches en Lambert 93 concernant la métropole. Une installation avec une autre projection, hors métropole, doit donc se faire sans l’insertion des couches SIG. Vous devrez manuellement fournir le contenu des tables du schéma <code class="docutils literal notranslate"><span class="pre">layers</span></code> dans la projection choisie.</p>
<p><strong>Notes de versions</strong></p>
<ul class="simple">
<li><p>Vous pouvez ajouter les paramètres <code class="docutils literal notranslate"><span class="pre">srid_local</span></code>, <code class="docutils literal notranslate"><span class="pre">install_sig_layers</span></code> et <code class="docutils literal notranslate"><span class="pre">add_sample_data</span></code> au fichier <code class="docutils literal notranslate"><span class="pre">config/settings.ini</span></code> en vous inspirant du fichier <code class="docutils literal notranslate"><span class="pre">config/settings.ini.sample</span></code>. Toutefois ces paramètres ne sont utilisés que pour une nouvelle installation et notamment pour l’installation de la base.</p></li>
<li><p>Vous pouvez passer directement d’une 1.7.X à la 1.9.0, en prenant en compte les notes des différentes versions intermédiaires, notamment les scripts de mise à jour de la BDD ainsi que les éventuels nouveaux paramètres à ajouter.</p></li>
<li><p>Si vous migrez depuis la version 1.8.3, exécutez le fichier SQL <code class="docutils literal notranslate"><span class="pre">data/update_1.8.3to1.9.0.sql</span></code>. Comme GeoNature ne fonctionne jusque là que pour des structures de métropole, il est basé sur le fait que le champ <code class="docutils literal notranslate"><span class="pre">the_geom_local</span></code> reste en Lambert 93 (2154). Assurez-vous que le paramètre <code class="docutils literal notranslate"><span class="pre">$srid_local</span></code> dans <code class="docutils literal notranslate"><span class="pre">lib/sfGeonatureConfig.php</span></code> est égal à <code class="docutils literal notranslate"><span class="pre">2154</span></code>.
ATTENTION : ce script SQL renomme tous les champs <code class="docutils literal notranslate"><span class="pre">the_geom_2154</span></code> en <code class="docutils literal notranslate"><span class="pre">the_geom_local</span></code> de la BDD de GeoNature. Ceci affecte de nombreuses tables, de nombreux triggers et de nombreuses vues de la base. Le script n’intègre que les vues fournies par défaut. Si vous avez créé des vues spécifiques, notamment pour le module d’export, ou si vous avez modifié des vues fournies, vous devez adapter/compléter le script. Vous pouvez vous inspirer de son contenu.</p></li>
<li><p>RAPPEL : Ceci affecte également la webapi des applications mobiles. Vous devez donc mettre à jour votre webapi si vous utilisez la saisie sur les applications mobiles. Une release de la webapi devrait sortir bientôt.</p></li>
</ul>
</section>
<section id="id25">
<h2>1.8.4 (2017-04-10)<a class="headerlink" href="#id25" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Corrections</strong></p>
<ul class="simple">
<li><p>Correction du script d’installation globale (<code class="docutils literal notranslate"><span class="pre">install_all</span></code>) si l’utilisateur de BDD par défaut a été renommé (<code class="docutils literal notranslate"><span class="pre">data/grant.sql</span></code>)</p></li>
<li><p>Correction de la création des vues qui remontent la liste des taxons dans les 3 contacts</p></li>
</ul>
</section>
<section id="id26">
<h2>1.8.3 (2017-02-23)<a class="headerlink" href="#id26" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Nouveautés</strong></p>
<ul class="simple">
<li><p>Multi-organisme : l’organisme associé à la donnée est désormais celui de l’utilisateur connecté dans l’application (lors de la création d’une observation uniquement).</p></li>
<li><p>Taxonomie : création d’une liste <code class="docutils literal notranslate"><span class="pre">Saisie</span> <span class="pre">possible</span></code>, remplaçant l’attribut <code class="docutils literal notranslate"><span class="pre">Saisie</span></code>. Cela permet de choisir les synonymes que l’on peut saisir ou non dans GeoNature en se basant sur les <code class="docutils literal notranslate"><span class="pre">cd_nom</span></code> (<code class="docutils literal notranslate"><span class="pre">bib_listes</span></code> et <code class="docutils literal notranslate"><span class="pre">cor_nom_liste</span></code>) et non plus sur les <code class="docutils literal notranslate"><span class="pre">cd_ref</span></code> (<code class="docutils literal notranslate"><span class="pre">bib_attributs</span></code> et <code class="docutils literal notranslate"><span class="pre">cor_taxon_attribut</span></code>). Voir le script de migration SQL <code class="docutils literal notranslate"><span class="pre">data/update_1.8.2to1.8.3.sql</span></code> pour bien basculer les informations de l’attribut dans la nouvelle liste.</p></li>
<li><p>Correction de la vue <code class="docutils literal notranslate"><span class="pre">synthese.v_tree_taxons_synthese</span></code> potentiellement bloquante à l’ouverture de la synthèse.</p></li>
<li><p>Suppression de la table <code class="docutils literal notranslate"><span class="pre">utilisateurs.bib_observateurs</span></code> inutile.</p></li>
<li><p>Création des index spatiaux manquants (performances)</p></li>
<li><p>Clarification et corrections mineures du script <code class="docutils literal notranslate"><span class="pre">install_all</span></code></p></li>
<li><p>Ajout du MCD de la 1.8 (par &#64;xavier-pnm)</p></li>
<li><p>Améliorations du nom des fichiers exportés depuis la Synthèse (par &#64;sylvain-m)</p></li>
</ul>
<p><strong>Notes de versions</strong></p>
<p>Vous pouvez supprimer les lignes concernant le paramètre <code class="docutils literal notranslate"><span class="pre">public</span> <span class="pre">static</span> <span class="pre">$id_organisme</span> <span class="pre">=</span> <span class="pre">...</span></code> dans <code class="docutils literal notranslate"><span class="pre">lib/sfGeonatureConfig.php</span></code>, l’organisme n’étant plus un paramètre fixe mais désormais celui de l’utilisateur connecté.</p>
<p>Vous pouvez passer directement d’une 1.7.X à la 1.8.3, en prenant en compte les notes des différentes versions intermédiaires.</p>
<p>Si vous migrez depuis la version 1.8.2, éxécutez le fichier SQL <code class="docutils literal notranslate"><span class="pre">data/update_1.8.2to1.8.3.sql</span></code>.</p>
</section>
<section id="id27">
<h2>1.8.2 (2017-01-11)<a class="headerlink" href="#id27" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Nouveautés</strong></p>
<ul class="simple">
<li><p>Modularité des scripts SQL de création de la base en les dissociant par protocole et en regroupant les triggers dans les schémas de chaque protocole (préparation GeoNature V2)</p></li>
<li><p>Correction d’une requête dans flore station (indépendance vis à vis de flore patrimoniale)</p></li>
<li><p>Correction du trigger <code class="docutils literal notranslate"><span class="pre">synthese_update_fiche_cflore</span></code> (&#64;ClaireLagaye)</p></li>
</ul>
<p><strong>Notes de versions</strong></p>
<p>Vous pouvez passer directement d’une 1.7.X à la 1.8.2, en prenant en compte les notes des différentes versions intermédiaires.</p>
<p>Si vous migrez depuis la version 1.8.1, éxécutez le fichier <code class="docutils literal notranslate"><span class="pre">data/update_1.8.1to1.8.2.sql</span></code>. Consultez les dernières lignes de ce fichier : vous devez évaluer si la requête d’insertion dans la table <code class="docutils literal notranslate"><span class="pre">taxonomie.cor_taxon_attribut</span></code> doit être faite ou non (vous pourriez avoir déjà constaté et corrigé cette erreur lors d’une précédente migration). Cela corrige l’absence de taxons protégés dans votre synthese en récupérant les informations de protection présentes dans le champ <code class="docutils literal notranslate"><span class="pre">filtre3</span></code> de la table <code class="docutils literal notranslate"><span class="pre">save.bib_taxons</span></code></p>
</section>
<section id="id28">
<h2>1.8.1 (2017-01-05)<a class="headerlink" href="#id28" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Nouveautés</strong></p>
<ul class="simple">
<li><p>Ajout des sauvegardes et de l’installation globale avec un exemple détaillé dans la documentation : <a class="reference external" href="http://docs.geonature.fr">http://docs.geonature.fr</a></p></li>
<li><p>Optimisation et correction de la vue qui retourne l’arbre des rangs taxonomiques (synthese.v_tree_taxons_synthese)</p></li>
<li><p>Mise en cohérence des données exemple de GeoNature-atlas avec les critères des vues matérialisées de GeoNature-atlas</p></li>
<li><p>Mise à jour de 2 triggers du Contact Flore (&#64;ClaireLagaye)</p></li>
</ul>
<p><strong>Notes de versions</strong></p>
<p>Vous pouvez passer directement d’une 1.7.X à la 1.8.1, en prenant en compte les notes des différentes versions intermédiaires.</p>
<p>Si vous migrez depuis la version 1.8.0, éxécutez le fichier <code class="docutils literal notranslate"><span class="pre">data/update_1.8to1.8.1.sql</span></code></p>
</section>
<section id="id29">
<h2>1.8.0 (2016-12-14)<a class="headerlink" href="#id29" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Nouveautés</strong></p>
<ul class="simple">
<li><p>Passage à TAXREF version 9</p></li>
<li><p>Accès à la synthèse en consultation uniquement pour des utilisateurs enregistrés avec des droits 1</p></li>
<li><p>Ajout d’un champ <code class="docutils literal notranslate"><span class="pre">diffusion</span></code> (oui/non) dans la table <code class="docutils literal notranslate"><span class="pre">synthese.syntheseff</span></code>, utilisable dans GeoNature-atlas. Pas d’interface de gestion de ce champ pour le moment. CF #132</p></li>
<li><p>Création d’un script d’installation simplifié pour un pack UsersHub, TaxHub, GeoNature et GeoNature-atlas : <a class="reference external" href="https://github.com/PnX-SI/GeoNature/tree/master/docs/install_all">https://github.com/PnX-SI/GeoNature/tree/master/docs/install_all</a></p></li>
<li><p>Factorisation des SQL de création des schémas <code class="docutils literal notranslate"><span class="pre">taxonomie</span></code> et <code class="docutils literal notranslate"><span class="pre">utilisateurs</span></code> en les récupérant dans les dépots TaxHub et UsersHub</p></li>
<li><p>Compatibilité avec l’application <a class="reference external" href="https://github.com/PnX-SI/TaxHub">TaxHub</a> qui permet de gérer la taxonomie à partir de TAXREF. Cela induit d’importants changements dans le schéma <code class="docutils literal notranslate"><span class="pre">taxonomie</span></code>, notamment le renommage de <code class="docutils literal notranslate"><span class="pre">taxonomie.bib_taxons</span></code> en <code class="docutils literal notranslate"><span class="pre">taxonomie.bib_noms</span></code>, la suppression de <code class="docutils literal notranslate"><span class="pre">taxonomie.bib_filtres</span></code> et l’utilisation de <code class="docutils literal notranslate"><span class="pre">taxonomie.bib_attributs</span></code> (voir <a class="reference external" href="https://github.com/PnX-SI/TaxHub/issues/71">https://github.com/PnX-SI/TaxHub/issues/71</a> pour plus d’informations). Voir aussi le fichier de migration <code class="docutils literal notranslate"><span class="pre">data/update_1.7to1.8.sql</span></code> qui permet d’automatiser ces évolutions de la BDD</p></li>
<li><p>Compatibilité avec l’application <a class="reference external" href="https://github.com/PnX-SI/GeoNature-atlas">GeoNature-atlas</a> qui permet de diffuser les données de la synthèse faune et flore dans un atlas en ligne (exemple : <a class="reference external" href="http://biodiversite.ecrins-parcnational.fr">http://biodiversite.ecrins-parcnational.fr</a>)</p></li>
<li><p>Création d’un site internet de présentation de GeoNature : <a class="reference external" href="http://geonature.fr">http://geonature.fr</a></p></li>
</ul>
<p><strong>Corrections</strong></p>
<ul class="simple">
<li><p>Amélioration des triggers concernant la suppression de fiches orphelines</p></li>
<li><p>Affichage par défaut du nom latin dans Contact flore et Contact invertébrés</p></li>
<li><p>Correction des exports lors de la présence de points-virgules dans les commentaires. Fix #143</p></li>
<li><p>Suppression du besoin d’un super utilisateur lors de l’installation de la BDD. Fix #141</p></li>
<li><p>Correction de l’ID des protocoles mortalité et invertebres dans la configuration par défaut</p></li>
<li><p>Suppression d’un doublon dans le fichier de configuration symfony de l’application</p></li>
<li><p>Correction des coordonnées lors de l’export de données Flore Station</p></li>
<li><p>Autres corrections mineures</p></li>
</ul>
<p><strong>Note de version</strong></p>
<ul class="simple">
<li><p>Exécuter le script SQL de migration réalisant les modifications de la BDD de la version 1.7.X à 1.8.0 <code class="docutils literal notranslate"><span class="pre">data/update_1.7to1.8.sql</span></code></p></li>
<li><p>Mettre à jour taxref en V9 en vous inspirant du script <code class="docutils literal notranslate"><span class="pre">data/taxonomie/inpn/update_taxref_v8tov9</span></code></p></li>
</ul>
<p><strong>TaxHub</strong></p>
<p>L’application TaxHub (<a class="reference external" href="https://github.com/PnX-SI/TaxHub">https://github.com/PnX-SI/TaxHub</a>) est désormais fonctionnelle, documenté et installable.</p>
<p>Elle vous aidera à gérer vos taxons et l’ensemble du schéma <code class="docutils literal notranslate"><span class="pre">taxonomie</span></code>, présent dans la BDD de GeoNature.</p>
<p>TaxHub évoluera pour intégrer progressivement de nouvelles fonctionnalités.</p>
<p>Il est conseillé de ne pas installer la base de données de TaxHub indépendamment et de connecter l’application directement sur le la base de données de GeoNature.</p>
<p><strong>GeoNature-atlas</strong></p>
<p>GeoNature-atlas est également basé sur le schéma <code class="docutils literal notranslate"><span class="pre">taxonomie</span></code> de TaxHub. Ainsi TaxHub permet la saisie des informations relatives aux taxons (descriptions, milieux, photos, liens, PDF…). GeoNature-atlas dispose de sa propre base de données mais pour fonctionner en connexion avec le contenu de la base GeoNature il faut à minima disposer d’une version 1.8 de GeoNature.</p>
<dl class="field-list simple">
<dt class="field-odd">notes</dt>
<dd class="field-odd"><p>Une régression dans le contenu de Taxref V9 conduit à la suppression de l’information concernant le niveau de protection des espèces (régional, national, international,…).
Cette information était utilisée par GeoNature, notamment pour définir les textes à retenir pour la colonne <code class="docutils literal notranslate"><span class="pre">concerne_mon_territoire</span></code> de la table <code class="docutils literal notranslate"><span class="pre">taxonomie.taxref_protection_articles</span></code>.
Vous devez désormais remplir cette colonne manuellement.</p>
</dd>
</dl>
</section>
<section id="id30">
<h2>1.7.4 (2016-07-06)<a class="headerlink" href="#id30" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Corrections de bugs</strong></p>
<ul class="simple">
<li><p>Correction du script d’installation des tables liées au Contact flore (5a1fb07)</p></li>
<li><p>Mise en cohérence avec GeoNature-mobile utilisant les classes “gasteropodes” et “bivalves” et non la classe générique “mollusques”.</p></li>
</ul>
<p><strong>Nouveautés</strong></p>
<ul class="simple">
<li><p>Corrections de mise en forme de la documentation</p></li>
<li><p>Ajout de la liste rouge France de TaxRef lors d’une nouvelle installation (f4be2b6). A ne pas prendre en compte dans le cas d’une mise à jour.</p></li>
<li><p>Ajout du MCD de la BDD - <a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/docs/2016-04-29-mcd_geonaturedb.png">https://github.com/PnX-SI/GeoNature/blob/master/docs/2016-04-29-mcd_geonaturedb.png</a></p></li>
</ul>
<p><strong>Note de version</strong></p>
<ul class="simple">
<li><p>Vous pouvez passer directement de la version 1.6.0 à la 1.7.4 mais en vous référant aux notes de version de la 1.7.0.</p></li>
<li><p>Remplacer <code class="docutils literal notranslate"><span class="pre">id_classe_mollusques</span></code> par <code class="docutils literal notranslate"><span class="pre">id_classe_gasteropodes</span></code> dans <code class="docutils literal notranslate"><span class="pre">web/js/config.js</span></code> et renseigner la valeur en cohérence avec l”<code class="docutils literal notranslate"><span class="pre">id_liste</span></code> retenu dans la table <code class="docutils literal notranslate"><span class="pre">taxonomie.bib_listes</span></code> pour les gastéropodes. Attention, vous devez avoir établi une correspondance entre les taxons gastéropodes et bivalves et leur liste dans la table <code class="docutils literal notranslate"><span class="pre">taxonomie.cor_taxon_liste</span></code>.</p></li>
</ul>
</section>
<section id="id31">
<h2>1.7.3 (2016-05-19)<a class="headerlink" href="#id31" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Corrections de bugs</strong></p>
<ul class="simple">
<li><p>Correction de coordonnées vides dans l’export de Flore station. cf <a class="reference external" href="https://github.com/PnX-SI/GeoNature/commit/0793a3d3d2b3719ed515058d1a0ba9baf7cb2096">https://github.com/PnX-SI/GeoNature/commit/0793a3d3d2b3719ed515058d1a0ba9baf7cb2096</a></p></li>
<li><p>Correction des triggers en base concernant un bug de saisie pour les taxons dont le taxon de référence n’est pas présent dans <code class="docutils literal notranslate"><span class="pre">taxonomie.bib_taxons</span></code>.</p></li>
</ul>
<p><strong>Note de version</strong></p>
<p>Rappel : commencez par suivre la procédure classique de mise à jour. <a class="reference external" href="http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application">http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application</a></p>
<ul class="simple">
<li><p>Vous pouvez passer directement de la version 1.6.0 à la 1.7.3 mais en vous référant aux notes de version de la 1.7.0.</p></li>
<li><p>Pour passer de la 1.7.2 à la 1.7.3 vous devez exécuter le script <code class="docutils literal notranslate"><span class="pre">https://github.com/PnX-SI/GeoNature/blob/master/data/update_1.7.2to1.7.3.sql</span></code>.</p></li>
</ul>
</section>
<section id="id32">
<h2>1.7.2 (2016-04-27)<a class="headerlink" href="#id32" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Corrections de bug</strong></p>
<ul class="simple">
<li><p>Correction d’un bug dans l’export XLS depuis Flore Station.</p></li>
</ul>
<p><strong>Note de version</strong></p>
<ul class="simple">
<li><p>Vous pouvez passer directement de la version 1.6.0 à la 1.7.2 mais en vous référant aux notes de version de la 1.7.0.</p></li>
</ul>
</section>
<section id="id33">
<h2>1.7.1 (2016-04-27)<a class="headerlink" href="#id33" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Corrections de bug</strong></p>
<ul class="simple">
<li><p>Ajout des listes flore manquantes dans le script de mise à jour <code class="docutils literal notranslate"><span class="pre">data/update_1.6to1.7.sql</span></code>.</p></li>
</ul>
</section>
<section id="id34">
<h2>1.7.0 (2016-04-24)<a class="headerlink" href="#id34" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Nouveautés</strong></p>
<ul class="simple">
<li><p>Ajout du contact flore</p></li>
<li><p>Correction et compléments dans les statistiques et mise en paramètre de leur affichage ou non, ainsi que de la date de début à prendre en compte pour leur affichage.</p></li>
<li><p>Ajout d’un module d’export des données permettant d’offrir, en interne ou à des partenaires, un lien de téléchargement des données basé sur une ou des vues de la base de données (un fichier par vue). Voir <a class="reference external" href="http://docs.geonature.fr">http://docs.geonature.fr</a></p></li>
<li><p>Modification des identifiants des listes pour compatibilité avec les applications GeoNature-Mobile.</p></li>
<li><p>Complément dans la base de données pour compatibilité avec les applications GeoNature-Mobile.</p></li>
<li><p>Correction d’une erreur sur l’importation de shape pour la recherche géographique</p></li>
<li><p>WMS : correction de la liste des sites N2000, correction de l’affichage de l’aire optimale d’adhésion des parcs nationaux et retrait des sites inscrits et classés</p></li>
<li><p>Correction d’un bug permettant la saisie d’une date d’observation postérieure à aujourd’hui dans Flore station</p></li>
<li><p>Mention de la version de taxref sur la page d’accueil</p></li>
</ul>
<p><strong>Note de version</strong></p>
<p>Rappel : commencez par suivre la procédure classique de mise à jour. <a class="reference external" href="http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application">http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application</a></p>
<p><strong>1.</strong> Modification des identifiants des listes de taxons pour compatibilité avec les applications GeoNature-Mobile.</p>
<p>Dans GeoNature-Mobile, les taxons sont filtrables par classe sur la base d’un <code class="docutils literal notranslate"><span class="pre">id_classe</span></code>. Ces id sont inscrits en dur dans le code des applications mobiles.</p>
<p>Dans la base GeoNature les classes taxonomiques sont configurables grace au vues <code class="docutils literal notranslate"><span class="pre">v_nomade_classes</span></code> qui utilisent les listes (<code class="docutils literal notranslate"><span class="pre">taxonomie.bib_listes</span></code>).</p>
<p>Les <code class="docutils literal notranslate"><span class="pre">id_liste</span></code> ont donc été mis à jour pour être compatibles avec les <code class="docutils literal notranslate"><span class="pre">id_classe</span></code> des applications mobiles.</p>
<p>Voir le script SQL d’update <code class="docutils literal notranslate"><span class="pre">data/update_1.6to1.7.sql</span></code> et LIRE ATTENTIVEMENT LES COMMENTAIRES.</p>
<ul class="simple">
<li><p>En lien avec les modifications ci-dessus, mettre à jour les variables des classes taxonomiques correspondant aux modification des <code class="docutils literal notranslate"><span class="pre">id_liste</span></code> dans <code class="docutils literal notranslate"><span class="pre">web/js/config.js</span></code></p></li>
<li><p>Ajouter dans le fichier <code class="docutils literal notranslate"><span class="pre">lib/sfGeonatureConfig.php</span></code> les variables <code class="docutils literal notranslate"><span class="pre">$struc_abregee</span></code>, <code class="docutils literal notranslate"><span class="pre">$struc_long</span></code>, <code class="docutils literal notranslate"><span class="pre">$taxref_version</span></code>, <code class="docutils literal notranslate"><span class="pre">$show_statistiques</span></code> et <code class="docutils literal notranslate"><span class="pre">$init_date_statistiques</span></code> (voir le fichier <code class="docutils literal notranslate"><span class="pre">lib/sfGeonatureConfig.php.sample</span></code>)</p></li>
</ul>
<p><strong>2.</strong> Pour ajouter le Contact flore</p>
<ul class="simple">
<li><p>Exécuter le script sql <code class="docutils literal notranslate"><span class="pre">data/2154/contactflore.sql</span></code></p></li>
<li><p>Ajouter les variables <code class="docutils literal notranslate"><span class="pre">$id_lot_cflore</span>&#160; <span class="pre">=</span> <span class="pre">7</span></code>, <code class="docutils literal notranslate"><span class="pre">$id_protocole_cflore</span>&#160; <span class="pre">=</span> <span class="pre">7</span></code>, <code class="docutils literal notranslate"><span class="pre">$id_source_cflore</span> <span class="pre">=</span> <span class="pre">7</span></code> et <code class="docutils literal notranslate"><span class="pre">$appname_cflore</span> <span class="pre">=</span> <span class="pre">'Contact</span> <span class="pre">flore</span> <span class="pre">-</span> <span class="pre">GeoNature';</span></code> dans <code class="docutils literal notranslate"><span class="pre">lib/sfGeonatureConfig.php</span></code> (voir le fichier d’exemple <code class="docutils literal notranslate"><span class="pre">lib/sfGeonatureConfig.php.sample</span></code>)</p></li>
<li><p>Ajouter les variables  <code class="docutils literal notranslate"><span class="pre">id_lot_contact_flore</span> <span class="pre">=</span> <span class="pre">7</span></code>, <code class="docutils literal notranslate"><span class="pre">id_protocole_contact_flore</span> <span class="pre">=</span> <span class="pre">7</span></code>, <code class="docutils literal notranslate"><span class="pre">id_source_contactflore</span> <span class="pre">=</span> <span class="pre">7</span></code> dans <code class="docutils literal notranslate"><span class="pre">web/js/config.js</span></code> (voir le fichier d’exemple <code class="docutils literal notranslate"><span class="pre">web/js/config.js.sample</span></code>)</p></li>
<li><p>l’enregistrement correspondant au contact flore dans la table <code class="docutils literal notranslate"><span class="pre">synthese.bib_sources</span></code> doit être actif (dernière colonne) pour que le contact flore soit accessible depuis la page d’accueil.</p></li>
</ul>
<p><strong>3.</strong> Afin de mettre à jour la configuration WMS, vous devez exécuter le fichier <code class="docutils literal notranslate"><span class="pre">wms/update1.6to1.7.sh</span></code>.</p>
<p>Au préalable, assurez vous que les informations renseignées dans le fichier <code class="docutils literal notranslate"><span class="pre">config/settings.ini</span></code> sont à jour. L’ancien fichier sera sauvegardé sous <code class="docutils literal notranslate"><span class="pre">wms/wms_1.6.map</span></code>. Vous pourrez faire le choix de conserver ou de supprimer ce fichier de sauvegarde qui ne sera pas utilisé par l’application.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">wms</span><span class="o">/</span><span class="n">update1</span><span class="mf">.6</span><span class="n">to1</span><span class="mf">.7</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.</strong> Mise en place du module d’export</p>
<ul>
<li><p>Créer les vues retournant les données attendues.</p></li>
<li><p>Configurer le module dans le fichier <code class="docutils literal notranslate"><span class="pre">lib/sfGeonatureConfig.php</span></code> à partir de l’exemple du fichier <code class="docutils literal notranslate"><span class="pre">lib/sfGeonatureConfig.php.sample</span></code>); section <code class="docutils literal notranslate"><span class="pre">configuration</span> <span class="pre">du</span> <span class="pre">module</span> <span class="pre">d'export</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p>Vous pouvez paramétrer plusieurs modules avec un nom pour chacun grace au paramètre <code class="docutils literal notranslate"><span class="pre">exportname</span></code></p></li>
<li><p>Pour chacun des modules seuls les utilisateurs de geonature dont le <code class="docutils literal notranslate"><span class="pre">id_role</span></code> figure dans le tableau <code class="docutils literal notranslate"><span class="pre">authorized_roles_ids</span></code> peuvent exporter les données mises à disposition par le module d’export.</p></li>
<li><p>Chaque module peut comporter autant que vues que nécessaire (un bouton par vue générera un fichier zip par vue). Renseigner le tableau <code class="docutils literal notranslate"><span class="pre">views</span></code> pour chacun des modules.</p></li>
<li><p>Voir la documentation ici : <a class="reference external" href="http://docs.geonature.fr">http://docs.geonature.fr</a></p></li>
</ul>
</div></blockquote>
</li>
<li><p>Attribution des droits nécessaires pour le répertoire permettant l’enregistrement temporaire des fichiers générés par le module d’export.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chmod</span> <span class="o">-</span><span class="n">R</span> <span class="mi">775</span> <span class="n">web</span><span class="o">/</span><span class="n">uploads</span><span class="o">/</span><span class="n">exports</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Rétablir les droits d’écriture et vider le cache</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chmod</span> <span class="o">-</span><span class="n">R</span> <span class="mi">777</span> <span class="n">cache</span><span class="o">/</span>
<span class="n">chmod</span> <span class="o">-</span><span class="n">R</span> <span class="mi">777</span> <span class="n">log</span><span class="o">/</span>
<span class="n">php</span> <span class="n">symfony</span> <span class="n">cc</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</section>
<section id="id35">
<h2>1.6.0 (2016-01-14)<a class="headerlink" href="#id35" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Note de version</strong></p>
<ul>
<li><p>Pour les changements dans la base de données vous pouvez exécuter le fichier <code class="docutils literal notranslate"><span class="pre">data/update_1.5to1.6.sql</span></code></p></li>
<li><p>Mise à jour de la configuration Apache. Modifier le fichier <code class="docutils literal notranslate"><span class="pre">apache/wms.conf</span></code> en vous basant sur l’exemple <a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/apache/wms.conf.sample#L16-L17">https://github.com/PnX-SI/GeoNature/blob/master/apache/wms.conf.sample#L16-L17</a></p></li>
<li><p>Ajouter le paramètre <code class="docutils literal notranslate"><span class="pre">$id_application</span></code> dans <code class="docutils literal notranslate"><span class="pre">lib/sfGeonatureConfig.php.php</span></code> (voir la valeur utilisée pour GeoNature dans les tables <code class="docutils literal notranslate"><span class="pre">utilisateurs.t_applications</span></code> et <code class="docutils literal notranslate"><span class="pre">utilisateurs.cor_role_droit_application</span></code>)</p></li>
<li><p>Ajouter le paramètre <code class="docutils literal notranslate"><span class="pre">import_shp_projection</span></code> dans <code class="docutils literal notranslate"><span class="pre">web/js/configmap.map</span></code> - voir l’exemple dans le fichier <code class="docutils literal notranslate"><span class="pre">https://github.com/PnX-SI/GeoNature/blob/master/web/js/configmap.js.sample#L35</span></code></p></li>
<li><p>Supprimer toute référence à gps_user_projection dans <code class="docutils literal notranslate"><span class="pre">web/js/configmap.map</span></code></p></li>
<li><p>Ajouter un tableau JSON des projections disponibles pour l’outil de pointage GPS : <code class="docutils literal notranslate"><span class="pre">gps_user_projections</span></code> dans <code class="docutils literal notranslate"><span class="pre">web/js/configmap.map</span></code>. Respecter la structure définie dans <code class="docutils literal notranslate"><span class="pre">https://github.com/PnX-SI/GeoNature/blob/master/web/js/configmap.js.sample#L7-L14</span></code>. Attention de bien respecter la structure du tableau JSON et notamment sa syntaxe (accolades, virgules, nom des objects, etc…)</p></li>
<li><p>Ajouter les <code class="docutils literal notranslate"><span class="pre">id_liste</span></code> pour les classes faune filtrables dans les formulaires de saisie dans le fichier <code class="docutils literal notranslate"><span class="pre">web/js/config.map</span></code>. Ceci concerne les variables <code class="docutils literal notranslate"><span class="pre">id_classe_oiseaux</span></code>, <code class="docutils literal notranslate"><span class="pre">id_classe_mammiferes</span></code>, <code class="docutils literal notranslate"><span class="pre">id_classe_amphibiens</span></code>, <code class="docutils literal notranslate"><span class="pre">id_classe_reptiles</span></code>, <code class="docutils literal notranslate"><span class="pre">id_classe_poissons</span></code> et <code class="docutils literal notranslate"><span class="pre">id_classe_ecrevisses</span></code>, <code class="docutils literal notranslate"><span class="pre">id_classe_insectes</span></code>, <code class="docutils literal notranslate"><span class="pre">id_classe_arachnides</span></code>, <code class="docutils literal notranslate"><span class="pre">id_classe_myriapodes</span></code> et  <code class="docutils literal notranslate"><span class="pre">id_classe_mollusques</span></code>. Voir l’exemple dans le fichier <code class="docutils literal notranslate"><span class="pre">https://github.com/PnX-SI/GeoNature/blob/master/web/js/config.js.sample#L32-44</span></code></p></li>
<li><p>Taxref a été mis à jour de la version 7 à 8. GeoNature 1.6.0 peut fonctionner avec la version 7. Cependant il est conseillé de passer en taxref V8 en mettant à jour la table <code class="docutils literal notranslate"><span class="pre">synthese.taxref</span></code> avec la version 8. Cette mise à jour pouvant avoir un impact fort sur vos données, son automatisation n’a pas été prévue. Le script SQL de migration de vos données de taxref V7 vers taxref V8 n’est donc pas fourni. Pour une installation nouvelle de la base de données, GeoNature 1.6.0 est fourni avec taxref V8.</p></li>
<li><p>Le routing a été mis à jour, vous devez vider le cache de Symfony pour qu’il soit pris en compte. Pour cela, placez vous dans le répertoire racine de l’application et effectuez la commande suivante :</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">php</span> <span class="n">symfony</span> <span class="n">cc</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p><strong>Changements</strong></p>
<ul class="simple">
<li><p>Les recherches dans la synthèse sont désormais faites sur le <code class="docutils literal notranslate"><span class="pre">cd_ref</span></code> et non plus sur le <code class="docutils literal notranslate"><span class="pre">cd_nom</span></code> pour retourner tous les synonymes du taxon recherché - Fix #92</p></li>
<li><p>Passage de taxref V7 à Taxref V8 - Fix #34</p></li>
<li><p>Intégration de la première version de l’API permettant d’intégrer des données dans la synthèse depuis une source externe - <a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/docs/geonature_webapi_doc.rst">https://github.com/PnX-SI/GeoNature/blob/master/docs/geonature_webapi_doc.rst</a></p></li>
<li><p>Mise en paramètre du <code class="docutils literal notranslate"><span class="pre">id_application</span></code> dans <code class="docutils literal notranslate"><span class="pre">lib/sfGeonatureConfig.php.php</span></code> - Fix #105</p></li>
<li><p>Recharger la synthese après suppression d’un enregistrement - Fix #94</p></li>
<li><p>L’utilisateur peut lui-même définir le système de coordonnées dans l’outil de pointage GPS - Fix #107</p></li>
<li><p>Mise en paramètre de la projection de la shape importée comme zone de recherche dans la synthèse</p></li>
<li><p>Les exports XLS et SHP comportent le <code class="docutils literal notranslate"><span class="pre">cd_nom</span></code> ET le <code class="docutils literal notranslate"><span class="pre">cd_ref</span></code> de tous les synonymes du nom recherché ainsi que le nom_latin (bib_taxons) ET le nom_valide (taxref) - Fix #92</p></li>
<li><p>SAISIE invertébrés - Ajout d’un filtre Mollusques - Fix #117</p></li>
<li><p>Amélioration du vocabulaire utilisé sur la page d’accueil - #118</p></li>
<li><p>Affichage d’un message pendant le chargement des exports</p></li>
<li><p>Mise en place de statistiques automatiques sur la page d’accueil, basées sur les listes de taxons. A compléter.</p></li>
</ul>
<p><strong>Corrections de bug</strong></p>
<ul class="simple">
<li><p>Intégration de la librairie <code class="docutils literal notranslate"><span class="pre">OpenLayers.js</span></code> en local dans le code car les liens distants ne fonctionnaient plus - Fix #97</p></li>
<li><p>Correction d’une erreur lors de l’enregistrement de la saisie invertébrés - Fix #104</p></li>
<li><p>Correction d’une erreur de redirection si on choisit « Quitter » après la saisie de l’enregistrement (contact faune, mortalité et invertébrés) - Fix #102</p></li>
<li><p>Correction du trigger <code class="docutils literal notranslate"><span class="pre">contactfaune.synthese_update_cor_role_fiche_cf()</span></code> - Fix #95</p></li>
<li><p>Correction d’un bug dans les listes déroulantes des taxons filtrée par classe qui n’affichaient rien - Fix #109</p></li>
<li><p>Correction d’un bug sur le contenu des exports shape avec le critère de protection activé - Fix #114</p></li>
<li><p>Correction et adaptation faune-flore des exports shape</p></li>
<li><p>SYNTHESE - Correction de la liste des taxons sans nom français - Fix #116</p></li>
<li><p>Corrections CSS sur la page d’accueil - Fix #115</p></li>
<li><p>Correction sur la largeur de la liste des résultats de la synthèse - Fix #110</p></li>
<li><p>Correction des doublons dans la recherche multi-taxons - Fix #101</p></li>
<li><p>Autres corrections mineures</p></li>
</ul>
</section>
<section id="id36">
<h2>1.5.0 (2015-11-26)<a class="headerlink" href="#id36" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Note de version</strong></p>
<ul>
<li><p>Pour les changements dans la base de données vous pouvez exécuter le fichier <code class="docutils literal notranslate"><span class="pre">data/update_1.4to1.5.sql</span></code></p></li>
<li><p>Le bandeau de la page d’accueil <code class="docutils literal notranslate"><span class="pre">web/images/bandeau_faune.jpg</span></code> a été renommé en <code class="docutils literal notranslate"><span class="pre">bandeau_geonature.jpg</span></code>. Renommez le votre si vous aviez personnalisé ce bandeau.</p></li>
<li><p>Si vous souhaitez désactiver certains programmes dans le « Comment ? » de la synthèse vous devez utiliser le champs <code class="docutils literal notranslate"><span class="pre">actif</span></code> de la table <code class="docutils literal notranslate"><span class="pre">meta.bib_programmes</span></code>.</p></li>
<li><p>Compléter si nécessaire les champs <code class="docutils literal notranslate"><span class="pre">url</span></code>, <code class="docutils literal notranslate"><span class="pre">target</span></code>, <code class="docutils literal notranslate"><span class="pre">picto</span></code>, <code class="docutils literal notranslate"><span class="pre">groupe</span></code> et <code class="docutils literal notranslate"><span class="pre">actif</span></code> dans la table <code class="docutils literal notranslate"><span class="pre">synthese.bib_sources</span></code>.</p></li>
<li><p>Nouvelle répartition des paramètres de configuration javascript en 2 fichiers (<code class="docutils literal notranslate"><span class="pre">config.js</span></code> et <code class="docutils literal notranslate"><span class="pre">configmap.js</span></code>). Vous devez reprendre vos paramètres de configuration du fichier <code class="docutils literal notranslate"><span class="pre">web/js/config.js</span></code> et les ventiler dans ces deux fichiers.</p></li>
<li><p>Ajouter le paramètre <code class="docutils literal notranslate"><span class="pre">id_source_mortalite</span> <span class="pre">=</span> <span class="pre">2;</span></code> au fichier <code class="docutils literal notranslate"><span class="pre">web/js/config.js</span></code>;</p></li>
<li><p>Retirer le paramètre <code class="docutils literal notranslate"><span class="pre">fuseauUTM;</span></code> du fichier <code class="docutils literal notranslate"><span class="pre">web/js/config.js</span></code>;</p></li>
<li><p>Bien définir le système de coordonnées à utiliser pour les pointages par coordonnées fournies en renseignant le paramètre <code class="docutils literal notranslate"><span class="pre">gps_user_projection</span></code> dans le fichier <code class="docutils literal notranslate"><span class="pre">web/js/configmap.js</span></code>;</p></li>
<li><p>Ajouter le paramètre <code class="docutils literal notranslate"><span class="pre">public</span> <span class="pre">static</span> <span class="pre">$id_source_mortalite</span> <span class="pre">=</span> <span class="pre">2;</span></code> au fichier <code class="docutils literal notranslate"><span class="pre">lib/sfGeonatureConfig.php</span></code>;</p></li>
<li><p>Ajouter le paramètre <code class="docutils literal notranslate"><span class="pre">public</span> <span class="pre">static</span> <span class="pre">$srid_ol_map</span> <span class="pre">=</span> <span class="pre">3857;</span></code> au fichier <code class="docutils literal notranslate"><span class="pre">lib/sfGeonatureConfig.php</span></code>;</p></li>
<li><p>L’altitude est calculée automatiquement à partir du service « Alticodage » de l’API GeoPortail de l’IGN et non pluas à partir de la couche <code class="docutils literal notranslate"><span class="pre">layers.l_isolines20</span></code>. Ajoutez ce service dans votre contrat API Geoportail. Il n’est donc plus nécessaire de remplir la couche <code class="docutils literal notranslate"><span class="pre">layers.l_isolines20</span></code>. Cette couche peut toutefois encore être utile si l’utilisateur supprime l’altitude calculée par l’API Geoportail dans les formulaires de saisie.</p></li>
<li><p>Le loup et le lynx sont retirés par défaut de la saisie (saisie recommandée dans le protocole national du réseau grands prédateurs)</p></li>
<li><p>Le cerf, chamois et le bouquetin doivent être saisis selon 6 critères de sexe et age et non 5 comme les autres taxons. Comportement peut-être changé en modifiant la vue <code class="docutils literal notranslate"><span class="pre">contactfaune.v_nomade_taxons_faune</span></code>.</p></li>
<li><p>Mortailité est désormais une source à part entière alors qu’elles étaient mélangées avec la source ContactFaune précédemment. Si vous avez déjà des données de mortalité enregistrées, vous devez adapter la requête SQL ci-dessous avec votre <code class="docutils literal notranslate"><span class="pre">id_source</span></code> pour Mortalité et l’exécuter :</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="n">synthese</span><span class="o">.</span><span class="n">syntheseff</span> <span class="n">SET</span> <span class="n">id_source</span> <span class="o">=</span> <span class="mi">2</span> <span class="n">WHERE</span> <span class="n">id_source</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">AND</span> <span class="n">id_critere_synthese</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p><strong>Changements</strong></p>
<ul class="simple">
<li><p>Optimisation des vues aux chargement des listes de taxons. Fixes #64</p></li>
<li><p>Généricité des champs dans <code class="docutils literal notranslate"><span class="pre">meta.bib_programmes</span></code> (champs <code class="docutils literal notranslate"><span class="pre">sitpn</span></code> renommé en <code class="docutils literal notranslate"><span class="pre">public</span></code>). Fixes #68</p></li>
<li><p>Ajout d’un champ <code class="docutils literal notranslate"><span class="pre">actif</span></code> à la table <code class="docutils literal notranslate"><span class="pre">meta.bib_programmes</span></code> permettant de masquer certains programmes dans le « Comment ? » de la synthèse. Fixes #66</p></li>
<li><p>Ajout d’un champ <code class="docutils literal notranslate"><span class="pre">url</span></code>, <code class="docutils literal notranslate"><span class="pre">target</span></code>, <code class="docutils literal notranslate"><span class="pre">picto</span></code>, <code class="docutils literal notranslate"><span class="pre">groupe</span></code> et <code class="docutils literal notranslate"><span class="pre">actif</span></code> dans la table <code class="docutils literal notranslate"><span class="pre">synthese.bib_sources</span></code> pour générer la page d’accueil dynamiquement et de manière générique. Fixes #69</p></li>
<li><p>Construire dynamiquement la liste des liens vers la saisie des différents protocoles à partir de la table <code class="docutils literal notranslate"><span class="pre">synthese.bib_sources</span></code>. Fixes #69</p></li>
<li><p>Tous les styles des éléments de la page d’accueil ont été passés en CSS. Fixes #57</p></li>
<li><p>Amélioration de l’interface pendant le chargement des différentes applications (synthèse, flore station, formualires de saisie…). Fixes #65</p></li>
<li><p>Recentrage sur la position de l’utilisation en utilisant le protocole de géolocalisation intégré au navigateur de l’utilisateur. Fixes #65</p></li>
<li><p>Un message automatique conseille les utilisateurs d’Internet Explorer de plutôt utiliser Firefox ou Chrome. Fixes #65</p></li>
<li><p>Tri par défaut par date décroissante des 50 dernières observations affichées à l’ouverture de la Synthèse. Fixes #51</p></li>
<li><p>Vocabulaire. « Dessiner un point » remplacé par « Localiser l’observation ». Fixes #66</p></li>
<li><p>Mise à jour des copyrights dans les pieds de page de toutes les applications.</p></li>
<li><p>Refonte du CSS du formulaire de login avec bootstrap et une image de fond différente.</p></li>
<li><p>Refonte Bootstrap de la page d’accueil.</p></li>
<li><p>Homogénéisation du pied de page.</p></li>
<li><p>FloreStation et Bryophytes - Homogénéiser interaction carte liste - ajout d’un popup au survol. Fixes #74</p></li>
<li><p>Suppression d’images non utilisées dans le répertoire <code class="docutils literal notranslate"><span class="pre">web/images</span></code>.</p></li>
<li><p>Mise en cohérence des vues taxonomiques faune. Fixes #81</p></li>
<li><p>Calcul de l’altitude à partir du service « Alticodage » de l’API GeoPortail de l’IGN.</p></li>
<li><p>Factorisation et généralisation du module permettant un positionnement des pointages par saisie de coordonnées selon projection et bbox fournies en paramètres de config.</p></li>
<li><p>Création d’une configuration javascript carto dédiée (<code class="docutils literal notranslate"><span class="pre">configmap.js</span></code>).</p></li>
</ul>
<p><strong>Corrections de bug</strong></p>
<ul class="simple">
<li><p>Correction des problèmes de saisie de la version 1.4.0 liés à la migration de la taxonomie.</p></li>
<li><p>Correction de bugs dans Flore Station et Bryophytes (Zoom, recherche</p></li>
</ul>
</section>
<section id="id37">
<h2>1.4.0 (2015-10-16)<a class="headerlink" href="#id37" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Note de version</strong></p>
<ul class="simple">
<li><p>La gestion de la taxonomie a été mis en conformité avec le schéma <code class="docutils literal notranslate"><span class="pre">taxonomie</span></code> de la base de données de TaxHub (<a class="reference external" href="https://github.com/PnX-SI/TaxHub">https://github.com/PnX-SI/TaxHub</a>). Ainsi le schéma <code class="docutils literal notranslate"><span class="pre">taxonomie</span></code> intégré à GeoNature 1.3.0 doit être globalement revu. L’ensemble des modifications peuvent être réalisées en éxecutant la partie correspondante dans le fichier <code class="docutils literal notranslate"><span class="pre">data/update_1.3to1.4.sql</span></code> (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/data/update_1.3to1.4.sql">https://github.com/PnX-SI/GeoNature/blob/master/data/update_1.3to1.4.sql</a>).</p></li>
<li><p>De nouveaux paramètres ont potentiellement été ajoutés à l’application. Après avoir récupéré le fichier de configuration de votre version 1.3.0, vérifiez les changements éventuels des différents fichiers de configuration.</p></li>
<li><p>Modification du nom de l’host host hébergeant la base de données. databases –&gt; geonatdbhost. A changer ou ajouter dans le <code class="docutils literal notranslate"><span class="pre">/etc/hosts</span></code> si vous avez déjà installé GeoNature.</p></li>
<li><p>Suivez la procédure de mise à jour : <a class="reference external" href="http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application">http://docs.geonature.fr/installation-standalone.html#mise-a-jour-de-l-application</a></p></li>
</ul>
<p><strong>Changements</strong></p>
<ul class="simple">
<li><p>A l’installation initiale, chargement en base des zones à statuts juridiques pour toute la France métropolitaine à partir des sources de l’INPN</p></li>
<li><p>A l’installation initiale, chargement en base de toutes les communes de France</p></li>
<li><p>Mise en place de la compatibilité de la base avec le schema de TaxHub</p></li>
</ul>
</section>
<section id="id38">
<h2>1.3.0 (2015-02-11)<a class="headerlink" href="#id38" title="Lien permanent vers cette rubrique"></a></h2>
<p>Pré-Version de GeoNature - Faune ET Flore. Le fonctionnement de l’ensemble n’a pas été totalement testé, des bugs sont identifiés, d’autres subsistent certainement.</p>
<p><strong>Changements</strong></p>
<ul class="simple">
<li><p>Grosse évolution de la base de données</p></li>
<li><p>Ajout de deux applications de saisie flore (flore station et bryophytes)</p></li>
<li><p>Intégration de la flore en sythese</p></li>
<li><p>Ajouter un id_lot, id_organisme, id_protocole dans toutes les tables pour que ces id soit ajoutés vers la synthese en trigger depuis les tables et pas avec des valeurs en dur dans les triggers. Ceci permet d’utiliser les paramètres de conf de GeoNature</p></li>
<li><p>Ajout d’une fonction à la base pour correction du dysfonctionnement du wms avec mapserver</p></li>
<li><p>Suppression du champ id_taxon en synthese et lien direct de la synthese avecle taxref. ceci permet d’ajouter des données en synthese directement dans la base sans ajouter tous les taxons manquants dans la table bib_taxons</p></li>
<li><p>Suppression de la notion de coeur dans les critère de recherche en synthese</p></li>
<li><p>Ajout d’un filtre faune flore fonge dans la synthese</p></li>
<li><p>Ajout de l’embranchement et du regne dans les exports</p></li>
<li><p>Permettre à des partenaires de saisir mais d’exporter uniquement leurs données perso</p></li>
<li><p>Ajout du déterminateur dans les formulaires invertébrés et contactfaune + en synthese</p></li>
<li><p>Ajout du référentiel géographique de toutes les communes de France métropolitaine</p></li>
<li><p>Ajout des zones à statuts juridiques de la région sud-est (national à venir)</p></li>
<li><p>Bugs fix</p></li>
</ul>
<p><strong>BUG à identifier</strong></p>
<p>Installation :</p>
<ul class="simple">
<li><p>corriger l’insertion de données flore station qui ne fonctionne pas</p></li>
</ul>
<p>Bryophythes :</p>
<ul class="simple">
<li><p>Corriger la recherche avancée par date sans années</p></li>
</ul>
<p>Synthèse :</p>
<ul class="simple">
<li><p>la construction de l’arbre pour choisir plusieurs taxons ne tient pas compte des filtres</p></li>
<li><p>le fonctionnement des unités geographiques n’a pas été testé (initialement conçu uniquement pour la faune)</p></li>
</ul>
</section>
<section id="id39">
<h2>1.2.0 (2015-02-11)<a class="headerlink" href="#id39" title="Lien permanent vers cette rubrique"></a></h2>
<p>Version stabilisée de GeoNature - Faune uniquement (Synthèse Faune + Saisie ContactFauneVertebre, ContactFauneInvertebre et Mortalité).</p>
<p><strong>Changements</strong></p>
<ul class="simple">
<li><p>Modification du nom de l’application de FF-synthese en GeoNature</p></li>
<li><p>Changement du nom des utilisateurs PostgreSQL</p></li>
<li><p>Changement du nom de la base de données</p></li>
<li><p>Mise à jour de la documentation (<a class="reference external" href="http://docs.geonature.fr">http://docs.geonature.fr</a>)</p></li>
<li><p>Automatisation de l’installation de la BDD</p></li>
<li><p>Renommer les tables pour plus de généricité</p></li>
<li><p>Supprimer les tables inutiles ou trop spécifiques</p></li>
<li><p>Gestion des utilisateurs externalisée et centralisée avec UsersHub (<a class="reference external" href="https://github.com/PnX-SI/UsersHub">https://github.com/PnX-SI/UsersHub</a>)</p></li>
<li><p>Correction de bugs</p></li>
<li><p>Préparation de l’intégration de la Flore pour passer de GeoNature Faune à GeoNature Faune-Flore</p></li>
</ul>
</section>
<section id="id40">
<h2>1.1.0 (2014-12-11)<a class="headerlink" href="#id40" title="Lien permanent vers cette rubrique"></a></h2>
<p><strong>Changements</strong></p>
<ul class="simple">
<li><p>Modification du schéma de la base pour être compatible taxref v7</p></li>
<li><p>Import automatisé de taxref v7</p></li>
<li><p>Suppression des tables de hiérarchie taxonomique (famille, ordre, …) afin de simplifier l’utilisation de la taxonomie.</p></li>
<li><p>Création de la notion de groupe (para-taxonomique) à la place de l’utilisation des classes.</p></li>
<li><p>Ajout de données pour pouvoir tester de façon complète l’application (invertébrés, vertébrés)</p></li>
<li><p>Ajout de données exemples</p></li>
<li><p>Bugs fix</p></li>
</ul>
</section>
<section id="id41">
<h2>1.0.0 (2014-12-10)<a class="headerlink" href="#id41" title="Lien permanent vers cette rubrique"></a></h2>
<p>Version fonctionnelle des applications : visualisation de la synthèse faune, saisie d’une donnée de contact (vertébrés, invertébrés, mortalité)</p>
<p><strong>Changements</strong></p>
<ul class="simple">
<li><p>Documentation de l’installation d’un serveur Debian wheezy pas à pas</p></li>
<li><p>Documentation de la mise en place de la base de données</p></li>
<li><p>Documentation de la mise en place de l’application et de son paramétrage</p></li>
<li><p>Script d’insertion d’un jeu de données test</p></li>
<li><p>Passage à PostGIS v2</p></li>
<li><p>Mise en paramètre de la notion de lot, protocole et source</p></li>
</ul>
<p><strong>Prochaines évolutions</strong></p>
<ul class="simple">
<li><p>Script d’import de taxref v7</p></li>
<li><p>Utilisation préférentielle de la taxonomie de taxref plutôt que les tables de hiérarchie taxonomique</p></li>
</ul>
</section>
<section id="id42">
<h2>0.1.0 (2014-12-01)<a class="headerlink" href="#id42" title="Lien permanent vers cette rubrique"></a></h2>
<ul class="simple">
<li><p>Création du projet et de la documentation</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pied de page">
        <a href="authors.html" class="btn btn-neutral float-left" title="AUTEURS" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Précédent</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2019, PnE, PnC.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>